import{a as Km,b as bl,c as Rl,d as _a,e as hs,f as Dl,g as va,h as wa,i as Qm,j as Pl,k as ee,l as Yt,m as Pt,n as Ea,o as Qn,p as Ia,q as Ta,r as ds,s as Aa,t as $e,u as Ye}from"./chunk-XXZQEKK6.js";import{$ as N,$a as Hn,A as pt,Ab as ma,B as xr,Ba as vl,Bb as Nm,C as fl,Ca as pm,Cb as Sl,D as Vr,Da as gm,Db as us,E as nm,Ea as is,Eb as Mm,F as rm,Fa as la,Fb as Om,G as sa,Ga as Q,Gb as Br,H as Rt,Ha as mm,Hb as Fm,I as pl,Ib as Wn,J as im,Ja as ym,Jb as Lm,K as oa,Ka as jr,Kb as Um,L as Nr,Lb as _t,M as gl,Ma as ue,Mb as jm,N as Mr,Na as _m,Nb as cs,O as pe,Oa as vm,Ob as Bm,P as ml,Pa as yn,Pb as qm,Q as sm,Qa as wm,Qb as ls,R as Ae,Ra as Em,Rb as $m,S as ae,Sa as wl,Sb as zm,T as pn,Ta as Im,U as ts,Ua as Tm,Ub as ya,V as $,Va as ha,Vb as Gm,W as Oe,Wa as El,Wb as Kn,X as om,Xb as Hm,Y as q,Ya as Il,Yb as Wm,Z as yl,Za as yt,_ as R,_a as Kt,a as Kg,aa as Dt,ab as Am,b as Qg,ba as am,bb as Qt,c as hn,ca as ns,cb as Cm,d as ll,da as Wt,e as hl,ea as Or,eb as Sm,f as bt,fa as Fe,fb as bm,g as st,ga as qe,gb as Rm,h as ra,hb as ss,i as Yg,ia as um,ib as Dm,j as dn,ja as rs,k as fn,ka as gn,l as Gn,la as mn,lb as os,m as Z,ma as cm,mb as Pm,n as k,na as lm,o as Zi,oa as aa,p as Xg,pa as ua,pb as as,q as Jg,qa as Fr,qb as km,r as F,ra as hm,rb as da,s as ia,sa as Lr,sb as xm,t as Je,ta as _l,tb as fa,u as es,ua as Ur,ub as pa,v as Zg,va as gt,vb as Tl,w as dl,wa as dm,wb as ga,x as em,xa as ca,xb as Al,y as tm,ya as fm,yb as Vm,z as ot,za as mt,zb as Cl}from"./chunk-R5MHGB4Y.js";import{a as b,b as te,e as cl,f as g}from"./chunk-CQCHLVVT.js";var Vl=class extends Um{constructor(){super(...arguments),this.supportsDOMEvents=!0}},Nl=class n extends Vl{static makeCurrent(){Lm(new n)}onAndCancel(e,t,r){return e.addEventListener(t,r),()=>{e.removeEventListener(t,r)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return t=t||this.getDefaultDocument(),t.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return t==="window"?window:t==="document"?e:t==="body"?e.body:null}getBaseHref(e){let t=vA();return t==null?null:wA(t)}resetBaseElement(){fs=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return $m(document.cookie,e)}},fs=null;function vA(){return fs=fs||document.querySelector("base"),fs?fs.getAttribute("href"):null}function wA(n){return new URL(n,document.baseURI).pathname}var Ml=class{addToWindow(e){pn.getAngularTestability=(r,i=!0)=>{let s=e.findTestabilityInTree(r,i);if(s==null)throw new ae(5103,!1);return s},pn.getAllAngularTestabilities=()=>e.getAllTestabilities(),pn.getAllAngularRootElements=()=>e.getAllRootElements();let t=r=>{let i=pn.getAllAngularTestabilities(),s=i.length,o=function(){s--,s==0&&r()};i.forEach(a=>{a.whenStable(o)})};pn.frameworkStabilizers||(pn.frameworkStabilizers=[]),pn.frameworkStabilizers.push(t)}findTestabilityInTree(e,t,r){if(t==null)return null;let i=e.getTestability(t);return i??(r?Wn().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}},EA=(()=>{let e=class e{build(){return new XMLHttpRequest}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})(),Ol=new q(""),Zm=(()=>{let e=class e{constructor(r,i){this._zone=i,this._eventNameToPlugin=new Map,r.forEach(s=>{s.manager=this}),this._plugins=r.slice().reverse()}addEventListener(r,i,s){return this._findPluginFor(i).addEventListener(r,i,s)}getZone(){return this._zone}_findPluginFor(r){let i=this._eventNameToPlugin.get(r);if(i)return i;if(i=this._plugins.find(o=>o.supports(r)),!i)throw new ae(5101,!1);return this._eventNameToPlugin.set(r,i),i}};e.\u0275fac=function(i){return new(i||e)(R(Ol),R(ue))},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})(),Ca=class{constructor(e){this._doc=e}},kl="ng-app-id",ey=(()=>{let e=class e{constructor(r,i,s,o={}){this.doc=r,this.appId=i,this.nonce=s,this.platformId=o,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=Kn(o),this.resetHostNodes()}addStyles(r){for(let i of r)this.changeUsageCount(i,1)===1&&this.onStyleAdded(i)}removeStyles(r){for(let i of r)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){let r=this.styleNodesInDOM;r&&(r.forEach(i=>i.remove()),r.clear());for(let i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(r){this.hostNodes.add(r);for(let i of this.getAllStyles())this.addStyleToHost(r,i)}removeHost(r){this.hostNodes.delete(r)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(r){for(let i of this.hostNodes)this.addStyleToHost(i,r)}onStyleRemoved(r){let i=this.styleRef;i.get(r)?.elements?.forEach(s=>s.remove()),i.delete(r)}collectServerRenderedStyles(){let r=this.doc.head?.querySelectorAll(`style[${kl}="${this.appId}"]`);if(r?.length){let i=new Map;return r.forEach(s=>{s.textContent!=null&&i.set(s.textContent,s)}),i}return null}changeUsageCount(r,i){let s=this.styleRef;if(s.has(r)){let o=s.get(r);return o.usage+=i,o.usage}return s.set(r,{usage:i,elements:[]}),i}getStyleElement(r,i){let s=this.styleNodesInDOM,o=s?.get(i);if(o?.parentNode===r)return s.delete(i),o.removeAttribute(kl),o;{let a=this.doc.createElement("style");return this.nonce&&a.setAttribute("nonce",this.nonce),a.textContent=i,this.platformIsServer&&a.setAttribute(kl,this.appId),r.appendChild(a),a}}addStyleToHost(r,i){let s=this.getStyleElement(r,i),o=this.styleRef,a=o.get(i)?.elements;a?a.push(s):o.set(i,{elements:[s],usage:1})}resetHostNodes(){let r=this.hostNodes;r.clear(),r.add(this.doc.head)}};e.\u0275fac=function(i){return new(i||e)(R(_t),R(ca),R(vl,8),R(mt))},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})(),xl={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Ll=/%COMP%/g,ty="%COMP%",IA=`_nghost-${ty}`,TA=`_ngcontent-${ty}`,AA=!0,CA=new q("",{providedIn:"root",factory:()=>AA});function SA(n){return TA.replace(Ll,n)}function bA(n){return IA.replace(Ll,n)}function ny(n,e){return e.map(t=>t.replace(Ll,n))}var Ym=(()=>{let e=class e{constructor(r,i,s,o,a,u,c,l=null){this.eventManager=r,this.sharedStylesHost=i,this.appId=s,this.removeStylesOnCompDestroy=o,this.doc=a,this.platformId=u,this.ngZone=c,this.nonce=l,this.rendererByCompId=new Map,this.platformIsServer=Kn(u),this.defaultRenderer=new ps(r,a,c,this.platformIsServer)}createRenderer(r,i){if(!r||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===ns.ShadowDom&&(i=te(b({},i),{encapsulation:ns.Emulated}));let s=this.getOrCreateRenderer(r,i);return s instanceof Sa?s.applyToHost(r):s instanceof gs&&s.applyStyles(),s}getOrCreateRenderer(r,i){let s=this.rendererByCompId,o=s.get(i.id);if(!o){let a=this.doc,u=this.ngZone,c=this.eventManager,l=this.sharedStylesHost,h=this.removeStylesOnCompDestroy,d=this.platformIsServer;switch(i.encapsulation){case ns.Emulated:o=new Sa(c,l,i,this.appId,h,a,u,d);break;case ns.ShadowDom:return new Fl(c,l,r,i,a,u,this.nonce,d);default:o=new gs(c,l,i,h,a,u,d);break}s.set(i.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}};e.\u0275fac=function(i){return new(i||e)(R(Zm),R(ey),R(ca),R(CA),R(_t),R(mt),R(ue),R(vl))},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})(),ps=class{constructor(e,t,r,i){this.eventManager=e,this.doc=t,this.ngZone=r,this.platformIsServer=i,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(e,t){return t?this.doc.createElementNS(xl[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(Xm(e)?e.content:e).appendChild(t)}insertBefore(e,t,r){e&&(Xm(e)?e.content:e).insertBefore(t,r)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let r=typeof e=="string"?this.doc.querySelector(e):e;if(!r)throw new ae(-5104,!1);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,i){if(i){t=i+":"+t;let s=xl[i];s?e.setAttributeNS(s,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){let i=xl[r];i?e.removeAttributeNS(i,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,i){i&(is.DashCase|is.Important)?e.style.setProperty(t,r,i&is.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&is.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){e!=null&&(e[t]=r)}setValue(e,t){e.nodeValue=t}listen(e,t,r){if(typeof e=="string"&&(e=Wn().getGlobalEventTarget(this.doc,e),!e))throw new Error(`Unsupported event target ${e} for event ${t}`);return this.eventManager.addEventListener(e,t,this.decoratePreventDefault(r))}decoratePreventDefault(e){return t=>{if(t==="__ngUnwrap__")return e;(this.platformIsServer?this.ngZone.runGuarded(()=>e(t)):e(t))===!1&&t.preventDefault()}}};function Xm(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var Fl=class extends ps{constructor(e,t,r,i,s,o,a,u){super(e,s,o,u),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let c=ny(i.id,i.styles);for(let l of c){let h=document.createElement("style");a&&h.setAttribute("nonce",a),h.textContent=l,this.shadowRoot.appendChild(h)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},gs=class extends ps{constructor(e,t,r,i,s,o,a,u){super(e,s,o,a),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=i,this.styles=u?ny(u,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},Sa=class extends gs{constructor(e,t,r,i,s,o,a,u){let c=i+"-"+r.id;super(e,t,r,s,o,a,u,c),this.contentAttr=SA(c),this.hostAttr=bA(c)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){let r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}},RA=(()=>{let e=class e extends Ca{constructor(r){super(r)}supports(r){return!0}addEventListener(r,i,s){return r.addEventListener(i,s,!1),()=>this.removeEventListener(r,i,s)}removeEventListener(r,i,s){return r.removeEventListener(i,s)}};e.\u0275fac=function(i){return new(i||e)(R(_t))},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})(),Jm=["alt","control","meta","shift"],DA={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},PA={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},kA=(()=>{let e=class e extends Ca{constructor(r){super(r)}supports(r){return e.parseEventName(r)!=null}addEventListener(r,i,s){let o=e.parseEventName(i),a=e.eventCallback(o.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Wn().onAndCancel(r,o.domEventName,a))}static parseEventName(r){let i=r.toLowerCase().split("."),s=i.shift();if(i.length===0||!(s==="keydown"||s==="keyup"))return null;let o=e._normalizeKey(i.pop()),a="",u=i.indexOf("code");if(u>-1&&(i.splice(u,1),a="code."),Jm.forEach(l=>{let h=i.indexOf(l);h>-1&&(i.splice(h,1),a+=l+".")}),a+=o,i.length!=0||o.length===0)return null;let c={};return c.domEventName=s,c.fullKey=a,c}static matchEventFullKeyCode(r,i){let s=DA[r.key]||r.key,o="";return i.indexOf("code.")>-1&&(s=r.code,o="code."),s==null||!s?!1:(s=s.toLowerCase(),s===" "?s="space":s==="."&&(s="dot"),Jm.forEach(a=>{if(a!==s){let u=PA[a];u(r)&&(o+=a+".")}}),o+=s,o===i)}static eventCallback(r,i,s){return o=>{e.matchEventFullKeyCode(o,r)&&s.runGuarded(()=>i(o))}}static _normalizeKey(r){return r==="esc"?"escape":r}};e.\u0275fac=function(i){return new(i||e)(R(_t))},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})();function xA(){Nl.makeCurrent()}function VA(){return new _l}function NA(){return dm(document),document}var MA=[{provide:mt,useValue:Gm},{provide:fm,useValue:xA,multi:!0},{provide:_t,useFactory:NA,deps:[]}],$x=Nm(Mm,"browser",MA),OA=new q(""),FA=[{provide:fa,useClass:Ml,deps:[]},{provide:xm,useClass:pa,deps:[ue,Tl,fa]},{provide:pa,useClass:pa,deps:[ue,Tl,fa]}],LA=[{provide:um,useValue:"root"},{provide:_l,useFactory:VA,deps:[]},{provide:Ol,useClass:RA,multi:!0,deps:[_t,ue,mt]},{provide:Ol,useClass:kA,multi:!0,deps:[_t]},Ym,ey,Zm,{provide:ym,useExisting:Ym},{provide:Wm,useClass:EA,deps:[]},[]],zx=(()=>{let e=class e{constructor(r){}static withServerTransition(r){return{ngModule:e,providers:[{provide:ca,useValue:r.appId}]}}};e.\u0275fac=function(i){return new(i||e)(R(OA,12))},e.\u0275mod=Fe({type:e}),e.\u0275inj=Oe({providers:[...LA,...FA],imports:[ya,Om]});let n=e;return n})();var ry=(()=>{let e=class e{constructor(r){this._doc=r}getTitle(){return this._doc.title}setTitle(r){this._doc.title=r||""}};e.\u0275fac=function(i){return new(i||e)(R(_t))},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var fy=(()=>{let e=class e{constructor(r,i){this._renderer=r,this._elementRef=i,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(r,i){this._renderer.setProperty(this._elementRef.nativeElement,r,i)}registerOnTouched(r){this.onTouched=r}registerOnChange(r){this.onChange=r}setDisabledState(r){this.setProperty("disabled",r)}};e.\u0275fac=function(i){return new(i||e)(Q(jr),Q(Ur))},e.\u0275dir=qe({type:e});let n=e;return n})(),jA=(()=>{let e=class e extends fy{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Fr(e)))(s||e)}})(),e.\u0275dir=qe({type:e,features:[yn]});let n=e;return n})(),py=new q("");var BA={provide:py,useExisting:ts(()=>gy),multi:!0};function qA(){let n=Wn()?Wn().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var $A=new q(""),gy=(()=>{let e=class e extends fy{constructor(r,i,s){super(r,i),this._compositionMode=s,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!qA())}writeValue(r){let i=r??"";this.setProperty("value",i)}_handleInput(r){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(r)}_compositionStart(){this._composing=!0}_compositionEnd(r){this._composing=!1,this._compositionMode&&this.onChange(r)}};e.\u0275fac=function(i){return new(i||e)(Q(jr),Q(Ur),Q($A,8))},e.\u0275dir=qe({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,s){i&1&&Qt("input",function(a){return s._handleInput(a.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(a){return s._compositionEnd(a.target.value)})},features:[os([BA]),yn]});let n=e;return n})();function _n(n){return n==null||(typeof n=="string"||Array.isArray(n))&&n.length===0}function my(n){return n!=null&&typeof n.length=="number"}var ql=new q(""),yy=new q(""),zA=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,iy=class{static min(e){return GA(e)}static max(e){return HA(e)}static required(e){return _y(e)}static requiredTrue(e){return WA(e)}static email(e){return KA(e)}static minLength(e){return QA(e)}static maxLength(e){return YA(e)}static pattern(e){return XA(e)}static nullValidator(e){return Da(e)}static compose(e){return Ay(e)}static composeAsync(e){return Sy(e)}};function GA(n){return e=>{if(_n(e.value)||_n(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t<n?{min:{min:n,actual:e.value}}:null}}function HA(n){return e=>{if(_n(e.value)||_n(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t>n?{max:{max:n,actual:e.value}}:null}}function _y(n){return _n(n.value)?{required:!0}:null}function WA(n){return n.value===!0?null:{required:!0}}function KA(n){return _n(n.value)||zA.test(n.value)?null:{email:!0}}function QA(n){return e=>_n(e.value)||!my(e.value)?null:e.value.length<n?{minlength:{requiredLength:n,actualLength:e.value.length}}:null}function YA(n){return e=>my(e.value)&&e.value.length>n?{maxlength:{requiredLength:n,actualLength:e.value.length}}:null}function XA(n){if(!n)return Da;let e,t;return typeof n=="string"?(t="",n.charAt(0)!=="^"&&(t+="^"),t+=n,n.charAt(n.length-1)!=="$"&&(t+="$"),e=new RegExp(t)):(t=n.toString(),e=n),r=>{if(_n(r.value))return null;let i=r.value;return e.test(i)?null:{pattern:{requiredPattern:t,actualValue:i}}}}function Da(n){return null}function vy(n){return n!=null}function wy(n){return ga(n)?Z(n):n}function Ey(n){let e={};return n.forEach(t=>{e=t!=null?b(b({},e),t):e}),Object.keys(e).length===0?null:e}function Iy(n,e){return e.map(t=>t(n))}function JA(n){return!n.validate}function Ty(n){return n.map(e=>JA(e)?e:t=>e.validate(t))}function Ay(n){if(!n)return null;let e=n.filter(vy);return e.length==0?null:function(t){return Ey(Iy(t,e))}}function Cy(n){return n!=null?Ay(Ty(n)):null}function Sy(n){if(!n)return null;let e=n.filter(vy);return e.length==0?null:function(t){let r=Iy(t,e).map(wy);return em(r).pipe(F(Ey))}}function by(n){return n!=null?Sy(Ty(n)):null}function sy(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function Ry(n){return n._rawValidators}function Dy(n){return n._rawAsyncValidators}function Ul(n){return n?Array.isArray(n)?n:[n]:[]}function Pa(n,e){return Array.isArray(n)?n.includes(e):n===e}function oy(n,e){let t=Ul(e);return Ul(n).forEach(i=>{Pa(t,i)||t.push(i)}),t}function ay(n,e){return Ul(e).filter(t=>!Pa(n,t))}var ka=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=Cy(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=by(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},$r=class extends ka{get formDirective(){return null}get path(){return null}},_s=class extends ka{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},xa=class{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},ZA={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},aV=te(b({},ZA),{"[class.ng-submitted]":"isSubmitted"}),uV=(()=>{let e=class e extends xa{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(Q(_s,2))},e.\u0275dir=qe({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,s){i&2&&Il("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},features:[yn]});let n=e;return n})(),cV=(()=>{let e=class e extends xa{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(Q($r,10))},e.\u0275dir=qe({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(i,s){i&2&&Il("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)("ng-submitted",s.isSubmitted)},features:[yn]});let n=e;return n})();var ms="VALID",ba="INVALID",qr="PENDING",ys="DISABLED";function $l(n){return(Oa(n)?n.validators:n)||null}function e0(n){return Array.isArray(n)?Cy(n):n||null}function zl(n,e){return(Oa(e)?e.asyncValidators:n)||null}function t0(n){return Array.isArray(n)?by(n):n||null}function Oa(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function Py(n,e,t){let r=n.controls;if(!(e?Object.keys(r):r).length)throw new ae(1e3,"");if(!r[t])throw new ae(1001,"")}function ky(n,e,t){n._forEachChild((r,i)=>{if(t[i]===void 0)throw new ae(1002,"")})}var zr=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===ms}get invalid(){return this.status===ba}get pending(){return this.status==qr}get disabled(){return this.status===ys}get enabled(){return this.status!==ys}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(oy(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(oy(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(ay(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(ay(e,this._rawAsyncValidators))}hasValidator(e){return Pa(this._rawValidators,e)}hasAsyncValidator(e){return Pa(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=qr,e.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=ys,this.errors=null,this._forEachChild(r=>{r.disable(te(b({},e),{onlySelf:!0}))}),this._updateValue(),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(te(b({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=ms,this._forEachChild(r=>{r.enable(te(b({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(te(b({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===ms||this.status===qr)&&this._runAsyncValidator(e.emitEvent)),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?ys:ms}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=qr,this._hasOwnPendingAsyncValidator=!0;let t=wy(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(e,t){let r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new gt,this.statusChanges=new gt}_calculateStatus(){return this._allControlsDisabled()?ys:this.errors?ba:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(qr)?qr:this._anyControlsHaveStatus(ba)?ba:ms}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Oa(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=e0(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=t0(this._rawAsyncValidators)}},Va=class extends zr{constructor(e,t,r){super($l(t),zl(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){ky(this,!0,e),Object.keys(e).forEach(r=>{Py(this,!0,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(r=>{let i=this.controls[r];i&&i.patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,i)=>{r.reset(e?e[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>r._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,r]of Object.entries(this.controls))if(this.contains(t)&&e(r))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,r,i)=>((r.enabled||this.disabled)&&(t[i]=r.value),t))}_reduceChildren(e,t){let r=e;return this._forEachChild((i,s)=>{r=t(r,i,s)}),r}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var jl=class extends Va{};var xy=new q("CallSetDisabledState",{providedIn:"root",factory:()=>Gl}),Gl="always";function n0(n,e){return[...e.path,n]}function uy(n,e,t=Gl){Hl(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),i0(n,e),o0(n,e),s0(n,e),r0(n,e)}function cy(n,e,t=!0){let r=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(r),e.valueAccessor.registerOnTouched(r)),Ma(n,e),n&&(e._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function Na(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function r0(n,e){if(e.valueAccessor.setDisabledState){let t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function Hl(n,e){let t=Ry(n);e.validator!==null?n.setValidators(sy(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let r=Dy(n);e.asyncValidator!==null?n.setAsyncValidators(sy(r,e.asyncValidator)):typeof r=="function"&&n.setAsyncValidators([r]);let i=()=>n.updateValueAndValidity();Na(e._rawValidators,i),Na(e._rawAsyncValidators,i)}function Ma(n,e){let t=!1;if(n!==null){if(e.validator!==null){let i=Ry(n);if(Array.isArray(i)&&i.length>0){let s=i.filter(o=>o!==e.validator);s.length!==i.length&&(t=!0,n.setValidators(s))}}if(e.asyncValidator!==null){let i=Dy(n);if(Array.isArray(i)&&i.length>0){let s=i.filter(o=>o!==e.asyncValidator);s.length!==i.length&&(t=!0,n.setAsyncValidators(s))}}}let r=()=>{};return Na(e._rawValidators,r),Na(e._rawAsyncValidators,r),t}function i0(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&Vy(n,e)})}function s0(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&Vy(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function Vy(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function o0(n,e){let t=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function a0(n,e){n==null,Hl(n,e)}function u0(n,e){return Ma(n,e)}function c0(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function l0(n){return Object.getPrototypeOf(n.constructor)===jA}function h0(n,e){n._syncPendingControls(),e.forEach(t=>{let r=t.control;r.updateOn==="submit"&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function d0(n,e){if(!e)return null;Array.isArray(e);let t,r,i;return e.forEach(s=>{s.constructor===gy?t=s:l0(s)?r=s:i=s}),i||r||t||null}function f0(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function ly(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function hy(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var Ra=class extends zr{constructor(e=null,t,r){super($l(t),zl(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Oa(t)&&(t.nonNullable||t.initialValueIsDefault)&&(hy(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){ly(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){ly(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){hy(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var p0=n=>n instanceof Ra;var hV=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=qe({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]});let n=e;return n})();var Ny=new q("");var g0={provide:$r,useExisting:ts(()=>m0)},m0=(()=>{let e=class e extends $r{constructor(r,i,s){super(),this.callSetDisabledState=s,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new gt,this._setValidators(r),this._setAsyncValidators(i)}ngOnChanges(r){this._checkFormPresent(),r.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Ma(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(r){let i=this.form.get(r.path);return uy(i,r,this.callSetDisabledState),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(r),i}getControl(r){return this.form.get(r.path)}removeControl(r){cy(r.control||null,r,!1),f0(this.directives,r)}addFormGroup(r){this._setUpFormContainer(r)}removeFormGroup(r){this._cleanUpFormContainer(r)}getFormGroup(r){return this.form.get(r.path)}addFormArray(r){this._setUpFormContainer(r)}removeFormArray(r){this._cleanUpFormContainer(r)}getFormArray(r){return this.form.get(r.path)}updateModel(r,i){this.form.get(r.path).setValue(i)}onSubmit(r){return this.submitted=!0,h0(this.form,this.directives),this.ngSubmit.emit(r),r?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(r=void 0){this.form.reset(r),this.submitted=!1}_updateDomValue(){this.directives.forEach(r=>{let i=r.control,s=this.form.get(r.path);i!==s&&(cy(i||null,r),p0(s)&&(uy(s,r,this.callSetDisabledState),r.control=s))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(r){let i=this.form.get(r.path);a0(i,r),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(r){if(this.form){let i=this.form.get(r.path);i&&u0(i,r)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){Hl(this.form,this),this._oldForm&&Ma(this._oldForm,this)}_checkFormPresent(){this.form}};e.\u0275fac=function(i){return new(i||e)(Q(ql,10),Q(yy,10),Q(xy,8))},e.\u0275dir=qe({type:e,selectors:[["","formGroup",""]],hostBindings:function(i,s){i&1&&Qt("submit",function(a){return s.onSubmit(a)})("reset",function(){return s.onReset()})},inputs:{form:[Wt.None,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[os([g0]),yn,mn]});let n=e;return n})();var y0={provide:_s,useExisting:ts(()=>_0)},_0=(()=>{let e=class e extends _s{set isDisabled(r){}constructor(r,i,s,o,a){super(),this._ngModelWarningConfig=a,this._added=!1,this.name=null,this.update=new gt,this._ngModelWarningSent=!1,this._parent=r,this._setValidators(i),this._setAsyncValidators(s),this.valueAccessor=d0(this,o)}ngOnChanges(r){this._added||this._setUpControl(),c0(r,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(r){this.viewModel=r,this.update.emit(r)}get path(){return n0(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}};e._ngModelWarningSentOnce=!1,e.\u0275fac=function(i){return new(i||e)(Q($r,13),Q(ql,10),Q(yy,10),Q(py,10),Q(Ny,8))},e.\u0275dir=qe({type:e,selectors:[["","formControlName",""]],inputs:{name:[Wt.None,"formControlName","name"],isDisabled:[Wt.None,"disabled","isDisabled"],model:[Wt.None,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[os([y0]),yn,mn]});let n=e;return n})();var v0=(()=>{let e=class e{constructor(){this._validator=Da}ngOnChanges(r){if(this.inputName in r){let i=this.normalizeInput(r[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):Da,this._onChange&&this._onChange()}}validate(r){return this._validator(r)}registerOnValidatorChange(r){this._onChange=r}enabled(r){return r!=null}};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=qe({type:e,features:[mn]});let n=e;return n})();var w0={provide:ql,useExisting:ts(()=>E0),multi:!0};var E0=(()=>{let e=class e extends v0{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=Br,this.createValidator=r=>_y}enabled(r){return r}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Fr(e)))(s||e)}})(),e.\u0275dir=qe({type:e,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(i,s){i&2&&ha("required",s._enabled?"":null)},inputs:{required:"required"},features:[os([w0]),yn]});let n=e;return n})();var I0=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Fe({type:e}),e.\u0275inj=Oe({});let n=e;return n})(),Bl=class extends zr{constructor(e,t,r){super($l(t),zl(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[this._adjustIndex(e)]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,r={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(e,t={}){let r=this._adjustIndex(e);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,r={}){let i=this._adjustIndex(e);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),t&&(this.controls.splice(i,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){ky(this,!1,e),e.forEach((r,i)=>{Py(this,!1,i),this.at(i).setValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(e.forEach((r,i)=>{this.at(i)&&this.at(i).patchValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((r,i)=>{r.reset(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_adjustIndex(e){return e<0?e+this.length:e}_syncPendingControls(){let e=this.controls.reduce((t,r)=>r._syncPendingControls()?!0:t,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){this.controls.forEach((t,r)=>{e(t,r)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_allControlsDisabled(){for(let e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}_find(e){return this.at(e)??null}};function dy(n){return!!n&&(n.asyncValidators!==void 0||n.validators!==void 0||n.updateOn!==void 0)}var dV=(()=>{let e=class e{constructor(){this.useNonNullable=!1}get nonNullable(){let r=new e;return r.useNonNullable=!0,r}group(r,i=null){let s=this._reduceControls(r),o={};return dy(i)?o=i:i!==null&&(o.validators=i.validator,o.asyncValidators=i.asyncValidator),new Va(s,o)}record(r,i=null){let s=this._reduceControls(r);return new jl(s,i)}control(r,i,s){let o={};return this.useNonNullable?(dy(i)?o=i:(o.validators=i,o.asyncValidators=s),new Ra(r,te(b({},o),{nonNullable:!0}))):new Ra(r,i,s)}array(r,i,s){let o=r.map(a=>this._createControl(a));return new Bl(o,i,s)}_reduceControls(r){let i={};return Object.keys(r).forEach(s=>{i[s]=this._createControl(r[s])}),i}_createControl(r){if(r instanceof Ra)return r;if(r instanceof zr)return r;if(Array.isArray(r)){let i=r[0],s=r.length>1?r[1]:null,o=r.length>2?r[2]:null;return this.control(i,s,o)}else return this.control(r)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var My=(()=>{let e=class e{static withConfig(r){return{ngModule:e,providers:[{provide:Ny,useValue:r.warnOnNgModelWithFormControl??"always"},{provide:xy,useValue:r.callSetDisabledState??Gl}]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Fe({type:e}),e.\u0275inj=Oe({imports:[I0]});let n=e;return n})();var B="primary",Vs=Symbol("RouteTitle"),Xl=class{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function Qr(n){return new Xl(n)}function A0(n,e,t){let r=t.path.split("/");if(r.length>n.length||t.pathMatch==="full"&&(e.hasChildren()||r.length<n.length))return null;let i={};for(let s=0;s<r.length;s++){let o=r[s],a=n[s];if(o.startsWith(":"))i[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:n.slice(0,r.length),posParams:i}}function C0(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!kt(n[t],e[t]))return!1;return!0}function kt(n,e){let t=n?Jl(n):void 0,r=e?Jl(e):void 0;if(!t||!r||t.length!=r.length)return!1;let i;for(let s=0;s<t.length;s++)if(i=t[s],!Gy(n[i],e[i]))return!1;return!0}function Jl(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function Gy(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;let t=[...n].sort(),r=[...e].sort();return t.every((i,s)=>r[s]===i)}else return n===e}function Hy(n){return n.length>0?n[n.length-1]:null}function In(n){return Xg(n)?n:ga(n)?Z(Promise.resolve(n)):k(n)}var S0={exact:Ky,subset:Qy},Wy={exact:b0,subset:R0,ignored:()=>!0};function Oy(n,e,t){return S0[t.paths](n.root,e.root,t.matrixParams)&&Wy[t.queryParams](n.queryParams,e.queryParams)&&!(t.fragment==="exact"&&n.fragment!==e.fragment)}function b0(n,e){return kt(n,e)}function Ky(n,e,t){if(!Xn(n.segments,e.segments)||!Ua(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(let r in e.children)if(!n.children[r]||!Ky(n.children[r],e.children[r],t))return!1;return!0}function R0(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>Gy(n[t],e[t]))}function Qy(n,e,t){return Yy(n,e,e.segments,t)}function Yy(n,e,t,r){if(n.segments.length>t.length){let i=n.segments.slice(0,t.length);return!(!Xn(i,t)||e.hasChildren()||!Ua(i,t,r))}else if(n.segments.length===t.length){if(!Xn(n.segments,t)||!Ua(n.segments,t,r))return!1;for(let i in e.children)if(!n.children[i]||!Qy(n.children[i],e.children[i],r))return!1;return!0}else{let i=t.slice(0,n.segments.length),s=t.slice(n.segments.length);return!Xn(n.segments,i)||!Ua(n.segments,i,r)||!n.children[B]?!1:Yy(n.children[B],e,s,r)}}function Ua(n,e,t){return e.every((r,i)=>Wy[t](n[i].parameters,r.parameters))}var vn=class{constructor(e=new Y([],{}),t={},r=null){this.root=e,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap??=Qr(this.queryParams),this._queryParamMap}toString(){return k0.serialize(this)}},Y=class{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Object.values(t).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return ja(this)}},Yn=class{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=Qr(this.parameters),this._parameterMap}toString(){return Jy(this)}};function D0(n,e){return Xn(n,e)&&n.every((t,r)=>kt(t.parameters,e[r].parameters))}function Xn(n,e){return n.length!==e.length?!1:n.every((t,r)=>t.path===e[r].path)}function P0(n,e){let t=[];return Object.entries(n.children).forEach(([r,i])=>{r===B&&(t=t.concat(e(i,r)))}),Object.entries(n.children).forEach(([r,i])=>{r!==B&&(t=t.concat(e(i,r)))}),t}var Ns=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:()=>new Cs,providedIn:"root"});let n=e;return n})(),Cs=class{parse(e){let t=new eh(e);return new vn(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${vs(e.root,!0)}`,r=N0(e.queryParams),i=typeof e.fragment=="string"?`#${x0(e.fragment)}`:"";return`${t}${r}${i}`}},k0=new Cs;function ja(n){return n.segments.map(e=>Jy(e)).join("/")}function vs(n,e){if(!n.hasChildren())return ja(n);if(e){let t=n.children[B]?vs(n.children[B],!1):"",r=[];return Object.entries(n.children).forEach(([i,s])=>{i!==B&&r.push(`${i}:${vs(s,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}else{let t=P0(n,(r,i)=>i===B?[vs(n.children[B],!1)]:[`${i}:${vs(r,!1)}`]);return Object.keys(n.children).length===1&&n.children[B]!=null?`${ja(n)}/${t[0]}`:`${ja(n)}/(${t.join("//")})`}}function Xy(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Fa(n){return Xy(n).replace(/%3B/gi,";")}function x0(n){return encodeURI(n)}function Zl(n){return Xy(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Ba(n){return decodeURIComponent(n)}function Fy(n){return Ba(n.replace(/\+/g,"%20"))}function Jy(n){return`${Zl(n.path)}${V0(n.parameters)}`}function V0(n){return Object.entries(n).map(([e,t])=>`;${Zl(e)}=${Zl(t)}`).join("")}function N0(n){let e=Object.entries(n).map(([t,r])=>Array.isArray(r)?r.map(i=>`${Fa(t)}=${Fa(i)}`).join("&"):`${Fa(t)}=${Fa(r)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var M0=/^[^\/()?;#]+/;function Wl(n){let e=n.match(M0);return e?e[0]:""}var O0=/^[^\/()?;=#]+/;function F0(n){let e=n.match(O0);return e?e[0]:""}var L0=/^[^=?&#]+/;function U0(n){let e=n.match(L0);return e?e[0]:""}var j0=/^[^&#]+/;function B0(n){let e=n.match(j0);return e?e[0]:""}var eh=class{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Y([],{}):new Y([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(r[B]=new Y(e,t)),r}parseSegment(){let e=Wl(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new ae(4009,!1);return this.capture(e),new Yn(Ba(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=F0(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let i=Wl(this.remaining);i&&(r=i,this.capture(r))}e[Ba(t)]=Ba(r)}parseQueryParam(e){let t=U0(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let o=B0(this.remaining);o&&(r=o,this.capture(r))}let i=Fy(t),s=Fy(r);if(e.hasOwnProperty(i)){let o=e[i];Array.isArray(o)||(o=[o],e[i]=o),o.push(s)}else e[i]=s}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=Wl(this.remaining),i=this.remaining[r.length];if(i!=="/"&&i!==")"&&i!==";")throw new ae(4010,!1);let s;r.indexOf(":")>-1?(s=r.slice(0,r.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=B);let o=this.parseChildren();t[s]=Object.keys(o).length===1?o[B]:new Y([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new ae(4011,!1)}};function Zy(n){return n.segments.length>0?new Y([],{[B]:n}):n}function e_(n){let e={};for(let[r,i]of Object.entries(n.children)){let s=e_(i);if(r===B&&s.segments.length===0&&s.hasChildren())for(let[o,a]of Object.entries(s.children))e[o]=a;else(s.segments.length>0||s.hasChildren())&&(e[r]=s)}let t=new Y(n.segments,e);return q0(t)}function q0(n){if(n.numberOfChildren===1&&n.children[B]){let e=n.children[B];return new Y(n.segments.concat(e.segments),e.children)}return n}function Yr(n){return n instanceof vn}function $0(n,e,t=null,r=null){let i=t_(n);return n_(i,e,t,r)}function t_(n){let e;function t(s){let o={};for(let u of s.children){let c=t(u);o[u.outlet]=c}let a=new Y(s.url,o);return s===n&&(e=a),a}let r=t(n.root),i=Zy(r);return e??i}function n_(n,e,t,r){let i=n;for(;i.parent;)i=i.parent;if(e.length===0)return Kl(i,i,i,t,r);let s=z0(e);if(s.toRoot())return Kl(i,i,new Y([],{}),t,r);let o=G0(s,i,n),a=o.processChildren?Is(o.segmentGroup,o.index,s.commands):i_(o.segmentGroup,o.index,s.commands);return Kl(i,o.segmentGroup,a,t,r)}function qa(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function Ss(n){return typeof n=="object"&&n!=null&&n.outlets}function Kl(n,e,t,r,i){let s={};r&&Object.entries(r).forEach(([u,c])=>{s[u]=Array.isArray(c)?c.map(l=>`${l}`):`${c}`});let o;n===e?o=t:o=r_(n,e,t);let a=Zy(e_(o));return new vn(a,s,i)}function r_(n,e,t){let r={};return Object.entries(n.children).forEach(([i,s])=>{s===e?r[i]=t:r[i]=r_(s,e,t)}),new Y(n.segments,r)}var $a=class{constructor(e,t,r){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=r,e&&r.length>0&&qa(r[0]))throw new ae(4003,!1);let i=r.find(Ss);if(i&&i!==Hy(r))throw new ae(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function z0(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new $a(!0,0,n);let e=0,t=!1,r=n.reduce((i,s,o)=>{if(typeof s=="object"&&s!=null){if(s.outlets){let a={};return Object.entries(s.outlets).forEach(([u,c])=>{a[u]=typeof c=="string"?c.split("/"):c}),[...i,{outlets:a}]}if(s.segmentPath)return[...i,s.segmentPath]}return typeof s!="string"?[...i,s]:o===0?(s.split("/").forEach((a,u)=>{u==0&&a==="."||(u==0&&a===""?t=!0:a===".."?e++:a!=""&&i.push(a))}),i):[...i,s]},[]);return new $a(t,e,r)}var Wr=class{constructor(e,t,r){this.segmentGroup=e,this.processChildren=t,this.index=r}};function G0(n,e,t){if(n.isAbsolute)return new Wr(e,!0,0);if(!t)return new Wr(e,!1,NaN);if(t.parent===null)return new Wr(t,!0,0);let r=qa(n.commands[0])?0:1,i=t.segments.length-1+r;return H0(t,i,n.numberOfDoubleDots)}function H0(n,e,t){let r=n,i=e,s=t;for(;s>i;){if(s-=i,r=r.parent,!r)throw new ae(4005,!1);i=r.segments.length}return new Wr(r,!1,i-s)}function W0(n){return Ss(n[0])?n[0].outlets:{[B]:n}}function i_(n,e,t){if(n??=new Y([],{}),n.segments.length===0&&n.hasChildren())return Is(n,e,t);let r=K0(n,e,t),i=t.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){let s=new Y(n.segments.slice(0,r.pathIndex),{});return s.children[B]=new Y(n.segments.slice(r.pathIndex),n.children),Is(s,0,i)}else return r.match&&i.length===0?new Y(n.segments,{}):r.match&&!n.hasChildren()?th(n,e,t):r.match?Is(n,0,i):th(n,e,t)}function Is(n,e,t){if(t.length===0)return new Y(n.segments,{});{let r=W0(t),i={};if(Object.keys(r).some(s=>s!==B)&&n.children[B]&&n.numberOfChildren===1&&n.children[B].segments.length===0){let s=Is(n.children[B],e,t);return new Y(n.segments,s.children)}return Object.entries(r).forEach(([s,o])=>{typeof o=="string"&&(o=[o]),o!==null&&(i[s]=i_(n.children[s],e,o))}),Object.entries(n.children).forEach(([s,o])=>{r[s]===void 0&&(i[s]=o)}),new Y(n.segments,i)}}function K0(n,e,t){let r=0,i=e,s={match:!1,pathIndex:0,commandIndex:0};for(;i<n.segments.length;){if(r>=t.length)return s;let o=n.segments[i],a=t[r];if(Ss(a))break;let u=`${a}`,c=r<t.length-1?t[r+1]:null;if(i>0&&u===void 0)break;if(u&&c&&typeof c=="object"&&c.outlets===void 0){if(!Uy(u,c,o))return s;r+=2}else{if(!Uy(u,{},o))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}function th(n,e,t){let r=n.segments.slice(0,e),i=0;for(;i<t.length;){let s=t[i];if(Ss(s)){let u=Q0(s.outlets);return new Y(r,u)}if(i===0&&qa(t[0])){let u=n.segments[e];r.push(new Yn(u.path,Ly(t[0]))),i++;continue}let o=Ss(s)?s.outlets[B]:`${s}`,a=i<t.length-1?t[i+1]:null;o&&a&&qa(a)?(r.push(new Yn(o,Ly(a))),i+=2):(r.push(new Yn(o,{})),i++)}return new Y(r,{})}function Q0(n){let e={};return Object.entries(n).forEach(([t,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(e[t]=th(new Y([],{}),0,r))}),e}function Ly(n){let e={};return Object.entries(n).forEach(([t,r])=>e[t]=`${r}`),e}function Uy(n,e,t){return n==t.path&&kt(e,t.parameters)}var Ts="imperative",Ce=function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n}(Ce||{}),ut=class{constructor(e,t){this.id=e,this.url=t}},Xr=class extends ut{constructor(e,t,r="imperative",i=null){super(e,t),this.type=Ce.NavigationStart,this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},vt=class extends ut{constructor(e,t,r){super(e,t),this.urlAfterRedirects=r,this.type=Ce.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},et=function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n}(et||{}),za=function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n}(za||{}),wn=class extends ut{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=Ce.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},En=class extends ut{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=Ce.NavigationSkipped}},bs=class extends ut{constructor(e,t,r,i){super(e,t),this.error=r,this.target=i,this.type=Ce.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Ga=class extends ut{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Ce.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},nh=class extends ut{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Ce.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},rh=class extends ut{constructor(e,t,r,i,s){super(e,t),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=s,this.type=Ce.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},ih=class extends ut{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Ce.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},sh=class extends ut{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Ce.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},oh=class{constructor(e){this.route=e,this.type=Ce.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},ah=class{constructor(e){this.route=e,this.type=Ce.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},uh=class{constructor(e){this.snapshot=e,this.type=Ce.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},ch=class{constructor(e){this.snapshot=e,this.type=Ce.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},lh=class{constructor(e){this.snapshot=e,this.type=Ce.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},hh=class{constructor(e){this.snapshot=e,this.type=Ce.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Ha=class{constructor(e,t,r){this.routerEvent=e,this.position=t,this.anchor=r,this.type=Ce.Scroll}toString(){let e=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${e}')`}},Rs=class{},Ds=class{constructor(e){this.url=e}};var dh=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Ms,this.attachRef=null}},Ms=(()=>{let e=class e{constructor(){this.contexts=new Map}onChildOutletCreated(r,i){let s=this.getOrCreateContext(r);s.outlet=i,this.contexts.set(r,s)}onChildOutletDestroyed(r){let i=this.getContext(r);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){let r=this.contexts;return this.contexts=new Map,r}onOutletReAttached(r){this.contexts=r}getOrCreateContext(r){let i=this.getContext(r);return i||(i=new dh,this.contexts.set(r,i)),i}getContext(r){return this.contexts.get(r)||null}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Wa=class{constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=fh(e,this._root);return t?t.children.map(r=>r.value):[]}firstChild(e){let t=fh(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=ph(e,this._root);return t.length<2?[]:t[t.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return ph(e,this._root).map(t=>t.value)}};function fh(n,e){if(n===e.value)return e;for(let t of e.children){let r=fh(n,t);if(r)return r}return null}function ph(n,e){if(n===e.value)return[e];for(let t of e.children){let r=ph(n,t);if(r.length)return r.unshift(e),r}return[]}var Ze=class{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function Hr(n){let e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}var Ka=class extends Wa{constructor(e,t){super(e),this.snapshot=t,Ah(this,e)}toString(){return this.snapshot.toString()}};function s_(n){let e=Y0(n),t=new st([new Yn("",{})]),r=new st({}),i=new st({}),s=new st({}),o=new st(""),a=new Jn(t,r,s,o,i,B,n,e.root);return a.snapshot=e.root,new Ka(new Ze(a,[]),e)}function Y0(n){let e={},t={},r={},i="",s=new Ps([],e,r,i,t,B,n,null,{});return new Qa("",new Ze(s,[]))}var Jn=class{constructor(e,t,r,i,s,o,a,u){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=r,this.fragmentSubject=i,this.dataSubject=s,this.outlet=o,this.component=a,this._futureSnapshot=u,this.title=this.dataSubject?.pipe(F(c=>c[Vs]))??k(void 0),this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(F(e=>Qr(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(F(e=>Qr(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function Th(n,e,t="emptyOnly"){let r,{routeConfig:i}=n;return e!==null&&(t==="always"||i?.path===""||!e.component&&!e.routeConfig?.loadComponent)?r={params:b(b({},e.params),n.params),data:b(b({},e.data),n.data),resolve:b(b(b(b({},n.data),e.data),i?.data),n._resolvedData)}:r={params:b({},n.params),data:b({},n.data),resolve:b(b({},n.data),n._resolvedData??{})},i&&a_(i)&&(r.resolve[Vs]=i.title),r}var Ps=class{get title(){return this.data?.[Vs]}constructor(e,t,r,i,s,o,a,u,c){this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s,this.outlet=o,this.component=a,this.routeConfig=u,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Qr(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Qr(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(r=>r.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},Qa=class extends Wa{constructor(e,t){super(t),this.url=e,Ah(this,t)}toString(){return o_(this._root)}};function Ah(n,e){e.value._routerState=n,e.children.forEach(t=>Ah(n,t))}function o_(n){let e=n.children.length>0?` { ${n.children.map(o_).join(", ")} } `:"";return`${n.value}${e}`}function Ql(n){if(n.snapshot){let e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,kt(e.queryParams,t.queryParams)||n.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&n.fragmentSubject.next(t.fragment),kt(e.params,t.params)||n.paramsSubject.next(t.params),C0(e.url,t.url)||n.urlSubject.next(t.url),kt(e.data,t.data)||n.dataSubject.next(t.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function gh(n,e){let t=kt(n.params,e.params)&&D0(n.url,e.url),r=!n.parent!=!e.parent;return t&&!r&&(!n.parent||gh(n.parent,e.parent))}function a_(n){return typeof n.title=="string"||n.title===null}var X0=(()=>{let e=class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=B,this.activateEvents=new gt,this.deactivateEvents=new gt,this.attachEvents=new gt,this.detachEvents=new gt,this.parentContexts=N(Ms),this.location=N(vm),this.changeDetector=N(us),this.environmentInjector=N(rs),this.inputBinder=N(eu,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(r){if(r.name){let{firstChange:i,previousValue:s}=r.name;if(i)return;this.isTrackedInParentContexts(s)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(s)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(r){return this.parentContexts.getContext(r)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let r=this.parentContexts.getContext(this.name);r?.route&&(r.attachRef?this.attach(r.attachRef,r.route):this.activateWith(r.route,r.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new ae(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new ae(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new ae(4012,!1);this.location.detach();let r=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(r.instance),r}attach(r,i){this.activated=r,this._activatedRoute=i,this.location.insert(r.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(r.instance)}deactivate(){if(this.activated){let r=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(r)}}activateWith(r,i){if(this.isActivated)throw new ae(4013,!1);this._activatedRoute=r;let s=this.location,a=r.snapshot.component,u=this.parentContexts.getOrCreateContext(this.name).children,c=new mh(r,u,s.injector);this.activated=s.createComponent(a,{index:s.length,injector:c,environmentInjector:i??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=qe({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[mn]});let n=e;return n})(),mh=class{constructor(e,t,r){this.route=e,this.childContexts=t,this.parent=r,this.__ngOutletInjector=!0}get(e,t){return e===Jn?this.route:e===Ms?this.childContexts:this.parent.get(e,t)}},eu=new q(""),jy=(()=>{let e=class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(r){this.unsubscribeFromRouteData(r),this.subscribeToRouteData(r)}unsubscribeFromRouteData(r){this.outletDataSubscriptions.get(r)?.unsubscribe(),this.outletDataSubscriptions.delete(r)}subscribeToRouteData(r){let{activatedRoute:i}=r,s=ia([i.queryParams,i.params,i.data]).pipe(pe(([o,a,u],c)=>(u=b(b(b({},o),a),u),c===0?k(u):Promise.resolve(u)))).subscribe(o=>{if(!r.isActivated||!r.activatedComponentRef||r.activatedRoute!==i||i.component===null){this.unsubscribeFromRouteData(r);return}let a=Fm(i.component);if(!a){this.unsubscribeFromRouteData(r);return}for(let{templateName:u}of a.inputs)r.activatedComponentRef.setInput(u,o[u])});this.outletDataSubscriptions.set(r,s)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})();function J0(n,e,t){let r=ks(n,e._root,t?t._root:void 0);return new Ka(r,e)}function ks(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){let r=t.value;r._futureSnapshot=e.value;let i=Z0(n,e,t);return new Ze(r,i)}else{if(n.shouldAttach(e.value)){let s=n.retrieve(e.value);if(s!==null){let o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(a=>ks(n,a)),o}}let r=eC(e.value),i=e.children.map(s=>ks(n,s));return new Ze(r,i)}}function Z0(n,e,t){return e.children.map(r=>{for(let i of t.children)if(n.shouldReuseRoute(r.value,i.value.snapshot))return ks(n,r,i);return ks(n,r)})}function eC(n){return new Jn(new st(n.url),new st(n.params),new st(n.queryParams),new st(n.fragment),new st(n.data),n.outlet,n.component,n)}var u_="ngNavigationCancelingError";function c_(n,e){let{redirectTo:t,navigationBehaviorOptions:r}=Yr(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,i=l_(!1,et.Redirect);return i.url=t,i.navigationBehaviorOptions=r,i}function l_(n,e){let t=new Error(`NavigationCancelingError: ${n||""}`);return t[u_]=!0,t.cancellationCode=e,t}function tC(n){return h_(n)&&Yr(n.url)}function h_(n){return!!n&&n[u_]}var nC=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Or({type:e,selectors:[["ng-component"]],standalone:!0,features:[Pm],decls:1,vars:0,template:function(i,s){i&1&&Hn(0,"router-outlet")},dependencies:[X0],encapsulation:2});let n=e;return n})();function rC(n,e){return n.providers&&!n._injector&&(n._injector=wl(n.providers,e,`Route: ${n.path}`)),n._injector??e}function Ch(n){let e=n.children&&n.children.map(Ch),t=e?te(b({},n),{children:e}):b({},n);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==B&&(t.component=nC),t}function xt(n){return n.outlet||B}function iC(n,e){let t=n.filter(r=>xt(r)===e);return t.push(...n.filter(r=>xt(r)!==e)),t}function Os(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var sC=(n,e,t,r)=>F(i=>(new yh(e,i.targetRouterState,i.currentRouterState,t,r).activate(n),i)),yh=class{constructor(e,t,r,i,s){this.routeReuseStrategy=e,this.futureState=t,this.currState=r,this.forwardEvent=i,this.inputBindingEnabled=s}activate(e){let t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,e),Ql(this.futureState.root),this.activateChildRoutes(t,r,e)}deactivateChildRoutes(e,t,r){let i=Hr(t);e.children.forEach(s=>{let o=s.value.outlet;this.deactivateRoutes(s,i[o],r),delete i[o]}),Object.values(i).forEach(s=>{this.deactivateRouteAndItsChildren(s,r)})}deactivateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(i===s)if(i.component){let o=r.getContext(i.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,r);else s&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=Hr(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);if(r&&r.outlet){let o=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=Hr(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(e,t,r){let i=Hr(t);e.children.forEach(s=>{this.activateRoutes(s,i[s.value.outlet],r),this.forwardEvent(new hh(s.value.snapshot))}),e.children.length&&this.forwardEvent(new ch(e.value.snapshot))}activateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(Ql(i),i===s)if(i.component){let o=r.getOrCreateContext(i.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,r);else if(i.component){let o=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){let a=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),Ql(a.route.value),this.activateChildRoutes(e,null,o.children)}else{let a=Os(i.snapshot);o.attachRef=null,o.route=i,o.injector=a,o.outlet&&o.outlet.activateWith(i,o.injector),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,r)}},Ya=class{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},Kr=class{constructor(e,t){this.component=e,this.route=t}};function oC(n,e,t){let r=n._root,i=e?e._root:null;return ws(r,i,t,[r.value])}function aC(n){let e=n.routeConfig?n.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:n,guards:e}}function Zr(n,e){let t=Symbol(),r=e.get(n,t);return r===t?typeof n=="function"&&!om(n)?n:e.get(n):r}function ws(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=Hr(e);return n.children.forEach(o=>{uC(o,s[o.value.outlet],t,r.concat([o.value]),i),delete s[o.value.outlet]}),Object.entries(s).forEach(([o,a])=>As(a,t.getContext(o),i)),i}function uC(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=n.value,o=e?e.value:null,a=t?t.getContext(n.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){let u=cC(o,s,s.routeConfig.runGuardsAndResolvers);u?i.canActivateChecks.push(new Ya(r)):(s.data=o.data,s._resolvedData=o._resolvedData),s.component?ws(n,e,a?a.children:null,r,i):ws(n,e,t,r,i),u&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new Kr(a.outlet.component,o))}else o&&As(e,a,i),i.canActivateChecks.push(new Ya(r)),s.component?ws(n,null,a?a.children:null,r,i):ws(n,null,t,r,i);return i}function cC(n,e,t){if(typeof t=="function")return t(n,e);switch(t){case"pathParamsChange":return!Xn(n.url,e.url);case"pathParamsOrQueryParamsChange":return!Xn(n.url,e.url)||!kt(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!gh(n,e)||!kt(n.queryParams,e.queryParams);case"paramsChange":default:return!gh(n,e)}}function As(n,e,t){let r=Hr(n),i=n.value;Object.entries(r).forEach(([s,o])=>{i.component?e?As(o,e.children.getContext(s),t):As(o,null,t):As(o,e,t)}),i.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new Kr(e.outlet.component,i)):t.canDeactivateChecks.push(new Kr(null,i)):t.canDeactivateChecks.push(new Kr(null,i))}function Fs(n){return typeof n=="function"}function lC(n){return typeof n=="boolean"}function hC(n){return n&&Fs(n.canLoad)}function dC(n){return n&&Fs(n.canActivate)}function fC(n){return n&&Fs(n.canActivateChild)}function pC(n){return n&&Fs(n.canDeactivate)}function gC(n){return n&&Fs(n.canMatch)}function d_(n){return n instanceof Jg||n?.name==="EmptyError"}var La=Symbol("INITIAL_VALUE");function Jr(){return pe(n=>ia(n.map(e=>e.pipe(Vr(1),Mr(La)))).pipe(F(e=>{for(let t of e)if(t!==!0){if(t===La)return La;if(t===!1||t instanceof vn)return t}return!0}),ot(e=>e!==La),Vr(1)))}function mC(n,e){return Je(t=>{let{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=t;return o.length===0&&s.length===0?k(te(b({},t),{guardsResult:!0})):yC(o,r,i,n).pipe(Je(a=>a&&lC(a)?_C(r,s,n,e):k(a)),F(a=>te(b({},t),{guardsResult:a})))})}function yC(n,e,t,r){return Z(n).pipe(Je(i=>TC(i.component,i.route,t,e,r)),Rt(i=>i!==!0,!0))}function _C(n,e,t,r){return Z(e).pipe(xr(i=>Zg(wC(i.route.parent,r),vC(i.route,r),IC(n,i.path,t),EC(n,i.route,t))),Rt(i=>i!==!0,!0))}function vC(n,e){return n!==null&&e&&e(new lh(n)),k(!0)}function wC(n,e){return n!==null&&e&&e(new uh(n)),k(!0)}function EC(n,e,t){let r=e.routeConfig?e.routeConfig.canActivate:null;if(!r||r.length===0)return k(!0);let i=r.map(s=>dl(()=>{let o=Os(e)??t,a=Zr(s,o),u=dC(a)?a.canActivate(e,n):gn(o,()=>a(e,n));return In(u).pipe(Rt())}));return k(i).pipe(Jr())}function IC(n,e,t){let r=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>aC(o)).filter(o=>o!==null).map(o=>dl(()=>{let a=o.guards.map(u=>{let c=Os(o.node)??t,l=Zr(u,c),h=fC(l)?l.canActivateChild(r,n):gn(c,()=>l(r,n));return In(h).pipe(Rt())});return k(a).pipe(Jr())}));return k(s).pipe(Jr())}function TC(n,e,t,r,i){let s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!s||s.length===0)return k(!0);let o=s.map(a=>{let u=Os(e)??i,c=Zr(a,u),l=pC(c)?c.canDeactivate(n,e,t,r):gn(u,()=>c(n,e,t,r));return In(l).pipe(Rt())});return k(o).pipe(Jr())}function AC(n,e,t,r){let i=e.canLoad;if(i===void 0||i.length===0)return k(!0);let s=i.map(o=>{let a=Zr(o,n),u=hC(a)?a.canLoad(e,t):gn(n,()=>a(e,t));return In(u)});return k(s).pipe(Jr(),f_(r))}function f_(n){return Qg(Ae(e=>{if(Yr(e))throw c_(n,e)}),F(e=>e===!0))}function CC(n,e,t,r){let i=e.canMatch;if(!i||i.length===0)return k(!0);let s=i.map(o=>{let a=Zr(o,n),u=gC(a)?a.canMatch(e,t):gn(n,()=>a(e,t));return In(u)});return k(s).pipe(Jr(),f_(r))}var xs=class{constructor(e){this.segmentGroup=e||null}},Xa=class extends Error{constructor(e){super(),this.urlTree=e}};function Gr(n){return Zi(new xs(n))}function SC(n){return Zi(new ae(4e3,!1))}function bC(n){return Zi(l_(!1,et.GuardRejected))}var _h=class{constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let r=[],i=t.root;for(;;){if(r=r.concat(i.segments),i.numberOfChildren===0)return k(r);if(i.numberOfChildren>1||!i.children[B])return SC(e.redirectTo);i=i.children[B]}}applyRedirectCommands(e,t,r){let i=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,r);if(t.startsWith("/"))throw new Xa(i);return i}applyRedirectCreateUrlTree(e,t,r,i){let s=this.createSegmentGroup(e,t.root,r,i);return new vn(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let r={};return Object.entries(e).forEach(([i,s])=>{if(typeof s=="string"&&s.startsWith(":")){let a=s.substring(1);r[i]=t[a]}else r[i]=s}),r}createSegmentGroup(e,t,r,i){let s=this.createSegments(e,t.segments,r,i),o={};return Object.entries(t.children).forEach(([a,u])=>{o[a]=this.createSegmentGroup(e,u,r,i)}),new Y(s,o)}createSegments(e,t,r,i){return t.map(s=>s.path.startsWith(":")?this.findPosParam(e,s,i):this.findOrReturn(s,r))}findPosParam(e,t,r){let i=r[t.path.substring(1)];if(!i)throw new ae(4001,!1);return i}findOrReturn(e,t){let r=0;for(let i of t){if(i.path===e.path)return t.splice(r),i;r++}return e}},vh={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function RC(n,e,t,r,i){let s=Sh(n,e,t);return s.matched?(r=rC(e,r),CC(r,e,t,i).pipe(F(o=>o===!0?s:b({},vh)))):k(s)}function Sh(n,e,t){if(e.path==="**")return DC(t);if(e.path==="")return e.pathMatch==="full"&&(n.hasChildren()||t.length>0)?b({},vh):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let i=(e.matcher||A0)(t,n,e);if(!i)return b({},vh);let s={};Object.entries(i.posParams??{}).forEach(([a,u])=>{s[a]=u.path});let o=i.consumed.length>0?b(b({},s),i.consumed[i.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:i.consumed,remainingSegments:t.slice(i.consumed.length),parameters:o,positionalParamSegments:i.posParams??{}}}function DC(n){return{matched:!0,parameters:n.length>0?Hy(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function By(n,e,t,r){return t.length>0&&xC(n,t,r)?{segmentGroup:new Y(e,kC(r,new Y(t,n.children))),slicedSegments:[]}:t.length===0&&VC(n,t,r)?{segmentGroup:new Y(n.segments,PC(n,t,r,n.children)),slicedSegments:t}:{segmentGroup:new Y(n.segments,n.children),slicedSegments:t}}function PC(n,e,t,r){let i={};for(let s of t)if(tu(n,e,s)&&!r[xt(s)]){let o=new Y([],{});i[xt(s)]=o}return b(b({},r),i)}function kC(n,e){let t={};t[B]=e;for(let r of n)if(r.path===""&&xt(r)!==B){let i=new Y([],{});t[xt(r)]=i}return t}function xC(n,e,t){return t.some(r=>tu(n,e,r)&&xt(r)!==B)}function VC(n,e,t){return t.some(r=>tu(n,e,r))}function tu(n,e,t){return(n.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function NC(n,e,t,r){return xt(n)!==r&&(r===B||!tu(e,t,n))?!1:Sh(e,n,t).matched}function MC(n,e,t){return e.length===0&&!n.children[t]}var wh=class{};function OC(n,e,t,r,i,s,o="emptyOnly"){return new Eh(n,e,t,r,i,o,s).recognize()}var FC=31,Eh=class{constructor(e,t,r,i,s,o,a){this.injector=e,this.configLoader=t,this.rootComponentType=r,this.config=i,this.urlTree=s,this.paramsInheritanceStrategy=o,this.urlSerializer=a,this.applyRedirects=new _h(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(e){return new ae(4002,`'${e.segmentGroup}'`)}recognize(){let e=By(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(F(t=>{let r=new Ps([],Object.freeze({}),Object.freeze(b({},this.urlTree.queryParams)),this.urlTree.fragment,{},B,this.rootComponentType,null,{}),i=new Ze(r,t),s=new Qa("",i),o=$0(r,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(o),this.inheritParamsAndData(s._root,null),{state:s,tree:o}}))}match(e){return this.processSegmentGroup(this.injector,this.config,e,B).pipe(pt(r=>{if(r instanceof Xa)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof xs?this.noMatchError(r):r}))}inheritParamsAndData(e,t){let r=e.value,i=Th(r,t,this.paramsInheritanceStrategy);r.params=Object.freeze(i.params),r.data=Object.freeze(i.data),e.children.forEach(s=>this.inheritParamsAndData(s,r))}processSegmentGroup(e,t,r,i){return r.segments.length===0&&r.hasChildren()?this.processChildren(e,t,r):this.processSegment(e,t,r,r.segments,i,!0).pipe(F(s=>s instanceof Ze?[s]:[]))}processChildren(e,t,r){let i=[];for(let s of Object.keys(r.children))s==="primary"?i.unshift(s):i.push(s);return Z(i).pipe(xr(s=>{let o=r.children[s],a=iC(t,s);return this.processSegmentGroup(e,a,o,s)}),Nr((s,o)=>(s.push(...o),s)),fl(null),im(),Je(s=>{if(s===null)return Gr(r);let o=p_(s);return LC(o),k(o)}))}processSegment(e,t,r,i,s,o){return Z(t).pipe(xr(a=>this.processSegmentAgainstRoute(a._injector??e,t,a,r,i,s,o).pipe(pt(u=>{if(u instanceof xs)return k(null);throw u}))),Rt(a=>!!a),pt(a=>{if(d_(a))return MC(r,i,s)?k(new wh):Gr(r);throw a}))}processSegmentAgainstRoute(e,t,r,i,s,o,a){return NC(r,i,s,o)?r.redirectTo===void 0?this.matchSegmentAgainstRoute(e,i,r,s,o):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(e,i,t,r,s,o):Gr(i):Gr(i)}expandSegmentAgainstRouteUsingRedirect(e,t,r,i,s,o){let{matched:a,consumedSegments:u,positionalParamSegments:c,remainingSegments:l}=Sh(t,i,s);if(!a)return Gr(t);i.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>FC&&(this.allowRedirects=!1));let h=this.applyRedirects.applyRedirectCommands(u,i.redirectTo,c);return this.applyRedirects.lineralizeSegments(i,h).pipe(Je(d=>this.processSegment(e,r,t,d.concat(l),o,!1)))}matchSegmentAgainstRoute(e,t,r,i,s){let o=RC(t,r,i,e,this.urlSerializer);return r.path==="**"&&(t.children={}),o.pipe(pe(a=>a.matched?(e=r._injector??e,this.getChildConfig(e,r,i).pipe(pe(({routes:u})=>{let c=r._loadedInjector??e,{consumedSegments:l,remainingSegments:h,parameters:d}=a,f=new Ps(l,d,Object.freeze(b({},this.urlTree.queryParams)),this.urlTree.fragment,jC(r),xt(r),r.component??r._loadedComponent??null,r,BC(r)),{segmentGroup:E,slicedSegments:w}=By(t,l,h,u);if(w.length===0&&E.hasChildren())return this.processChildren(c,u,E).pipe(F(D=>D===null?null:new Ze(f,D)));if(u.length===0&&w.length===0)return k(new Ze(f,[]));let _=xt(r)===s;return this.processSegment(c,u,E,w,_?B:s,!0).pipe(F(D=>new Ze(f,D instanceof Ze?[D]:[])))}))):Gr(t)))}getChildConfig(e,t,r){return t.children?k({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?k({routes:t._loadedRoutes,injector:t._loadedInjector}):AC(e,t,r,this.urlSerializer).pipe(Je(i=>i?this.configLoader.loadChildren(e,t).pipe(Ae(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):bC(t))):k({routes:[],injector:e})}};function LC(n){n.sort((e,t)=>e.value.outlet===B?-1:t.value.outlet===B?1:e.value.outlet.localeCompare(t.value.outlet))}function UC(n){let e=n.value.routeConfig;return e&&e.path===""}function p_(n){let e=[],t=new Set;for(let r of n){if(!UC(r)){e.push(r);continue}let i=e.find(s=>r.value.routeConfig===s.value.routeConfig);i!==void 0?(i.children.push(...r.children),t.add(i)):e.push(r)}for(let r of t){let i=p_(r.children);e.push(new Ze(r.value,i))}return e.filter(r=>!t.has(r))}function jC(n){return n.data||{}}function BC(n){return n.resolve||{}}function qC(n,e,t,r,i,s){return Je(o=>OC(n,e,t,r,o.extractedUrl,i,s).pipe(F(({state:a,tree:u})=>te(b({},o),{targetSnapshot:a,urlAfterRedirects:u}))))}function $C(n,e){return Je(t=>{let{targetSnapshot:r,guards:{canActivateChecks:i}}=t;if(!i.length)return k(t);let s=new Set(i.map(u=>u.route)),o=new Set;for(let u of s)if(!o.has(u))for(let c of g_(u))o.add(c);let a=0;return Z(o).pipe(xr(u=>s.has(u)?zC(u,r,n,e):(u.data=Th(u,u.parent,n).resolve,k(void 0))),Ae(()=>a++),pl(1),Je(u=>a===o.size?k(t):dn))})}function g_(n){let e=n.children.map(t=>g_(t)).flat();return[n,...e]}function zC(n,e,t,r){let i=n.routeConfig,s=n._resolve;return i?.title!==void 0&&!a_(i)&&(s[Vs]=i.title),GC(s,n,e,r).pipe(F(o=>(n._resolvedData=o,n.data=Th(n,n.parent,t).resolve,null)))}function GC(n,e,t,r){let i=Jl(n);if(i.length===0)return k({});let s={};return Z(i).pipe(Je(o=>HC(n[o],e,t,r).pipe(Rt(),Ae(a=>{s[o]=a}))),pl(1),nm(s),pt(o=>d_(o)?dn:Zi(o)))}function HC(n,e,t,r){let i=Os(e)??r,s=Zr(n,i),o=s.resolve?s.resolve(e,t):gn(i,()=>s(e,t));return In(o)}function Yl(n){return pe(e=>{let t=n(e);return t?Z(t).pipe(F(()=>e)):k(e)})}var m_=(()=>{let e=class e{buildTitle(r){let i,s=r.root;for(;s!==void 0;)i=this.getResolvedTitleForRoute(s)??i,s=s.children.find(o=>o.outlet===B);return i}getResolvedTitleForRoute(r){return r.data[Vs]}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:()=>N(WC),providedIn:"root"});let n=e;return n})(),WC=(()=>{let e=class e extends m_{constructor(r){super(),this.title=r}updateTitle(r){let i=this.buildTitle(r);i!==void 0&&this.title.setTitle(i)}};e.\u0275fac=function(i){return new(i||e)(R(ry))},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Ls=new q("",{providedIn:"root",factory:()=>({})}),Ja=new q(""),bh=(()=>{let e=class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=N(ma)}loadComponent(r){if(this.componentLoaders.get(r))return this.componentLoaders.get(r);if(r._loadedComponent)return k(r._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(r);let i=In(r.loadComponent()).pipe(F(y_),Ae(o=>{this.onLoadEndListener&&this.onLoadEndListener(r),r._loadedComponent=o}),sa(()=>{this.componentLoaders.delete(r)})),s=new hl(i,()=>new bt).pipe(ll());return this.componentLoaders.set(r,s),s}loadChildren(r,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return k({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);let o=KC(i,this.compiler,r,this.onLoadEndListener).pipe(sa(()=>{this.childrenLoaders.delete(i)})),a=new hl(o,()=>new bt).pipe(ll());return this.childrenLoaders.set(i,a),a}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function KC(n,e,t,r){return In(n.loadChildren()).pipe(F(y_),Je(i=>i instanceof Em||Array.isArray(i)?k(i):Z(e.compileModuleAsync(i))),F(i=>{r&&r(n);let s,o,a=!1;return Array.isArray(i)?(o=i,a=!0):(s=i.create(t).injector,o=s.get(Ja,[],{optional:!0,self:!0}).flat()),{routes:o.map(Ch),injector:s}}))}function QC(n){return n&&typeof n=="object"&&"default"in n}function y_(n){return QC(n)?n.default:n}var Rh=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:()=>N(YC),providedIn:"root"});let n=e;return n})(),YC=(()=>{let e=class e{shouldProcessUrl(r){return!0}extract(r){return r}merge(r,i){return r}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),__=new q(""),v_=new q("");function XC(n,e,t){let r=n.get(v_),i=n.get(_t);return n.get(ue).runOutsideAngular(()=>{if(!i.startViewTransition||r.skipNextTransition)return r.skipNextTransition=!1,Promise.resolve();let s,o=new Promise(c=>{s=c}),a=i.startViewTransition(()=>(s(),JC(n))),{onViewTransitionCreated:u}=r;return u&&gn(n,()=>u({transition:a,from:e,to:t})),o})}function JC(n){return new Promise(e=>{_m(e,{injector:n})})}var Dh=(()=>{let e=class e{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new bt,this.transitionAbortSubject=new bt,this.configLoader=N(bh),this.environmentInjector=N(rs),this.urlSerializer=N(Ns),this.rootContexts=N(Ms),this.location=N(ls),this.inputBindingEnabled=N(eu,{optional:!0})!==null,this.titleStrategy=N(m_),this.options=N(Ls,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=N(Rh),this.createViewTransition=N(__,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>k(void 0),this.rootComponentType=null;let r=s=>this.events.next(new oh(s)),i=s=>this.events.next(new ah(s));this.configLoader.onLoadEndListener=i,this.configLoader.onLoadStartListener=r}complete(){this.transitions?.complete()}handleNavigationRequest(r){let i=++this.navigationId;this.transitions?.next(te(b(b({},this.transitions.value),r),{id:i}))}setupNavigations(r,i,s){return this.transitions=new st({id:0,currentUrlTree:i,currentRawUrl:i,extractedUrl:this.urlHandlingStrategy.extract(i),urlAfterRedirects:this.urlHandlingStrategy.extract(i),rawUrl:i,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Ts,restoredState:null,currentSnapshot:s.snapshot,targetSnapshot:null,currentRouterState:s,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(ot(o=>o.id!==0),F(o=>te(b({},o),{extractedUrl:this.urlHandlingStrategy.extract(o.rawUrl)})),pe(o=>{let a=!1,u=!1;return k(o).pipe(pe(c=>{if(this.navigationId>o.id)return this.cancelNavigationTransition(o,"",et.SupersededByNewNavigation),dn;this.currentTransition=o,this.currentNavigation={id:c.id,initialUrl:c.rawUrl,extractedUrl:c.extractedUrl,trigger:c.source,extras:c.extras,previousNavigation:this.lastSuccessfulNavigation?te(b({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let l=!r.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),h=c.extras.onSameUrlNavigation??r.onSameUrlNavigation;if(!l&&h!=="reload"){let d="";return this.events.next(new En(c.id,this.urlSerializer.serialize(c.rawUrl),d,za.IgnoredSameUrlNavigation)),c.resolve(null),dn}if(this.urlHandlingStrategy.shouldProcessUrl(c.rawUrl))return k(c).pipe(pe(d=>{let f=this.transitions?.getValue();return this.events.next(new Xr(d.id,this.urlSerializer.serialize(d.extractedUrl),d.source,d.restoredState)),f!==this.transitions?.getValue()?dn:Promise.resolve(d)}),qC(this.environmentInjector,this.configLoader,this.rootComponentType,r.config,this.urlSerializer,this.paramsInheritanceStrategy),Ae(d=>{o.targetSnapshot=d.targetSnapshot,o.urlAfterRedirects=d.urlAfterRedirects,this.currentNavigation=te(b({},this.currentNavigation),{finalUrl:d.urlAfterRedirects});let f=new Ga(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(f)}));if(l&&this.urlHandlingStrategy.shouldProcessUrl(c.currentRawUrl)){let{id:d,extractedUrl:f,source:E,restoredState:w,extras:_}=c,D=new Xr(d,this.urlSerializer.serialize(f),E,w);this.events.next(D);let M=s_(this.rootComponentType).snapshot;return this.currentTransition=o=te(b({},c),{targetSnapshot:M,urlAfterRedirects:f,extras:te(b({},_),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=f,k(o)}else{let d="";return this.events.next(new En(c.id,this.urlSerializer.serialize(c.extractedUrl),d,za.IgnoredByUrlHandlingStrategy)),c.resolve(null),dn}}),Ae(c=>{let l=new nh(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(l)}),F(c=>(this.currentTransition=o=te(b({},c),{guards:oC(c.targetSnapshot,c.currentSnapshot,this.rootContexts)}),o)),mC(this.environmentInjector,c=>this.events.next(c)),Ae(c=>{if(o.guardsResult=c.guardsResult,Yr(c.guardsResult))throw c_(this.urlSerializer,c.guardsResult);let l=new rh(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot,!!c.guardsResult);this.events.next(l)}),ot(c=>c.guardsResult?!0:(this.cancelNavigationTransition(c,"",et.GuardRejected),!1)),Yl(c=>{if(c.guards.canActivateChecks.length)return k(c).pipe(Ae(l=>{let h=new ih(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(h)}),pe(l=>{let h=!1;return k(l).pipe($C(this.paramsInheritanceStrategy,this.environmentInjector),Ae({next:()=>h=!0,complete:()=>{h||this.cancelNavigationTransition(l,"",et.NoDataFromResolver)}}))}),Ae(l=>{let h=new sh(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(h)}))}),Yl(c=>{let l=h=>{let d=[];h.routeConfig?.loadComponent&&!h.routeConfig._loadedComponent&&d.push(this.configLoader.loadComponent(h.routeConfig).pipe(Ae(f=>{h.component=f}),F(()=>{})));for(let f of h.children)d.push(...l(f));return d};return ia(l(c.targetSnapshot.root)).pipe(fl(null),Vr(1))}),Yl(()=>this.afterPreactivation()),pe(()=>{let{currentSnapshot:c,targetSnapshot:l}=o,h=this.createViewTransition?.(this.environmentInjector,c.root,l.root);return h?Z(h).pipe(F(()=>o)):k(o)}),F(c=>{let l=J0(r.routeReuseStrategy,c.targetSnapshot,c.currentRouterState);return this.currentTransition=o=te(b({},c),{targetRouterState:l}),this.currentNavigation.targetRouterState=l,o}),Ae(()=>{this.events.next(new Rs)}),sC(this.rootContexts,r.routeReuseStrategy,c=>this.events.next(c),this.inputBindingEnabled),Vr(1),Ae({next:c=>{a=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new vt(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects))),this.titleStrategy?.updateTitle(c.targetRouterState.snapshot),c.resolve(!0)},complete:()=>{a=!0}}),sm(this.transitionAbortSubject.pipe(Ae(c=>{throw c}))),sa(()=>{!a&&!u&&this.cancelNavigationTransition(o,"",et.SupersededByNewNavigation),this.currentTransition?.id===o.id&&(this.currentNavigation=null,this.currentTransition=null)}),pt(c=>{if(u=!0,h_(c))this.events.next(new wn(o.id,this.urlSerializer.serialize(o.extractedUrl),c.message,c.cancellationCode)),tC(c)?this.events.next(new Ds(c.url)):o.resolve(!1);else{this.events.next(new bs(o.id,this.urlSerializer.serialize(o.extractedUrl),c,o.targetSnapshot??void 0));try{o.resolve(r.errorHandler(c))}catch(l){this.options.resolveNavigationPromiseOnError?o.resolve(!1):o.reject(l)}}return dn}))}))}cancelNavigationTransition(r,i,s){let o=new wn(r.id,this.urlSerializer.serialize(r.extractedUrl),i,s);this.events.next(o),r.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function ZC(n){return n!==Ts}var eS=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:()=>N(tS),providedIn:"root"});let n=e;return n})(),Ih=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},tS=(()=>{let e=class e extends Ih{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Fr(e)))(s||e)}})(),e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),w_=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:()=>N(nS),providedIn:"root"});let n=e;return n})(),nS=(()=>{let e=class e extends w_{constructor(){super(...arguments),this.location=N(ls),this.urlSerializer=N(Ns),this.options=N(Ls,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=N(Rh),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new vn,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=s_(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(r){return this.location.subscribe(i=>{i.type==="popstate"&&r(i.url,i.state)})}handleRouterEvent(r,i){if(r instanceof Xr)this.stateMemento=this.createStateMemento();else if(r instanceof En)this.rawUrlTree=i.initialUrl;else if(r instanceof Ga){if(this.urlUpdateStrategy==="eager"&&!i.extras.skipLocationChange){let s=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl);this.setBrowserUrl(s,i)}}else r instanceof Rs?(this.currentUrlTree=i.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl),this.routerState=i.targetRouterState,this.urlUpdateStrategy==="deferred"&&(i.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,i))):r instanceof wn&&(r.code===et.GuardRejected||r.code===et.NoDataFromResolver)?this.restoreHistory(i):r instanceof bs?this.restoreHistory(i,!0):r instanceof vt&&(this.lastSuccessfulId=r.id,this.currentPageId=this.browserPageId)}setBrowserUrl(r,i){let s=this.urlSerializer.serialize(r);if(this.location.isCurrentPathEqualTo(s)||i.extras.replaceUrl){let o=this.browserPageId,a=b(b({},i.extras.state),this.generateNgRouterState(i.id,o));this.location.replaceState(s,"",a)}else{let o=b(b({},i.extras.state),this.generateNgRouterState(i.id,this.browserPageId+1));this.location.go(s,"",o)}}restoreHistory(r,i=!1){if(this.canceledNavigationResolution==="computed"){let s=this.browserPageId,o=this.currentPageId-s;o!==0?this.location.historyGo(o):this.currentUrlTree===r.finalUrl&&o===0&&(this.resetState(r),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(i&&this.resetState(r),this.resetUrlToCurrentUrlTree())}resetState(r){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,r.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(r,i){return this.canceledNavigationResolution==="computed"?{navigationId:r,\u0275routerPageId:i}:{navigationId:r}}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Fr(e)))(s||e)}})(),e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),Es=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.FAILED=1]="FAILED",n[n.REDIRECTING=2]="REDIRECTING",n}(Es||{});function E_(n,e){n.events.pipe(ot(t=>t instanceof vt||t instanceof wn||t instanceof bs||t instanceof En),F(t=>t instanceof vt||t instanceof En?Es.COMPLETE:(t instanceof wn?t.code===et.Redirect||t.code===et.SupersededByNewNavigation:!1)?Es.REDIRECTING:Es.FAILED),ot(t=>t!==Es.REDIRECTING),Vr(1)).subscribe(()=>{e()})}function rS(n){throw n}var iS={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},sS={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},Xt=(()=>{let e=class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=N(da),this.stateManager=N(w_),this.options=N(Ls,{optional:!0})||{},this.pendingTasks=N(Im),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=N(Dh),this.urlSerializer=N(Ns),this.location=N(ls),this.urlHandlingStrategy=N(Rh),this._events=new bt,this.errorHandler=this.options.errorHandler||rS,this.navigated=!1,this.routeReuseStrategy=N(eS),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=N(Ja,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!N(eu,{optional:!0}),this.eventsSubscription=new Kg,this.isNgZoneEnabled=N(ue)instanceof ue&&ue.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:r=>{this.console.warn(r)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let r=this.navigationTransitions.events.subscribe(i=>{try{let s=this.navigationTransitions.currentTransition,o=this.navigationTransitions.currentNavigation;if(s!==null&&o!==null){if(this.stateManager.handleRouterEvent(i,o),i instanceof wn&&i.code!==et.Redirect&&i.code!==et.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof vt)this.navigated=!0;else if(i instanceof Ds){let a=this.urlHandlingStrategy.merge(i.url,s.currentRawUrl),u={info:s.extras.info,skipLocationChange:s.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||ZC(s.source)};this.scheduleNavigation(a,Ts,null,u,{resolve:s.resolve,reject:s.reject,promise:s.promise})}}aS(i)&&this._events.next(i)}catch(s){this.navigationTransitions.transitionAbortSubject.next(s)}});this.eventsSubscription.add(r)}resetRootComponentType(r){this.routerState.root.component=r,this.navigationTransitions.rootComponentType=r}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Ts,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((r,i)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(r,"popstate",i)},0)})}navigateToSyncWithBrowser(r,i,s){let o={replaceUrl:!0},a=s?.navigationId?s:null;if(s){let c=b({},s);delete c.navigationId,delete c.\u0275routerPageId,Object.keys(c).length!==0&&(o.state=c)}let u=this.parseUrl(r);this.scheduleNavigation(u,i,a,o)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(r){this.config=r.map(Ch),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(r,i={}){let{relativeTo:s,queryParams:o,fragment:a,queryParamsHandling:u,preserveFragment:c}=i,l=c?this.currentUrlTree.fragment:a,h=null;switch(u){case"merge":h=b(b({},this.currentUrlTree.queryParams),o);break;case"preserve":h=this.currentUrlTree.queryParams;break;default:h=o||null}h!==null&&(h=this.removeEmptyProps(h));let d;try{let f=s?s.snapshot:this.routerState.snapshot.root;d=t_(f)}catch{(typeof r[0]!="string"||!r[0].startsWith("/"))&&(r=[]),d=this.currentUrlTree.root}return n_(d,r,h,l??null)}navigateByUrl(r,i={skipLocationChange:!1}){let s=Yr(r)?r:this.parseUrl(r),o=this.urlHandlingStrategy.merge(s,this.rawUrlTree);return this.scheduleNavigation(o,Ts,null,i)}navigate(r,i={skipLocationChange:!1}){return oS(r),this.navigateByUrl(this.createUrlTree(r,i),i)}serializeUrl(r){return this.urlSerializer.serialize(r)}parseUrl(r){try{return this.urlSerializer.parse(r)}catch{return this.urlSerializer.parse("/")}}isActive(r,i){let s;if(i===!0?s=b({},iS):i===!1?s=b({},sS):s=i,Yr(r))return Oy(this.currentUrlTree,r,s);let o=this.parseUrl(r);return Oy(this.currentUrlTree,o,s)}removeEmptyProps(r){return Object.entries(r).reduce((i,[s,o])=>(o!=null&&(i[s]=o),i),{})}scheduleNavigation(r,i,s,o,a){if(this.disposed)return Promise.resolve(!1);let u,c,l;a?(u=a.resolve,c=a.reject,l=a.promise):l=new Promise((d,f)=>{u=d,c=f});let h=this.pendingTasks.add();return E_(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(h))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:s,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:r,extras:o,resolve:u,reject:c,promise:l,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),l.catch(d=>Promise.reject(d))}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function oS(n){for(let e=0;e<n.length;e++)if(n[e]==null)throw new ae(4008,!1)}function aS(n){return!(n instanceof Rs)&&!(n instanceof Ds)}var qy=(()=>{let e=class e{constructor(r,i,s,o,a,u){this.router=r,this.route=i,this.tabIndexAttribute=s,this.renderer=o,this.el=a,this.locationStrategy=u,this.href=null,this.commands=null,this.onChanges=new bt,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;let c=a.nativeElement.tagName?.toLowerCase();this.isAnchorElement=c==="a"||c==="area",this.isAnchorElement?this.subscription=r.events.subscribe(l=>{l instanceof vt&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(r){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",r)}ngOnChanges(r){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(r){r!=null?(this.commands=Array.isArray(r)?r:[r],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(r,i,s,o,a){let u=this.urlTree;if(u===null||this.isAnchorElement&&(r!==0||i||s||o||a||typeof this.target=="string"&&this.target!="_self"))return!0;let c={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(u,c),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let r=this.urlTree;this.href=r!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(r)):null;let i=this.href===null?null:gm(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",i)}applyAttributeValue(r,i){let s=this.renderer,o=this.el.nativeElement;i!==null?s.setAttribute(o,r,i):s.removeAttribute(o,r)}get urlTree(){return this.commands===null?null:this.router.createUrlTree(this.commands,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}};e.\u0275fac=function(i){return new(i||e)(Q(Xt),Q(Jn),hm("tabindex"),Q(jr),Q(Ur),Q(cs))},e.\u0275dir=qe({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(i,s){i&1&&Qt("click",function(a){return s.onClick(a.button,a.ctrlKey,a.shiftKey,a.altKey,a.metaKey)}),i&2&&ha("target",s.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[Wt.HasDecoratorInputTransform,"preserveFragment","preserveFragment",Br],skipLocationChange:[Wt.HasDecoratorInputTransform,"skipLocationChange","skipLocationChange",Br],replaceUrl:[Wt.HasDecoratorInputTransform,"replaceUrl","replaceUrl",Br],routerLink:"routerLink"},standalone:!0,features:[wm,mn]});let n=e;return n})(),xV=(()=>{let e=class e{get isActive(){return this._isActive}constructor(r,i,s,o,a){this.router=r,this.element=i,this.renderer=s,this.cdr=o,this.link=a,this.classes=[],this._isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new gt,this.routerEventsSubscription=r.events.subscribe(u=>{u instanceof vt&&this.update()})}ngAfterContentInit(){k(this.links.changes,k(null)).pipe(es()).subscribe(r=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();let r=[...this.links.toArray(),this.link].filter(i=>!!i).map(i=>i.onChanges);this.linkInputChangesSubscription=Z(r).pipe(es()).subscribe(i=>{this._isActive!==this.isLinkActive(this.router)(i)&&this.update()})}set routerLinkActive(r){let i=Array.isArray(r)?r:r.split(" ");this.classes=i.filter(s=>!!s)}ngOnChanges(r){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{let r=this.hasActiveLinks();this.classes.forEach(i=>{r?this.renderer.addClass(this.element.nativeElement,i):this.renderer.removeClass(this.element.nativeElement,i)}),r&&this.ariaCurrentWhenActive!==void 0?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this._isActive!==r&&(this._isActive=r,this.cdr.markForCheck(),this.isActiveChange.emit(r))})}isLinkActive(r){let i=uS(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return s=>{let o=s.urlTree;return o?r.isActive(o,i):!1}}hasActiveLinks(){let r=this.isLinkActive(this.router);return this.link&&r(this.link)||this.links.some(r)}};e.\u0275fac=function(i){return new(i||e)(Q(Xt),Q(Ur),Q(jr),Q(us),Q(qy,8))},e.\u0275dir=qe({type:e,selectors:[["","routerLinkActive",""]],contentQueries:function(i,s,o){if(i&1&&Sm(o,qy,5),i&2){let a;bm(a=Rm())&&(s.links=a)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[mn]});let n=e;return n})();function uS(n){return!!n.paths}var Za=class{};var cS=(()=>{let e=class e{constructor(r,i,s,o,a){this.router=r,this.injector=s,this.preloadingStrategy=o,this.loader=a}setUpPreloading(){this.subscription=this.router.events.pipe(ot(r=>r instanceof vt),xr(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(r,i){let s=[];for(let o of i){o.providers&&!o._injector&&(o._injector=wl(o.providers,r,`Route: ${o.path}`));let a=o._injector??r,u=o._loadedInjector??a;(o.loadChildren&&!o._loadedRoutes&&o.canLoad===void 0||o.loadComponent&&!o._loadedComponent)&&s.push(this.preloadConfig(a,o)),(o.children||o._loadedRoutes)&&s.push(this.processRoutes(u,o.children??o._loadedRoutes))}return Z(s).pipe(es())}preloadConfig(r,i){return this.preloadingStrategy.preload(i,()=>{let s;i.loadChildren&&i.canLoad===void 0?s=this.loader.loadChildren(r,i):s=k(null);let o=s.pipe(Je(a=>a===null?k(void 0):(i._loadedRoutes=a.routes,i._loadedInjector=a.injector,this.processRoutes(a.injector??r,a.routes))));if(i.loadComponent&&!i._loadedComponent){let a=this.loader.loadComponent(i);return Z([o,a]).pipe(es())}else return o})}};e.\u0275fac=function(i){return new(i||e)(R(Xt),R(ma),R(rs),R(Za),R(bh))},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),I_=new q(""),lS=(()=>{let e=class e{constructor(r,i,s,o,a={}){this.urlSerializer=r,this.transitions=i,this.viewportScroller=s,this.zone=o,this.options=a,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},a.scrollPositionRestoration||="disabled",a.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(r=>{r instanceof Xr?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=r.navigationTrigger,this.restoredId=r.restoredState?r.restoredState.navigationId:0):r instanceof vt?(this.lastId=r.id,this.scheduleScrollEvent(r,this.urlSerializer.parse(r.urlAfterRedirects).fragment)):r instanceof En&&r.code===za.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(r,this.urlSerializer.parse(r.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(r=>{r instanceof Ha&&(r.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(r.position):r.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(r.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(r,i){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new Ha(r,this.lastSource==="popstate"?this.store[this.restoredId]:null,i))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}};e.\u0275fac=function(i){mm()},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})();function hS(n){return n.routerState.root}function Us(n,e){return{\u0275kind:n,\u0275providers:e}}function dS(){let n=N(Lr);return e=>{let t=n.get(Cl);if(e!==t.components[0])return;let r=n.get(Xt),i=n.get(T_);n.get(Ph)===1&&r.initialNavigation(),n.get(A_,null,yl.Optional)?.setUpPreloading(),n.get(I_,null,yl.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}var T_=new q("",{factory:()=>new bt}),Ph=new q("",{providedIn:"root",factory:()=>1});function fS(){return Us(2,[{provide:Ph,useValue:0},{provide:Al,multi:!0,deps:[Lr],useFactory:e=>{let t=e.get(jm,Promise.resolve());return()=>t.then(()=>new Promise(r=>{let i=e.get(Xt),s=e.get(T_);E_(i,()=>{r(!0)}),e.get(Dh).afterPreactivation=()=>(r(!0),s.closed?k(void 0):s),i.initialNavigation()}))}}])}function pS(){return Us(3,[{provide:Al,multi:!0,useFactory:()=>{let e=N(Xt);return()=>{e.setUpLocationChangeListener()}}},{provide:Ph,useValue:2}])}var A_=new q("");function gS(n){return Us(0,[{provide:A_,useExisting:cS},{provide:Za,useExisting:n}])}function mS(){return Us(8,[jy,{provide:eu,useExisting:jy}])}function yS(n){let e=[{provide:__,useValue:XC},{provide:v_,useValue:b({skipNextTransition:!!n?.skipInitialTransition},n)}];return Us(9,e)}var $y=new q("ROUTER_FORROOT_GUARD"),_S=[ls,{provide:Ns,useClass:Cs},Xt,Ms,{provide:Jn,useFactory:hS,deps:[Xt]},bh,[]],C_=(()=>{let e=class e{constructor(r){}static forRoot(r,i){return{ngModule:e,providers:[_S,[],{provide:Ja,multi:!0,useValue:r},{provide:$y,useFactory:IS,deps:[[Xt,new Dt,new am]]},{provide:Ls,useValue:i||{}},i?.useHash?wS():ES(),vS(),i?.preloadingStrategy?gS(i.preloadingStrategy).\u0275providers:[],i?.initialNavigation?TS(i):[],i?.bindToComponentInputs?mS().\u0275providers:[],i?.enableViewTransitions?yS().\u0275providers:[],AS()]}}static forChild(r){return{ngModule:e,providers:[{provide:Ja,multi:!0,useValue:r}]}}};e.\u0275fac=function(i){return new(i||e)(R($y,8))},e.\u0275mod=Fe({type:e}),e.\u0275inj=Oe({});let n=e;return n})();function vS(){return{provide:I_,useFactory:()=>{let n=N(Hm),e=N(ue),t=N(Ls),r=N(Dh),i=N(Ns);return t.scrollOffset&&n.setOffset(t.scrollOffset),new lS(i,r,n,e,t)}}}function wS(){return{provide:cs,useClass:qm}}function ES(){return{provide:cs,useClass:Bm}}function IS(n){return"guarded"}function TS(n){return[n.initialNavigation==="disabled"?pS().\u0275providers:[],n.initialNavigation==="enabledBlocking"?fS().\u0275providers:[]]}var zy=new q("");function AS(){return[{provide:zy,useFactory:dS},{provide:Vm,multi:!0,useExisting:zy}]}var CS="firebase",SS="10.11.1";$e(CS,SS,"app");var Jt=new as("ANGULARFIRE2_VERSION");function xh(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var js=(n,e)=>{let t=e?[e]:Aa(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},Vt=class{constructor(){return js(bS)}},bS="app-check";function ei(){}var nu=class{zone;delegate;constructor(e,t=Yg){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},kh=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",ei,{},ei,ei)),t.pipe(Ae({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},er=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new nu(Zone.current)),this.insideAngular=t.run(()=>new nu(Zone.current,ra)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(R(ue))};static \u0275prov=$({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function ru(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function RS(n){return ru().ngZone.runOutsideAngular(()=>n())}function Zn(n){return ru().ngZone.run(()=>n())}function ze(n){return DS(ru())(n)}function DS(n){return function(t){return t=t.lift(new kh(n.ngZone)),t.pipe(Gn(n.outsideAngular),fn(n.insideAngular))}}var PS=(n,e)=>function(){let r=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),Zn(()=>n.apply(void 0,r))},ti=(n,e)=>function(){let t,r=arguments;for(let s=0;s<arguments.length;s++)typeof r[s]=="function"&&(e&&(t||=Zn(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",ei,{},ei,ei))),r[s]=PS(r[s],t));let i=RS(()=>n.apply(this,r));if(!e)if(i instanceof hn){let s=ru();return i.pipe(Gn(s.outsideAngular),fn(s.insideAngular))}else return Zn(()=>i);return i instanceof hn?i.pipe(ze):i instanceof Promise?Zn(()=>new Promise((s,o)=>i.then(a=>Zn(()=>s(a)),a=>Zn(()=>o(a))))):typeof i=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),i.apply(this,arguments)}:Zn(()=>i)};var iu=class{constructor(e){return e}},su=class{constructor(){return Aa()}};var kS=new Map,xS={activated:!1,tokenObservers:[]},VS={initialized:!1,enabled:!1};function wt(n){return kS.get(n)||Object.assign({},xS)}function k_(){return VS}var NS="https://content-firebaseappcheck.googleapis.com/v1";var MS="exchangeDebugToken",b_={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},sN=24*60*60*1e3;var Nh=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return g(this,null,function*(){this.stop();try{this.pending=new Rl,this.pending.promise.catch(t=>{}),yield OS(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Rl,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function OS(n){return new Promise(e=>{setTimeout(e,n)})}var FS={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Tn=new Qm("appCheck","AppCheck",FS);function x_(n){if(!wt(n).activated)throw Tn.create("use-before-activation",{appName:n.name})}function V_(r,i){return g(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let f=yield o.getHeartbeatsHeader();f&&(s["X-Firebase-Client"]=f)}let a={method:"POST",body:JSON.stringify(e),headers:s},u;try{u=yield fetch(n,a)}catch(f){throw Tn.create("fetch-network-error",{originalErrorMessage:f?.message})}if(u.status!==200)throw Tn.create("fetch-status-error",{httpStatus:u.status});let c;try{c=yield u.json()}catch(f){throw Tn.create("fetch-parse-error",{originalErrorMessage:f?.message})}let l=c.ttl.match(/^([\d.]+)(s)$/);if(!l||!l[2]||isNaN(Number(l[1])))throw Tn.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let h=Number(l[1])*1e3,d=Date.now();return{token:c.token,expireTimeMillis:d+h,issuedAtTimeMillis:d}})}function N_(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${NS}/projects/${t}/apps/${r}:${MS}?key=${i}`,body:{debug_token:e}}}var LS="firebase-app-check-database",US=1,Mh="firebase-app-check-store";var ou=null;function jS(){return ou||(ou=new Promise((n,e)=>{try{let t=indexedDB.open(LS,US);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(Tn.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(Mh,{keyPath:"compositeKey"})}}}catch(t){e(Tn.create("storage-open",{originalErrorMessage:t?.message}))}}),ou)}function BS(n,e){return qS($S(n),e)}function qS(n,e){return g(this,null,function*(){let r=(yield jS()).transaction(Mh,"readwrite"),s=r.objectStore(Mh).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=u=>{o()},r.onerror=u=>{var c;a(Tn.create("storage-set",{originalErrorMessage:(c=u.target.error)===null||c===void 0?void 0:c.message}))}})})}function $S(n){return`${n.options.appId}-${n.name}`}var Oh=new Ea("@firebase/app-check");function Vh(n,e){return va()?BS(n,e).catch(t=>{Oh.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function M_(){return k_().enabled}function O_(){return g(this,null,function*(){let n=k_();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var zS={error:"UNKNOWN_ERROR"};function GS(n){return Km.encodeString(JSON.stringify(n),!1)}function Fh(n,e=!1){return g(this,null,function*(){let t=n.app;x_(t);let r=wt(t),i=r.token,s;if(i&&!Bs(i)&&(r.token=void 0,i=void 0),!i){let u=yield r.cachedTokenPromise;u&&(Bs(u)?i=u:yield Vh(t,void 0))}if(!e&&i&&Bs(i))return{token:i.token};let o=!1;if(M_()){r.exchangeTokenPromise||(r.exchangeTokenPromise=V_(N_(t,yield O_()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let u=yield r.exchangeTokenPromise;return yield Vh(t,u),r.token=u,{token:u.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield wt(t).exchangeTokenPromise}catch(u){u.code==="appCheck/throttled"?Oh.warn(u.message):Oh.error(u),s=u}let a;return i?s?Bs(i)?a={token:i.token,internalError:s}:a=D_(s):(a={token:i.token},r.token=i,yield Vh(t,i)):a=D_(s),o&&QS(t,a),a})}function HS(n){return g(this,null,function*(){let e=n.app;x_(e);let{provider:t}=wt(e);if(M_()){let r=yield O_(),{token:i}=yield V_(N_(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function WS(n,e,t,r){let{app:i}=n,s=wt(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Bs(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),R_(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>R_(n))}function F_(n,e){let t=wt(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function R_(n){let{app:e}=n,t=wt(e),r=t.tokenRefresher;r||(r=KS(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function KS(n){let{app:e}=n;return new Nh(()=>g(this,null,function*(){let t=wt(e),r;if(t.token?r=yield Fh(n,!0):r=yield Fh(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=wt(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},b_.RETRIAL_MIN_WAIT,b_.RETRIAL_MAX_WAIT)}function QS(n,e){let t=wt(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function Bs(n){return n.expireTimeMillis-Date.now()>0}function D_(n){return{token:GS(zS),error:n}}var Lh=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=wt(this.app);for(let t of e)F_(this.app,t.next);return Promise.resolve()}};function YS(n,e){return new Lh(n,e)}function XS(n){return{getToken:e=>Fh(n,e),getLimitedUseToken:()=>HS(n),addTokenListener:e=>WS(n,"INTERNAL",e),removeTokenListener:e=>F_(n.app,e)}}var JS="@firebase/app-check",ZS="0.8.3";var eb="app-check",P_="app-check-internal";function tb(){Qn(new Yt(eb,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return YS(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(P_).initialize()})),Qn(new Yt(P_,n=>{let e=n.getProvider("app-check").getImmediate();return XS(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),$e(JS,ZS)}tb();var nb=["localhost","0.0.0.0","127.0.0.1"],yN=typeof window<"u"&&nb.includes(window.location.hostname);var rb="firebase",ib="10.11.1";Ye.registerVersion(rb,ib,"app-compat");var sb=["ngOnDestroy"],j_=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(sb.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let u=a?.[s];return typeof u=="function"?u.bind(a):u?.then?u.then(c=>t.run(()=>c)):t.run(()=>u)});return new Proxy(()=>{},{get:(a,u)=>o[u],apply:(a,u,c)=>o.then(l=>{let h=l?.(...c);return r?.spy?.apply&&r.spy.apply(s,c,h),h})})})});var au=class{constructor(e){return e}},ni=new q("angularfire2.app.options"),ri=new q("angularfire2.app.name");function qs(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=Ye.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>Ye.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;ob("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new au(o)}var ob=(n,...e)=>{Sl()&&typeof console<"u"&&console[n](...e)},ab={provide:au,useFactory:qs,deps:[ni,ue,[new Dt,ri]]},RN=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:ni,useValue:t},{provide:ri,useValue:r}]}}constructor(t){Ye.registerVersion("angularfire",Jt.full,"core"),Ye.registerVersion("angularfire",Jt.full,"app-compat"),Ye.registerVersion("angular",km.full,t.toString())}static \u0275fac=function(r){return new(r||n)(R(mt))};static \u0275mod=Fe({type:n});static \u0275inj=Oe({providers:[ab]})}return n})();function uu(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return ub(i,o)||(U_("error",`${e} was already initialized on the ${t} Firebase App with different settings.${cb?" You may need to reload as Firebase is not HMR aware.":""}`),U_("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function ub(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var cb=typeof module<"u"&&!!module.hot,U_=(n,...e)=>{Sl()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var Uh=new q("angularfire2.auth.use-emulator"),jh=new q("angularfire2.auth.settings"),Bh=new q("angularfire2.auth.tenant-id"),qh=new q("angularfire2.auth.langugage-code"),$h=new q("angularfire2.auth.use-device-language"),zh=new q("angularfire.auth.persistence"),Gh=(n,e,t,r,i,s,o,a)=>uu(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let u=e.runOutsideAngular(()=>n.auth());if(t&&u.useEmulator(...t),r&&(u.tenantId=r),u.languageCode=i,s&&u.useDeviceLanguage(),o)for(let[c,l]of Object.entries(o))u.settings[c]=l;return a&&u.setPersistence(a),u},[t,r,i,s,o,a]),Hh=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,u,c,l,h,d,f){let E=new bt,w=k(void 0).pipe(fn(o.outsideAngular),pe(()=>s.runOutsideAngular(()=>import("./chunk-EUJGYFZR.js"))),F(()=>qs(t,s,r)),F(_=>Gh(_,s,a,c,l,h,u,d)),gl({bufferSize:1,refCount:!1}));if(Kn(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=k(null);else{w.pipe(Rt()).subscribe();let _=w.pipe(pe(C=>C.getRedirectResult().then(V=>V,()=>null)),ze,gl({bufferSize:1,refCount:!1})),D=w.pipe(pe(C=>new hn(V=>({unsubscribe:s.runOutsideAngular(()=>C.onAuthStateChanged(L=>V.next(L),L=>V.error(L),()=>V.complete()))})))),M=w.pipe(pe(C=>new hn(V=>({unsubscribe:s.runOutsideAngular(()=>C.onIdTokenChanged(L=>V.next(L),L=>V.error(L),()=>V.complete()))}))));this.authState=_.pipe(ml(D),Gn(o.outsideAngular),fn(o.insideAngular)),this.user=_.pipe(ml(M),Gn(o.outsideAngular),fn(o.insideAngular)),this.idToken=this.user.pipe(pe(C=>C?Z(C.getIdToken()):k(null))),this.idTokenResult=this.user.pipe(pe(C=>C?Z(C.getIdTokenResult()):k(null))),this.credential=tm(_,E,this.authState.pipe(ot(C=>!C))).pipe(F(C=>C?.user?C:null),Gn(o.outsideAngular),fn(o.insideAngular))}return j_(this,w,s,{spy:{apply:(_,D,M)=>{(_.startsWith("signIn")||_.startsWith("createUser"))&&M.then(C=>E.next(C))}}})}static \u0275fac=function(r){return new(r||n)(R(ni),R(ri,8),R(mt),R(ue),R(er),R(Uh,8),R(jh,8),R(Bh,8),R(qh,8),R($h,8),R(zh,8),R(Vt,8))};static \u0275prov=$({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),$N=(()=>{class n{constructor(){Ye.registerVersion("angularfire",Jt.full,"auth-compat")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=Fe({type:n});static \u0275inj=Oe({providers:[Hh]})}return n})();var hb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},It={},A,pd=pd||{},O=hb||self;function Iu(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function no(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function db(n){return Object.prototype.hasOwnProperty.call(n,Wh)&&n[Wh]||(n[Wh]=++fb)}var Wh="closure_uid_"+(1e9*Math.random()>>>0),fb=0;function pb(n,e,t){return n.call.apply(n.bind,arguments)}function gb(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function Le(n,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Le=pb:Le=gb,Le.apply(null,arguments)}function cu(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function be(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function An(){this.s=this.s,this.o=this.o}var mb=0;An.prototype.s=!1;An.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),mb!=0)&&db(this)};An.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Z_=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function gd(n){let e=n.length;if(0<e){let t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function B_(n,e){for(let t=1;t<arguments.length;t++){let r=arguments[t];if(Iu(r)){let i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function Ue(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}Ue.prototype.h=function(){this.defaultPrevented=!0};var yb=function(){if(!O.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{let t=()=>{};O.addEventListener("test",t,e),O.removeEventListener("test",t,e)}catch{}return n}();function Ks(n){return/^[\s\xa0]*$/.test(n)}function Tu(){var n=O.navigator;return n&&(n=n.userAgent)?n:""}function Nt(n){return Tu().indexOf(n)!=-1}function md(n){return md[" "](n),n}md[" "]=function(){};function _b(n,e){var t=oR;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}var vb=Nt("Opera"),ai=Nt("Trident")||Nt("MSIE"),ev=Nt("Edge"),Jh=ev||ai,tv=Nt("Gecko")&&!(Tu().toLowerCase().indexOf("webkit")!=-1&&!Nt("Edge"))&&!(Nt("Trident")||Nt("MSIE"))&&!Nt("Edge"),wb=Tu().toLowerCase().indexOf("webkit")!=-1&&!Nt("Edge");function nv(){var n=O.document;return n?n.documentMode:void 0}var Zh;e:{if(lu="",hu=function(){var n=Tu();if(tv)return/rv:([^\);]+)(\)|;)/.exec(n);if(ev)return/Edge\/([\d\.]+)/.exec(n);if(ai)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(wb)return/WebKit\/(\S+)/.exec(n);if(vb)return/(?:Version)[ \/]?(\S+)/.exec(n)}(),hu&&(lu=hu?hu[1]:""),ai&&(du=nv(),du!=null&&du>parseFloat(lu))){Zh=String(du);break e}Zh=lu}var lu,hu,du,ed;O.document&&ai?(Kh=nv(),ed=Kh||parseInt(Zh,10)||void 0):ed=void 0;var Kh,Eb=ed;function Qs(n,e){if(Ue.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(tv){e:{try{md(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else t=="mouseover"?e=n.fromElement:t=="mouseout"&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:Ib[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Qs.$.h.call(this)}}be(Qs,Ue);var Ib={2:"touch",3:"pen",4:"mouse"};Qs.prototype.h=function(){Qs.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var ro="closure_listenable_"+(1e6*Math.random()|0),Tb=0;function Ab(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++Tb,this.fa=this.ia=!1}function Au(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function yd(n,e,t){for(let r in n)e.call(t,n[r],r,n)}function Cb(n,e){for(let t in n)e.call(void 0,n[t],t,n)}function rv(n){let e={};for(let t in n)e[t]=n[t];return e}var q_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function iv(n,e){let t,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(t in r)n[t]=r[t];for(let s=0;s<q_.length;s++)t=q_[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Cu(n){this.src=n,this.g={},this.h=0}Cu.prototype.add=function(n,e,t,r,i){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var o=nd(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):(e=new Ab(e,this.src,s,!!r,i),e.ia=t,n.push(e)),e};function td(n,e){var t=e.type;if(t in n.g){var r=n.g[t],i=Z_(r,e),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Au(e),n.g[t].length==0&&(delete n.g[t],n.h--))}}function nd(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}var _d="closure_lm_"+(1e6*Math.random()|0),Qh={};function sv(n,e,t,r,i){if(r&&r.once)return av(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)sv(n,e[s],t,r,i);return null}return t=Ed(t),n&&n[ro]?n.O(e,t,no(r)?!!r.capture:!!r,i):ov(n,e,t,!1,r,i)}function ov(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=no(i)?!!i.capture:!!i,a=wd(n);if(a||(n[_d]=a=new Cu(n)),t=a.add(e,t,r,o,s),t.proxy)return t;if(r=Sb(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)yb||(i=o),i===void 0&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(cv(e.toString()),r);else if(n.addListener&&n.removeListener)n.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return t}function Sb(){function n(t){return e.call(n.src,n.listener,t)}let e=bb;return n}function av(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)av(n,e[s],t,r,i);return null}return t=Ed(t),n&&n[ro]?n.P(e,t,no(r)?!!r.capture:!!r,i):ov(n,e,t,!0,r,i)}function uv(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)uv(n,e[s],t,r,i);else r=no(r)?!!r.capture:!!r,t=Ed(t),n&&n[ro]?(n=n.i,e=String(e).toString(),e in n.g&&(s=n.g[e],t=nd(s,t,r,i),-1<t&&(Au(s[t]),Array.prototype.splice.call(s,t,1),s.length==0&&(delete n.g[e],n.h--)))):n&&(n=wd(n))&&(e=n.g[e.toString()],n=-1,e&&(n=nd(e,t,r,i)),(t=-1<n?e[n]:null)&&vd(t))}function vd(n){if(typeof n!="number"&&n&&!n.fa){var e=n.src;if(e&&e[ro])td(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(cv(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=wd(e))?(td(t,n),t.h==0&&(t.src=null,e[_d]=null)):Au(n)}}}function cv(n){return n in Qh?Qh[n]:Qh[n]="on"+n}function bb(n,e){if(n.fa)n=!0;else{e=new Qs(e,this);var t=n.listener,r=n.la||n.src;n.ia&&vd(n),n=t.call(r,e)}return n}function wd(n){return n=n[_d],n instanceof Cu?n:null}var Yh="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ed(n){return typeof n=="function"?n:(n[Yh]||(n[Yh]=function(e){return n.handleEvent(e)}),n[Yh])}function Se(){An.call(this),this.i=new Cu(this),this.S=this,this.J=null}be(Se,An);Se.prototype[ro]=!0;Se.prototype.removeEventListener=function(n,e,t,r){uv(this,n,e,t,r)};function xe(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,typeof e=="string")e=new Ue(e,n);else if(e instanceof Ue)e.target=e.target||n;else{var i=e;e=new Ue(r,n),iv(e,i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=fu(o,r,!0,e)&&i}if(o=e.g=n,i=fu(o,r,!0,e)&&i,i=fu(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)o=e.g=t[s],i=fu(o,r,!1,e)&&i}Se.prototype.N=function(){if(Se.$.N.call(this),this.i){var n=this.i,e;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)Au(t[r]);delete n.g[e],n.h--}}this.J=null};Se.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)};Se.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};function fu(n,e,t,r){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,u=o.la||o.src;o.ia&&td(n.i,o),i=a.call(u,r)!==!1&&i}}return i&&!r.defaultPrevented}var Id=O.JSON.stringify,rd=class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}};function Rb(){var n=Td;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var id=class{constructor(){this.h=this.g=null}add(e,t){let r=lv.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},lv=new rd(()=>new sd,n=>n.reset()),sd=class{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}};function Db(n){var e=1;n=n.split(":");let t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function Pb(n){O.setTimeout(()=>{throw n},0)}var Ys,Xs=!1,Td=new id,hv=()=>{let n=O.Promise.resolve(void 0);Ys=()=>{n.then(kb)}},kb=()=>{for(var n;n=Rb();){try{n.h.call(n.g)}catch(t){Pb(t)}var e=lv;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}Xs=!1};function Su(n,e){Se.call(this),this.h=n||1,this.g=e||O,this.j=Le(this.qb,this),this.l=Date.now()}be(Su,Se);A=Su.prototype;A.ga=!1;A.T=null;A.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),xe(this,"tick"),this.ga&&(Ad(this),this.start()))}};A.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Ad(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}A.N=function(){Su.$.N.call(this),Ad(this),delete this.g};function Cd(n,e,t){if(typeof n=="function")t&&(n=Le(n,t));else if(n&&typeof n.handleEvent=="function")n=Le(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:O.setTimeout(n,e||0)}function dv(n){n.g=Cd(()=>{n.g=null,n.i&&(n.i=!1,dv(n))},n.j);let e=n.h;n.h=null,n.m.apply(null,e)}var od=class extends An{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:dv(this)}N(){super.N(),this.g&&(O.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function Js(n){An.call(this),this.h=n,this.g={}}be(Js,An);var $_=[];function fv(n,e,t,r){Array.isArray(t)||(t&&($_[0]=t.toString()),t=$_);for(var i=0;i<t.length;i++){var s=sv(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function pv(n){yd(n.g,function(e,t){this.g.hasOwnProperty(t)&&vd(e)},n),n.g={}}Js.prototype.N=function(){Js.$.N.call(this),pv(this)};Js.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function bu(){this.g=!0}bu.prototype.Ea=function(){this.g=!1};function xb(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&h[1]=="type"?o+(l+"="+c+"&"):o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+`
`+t+`
`+o})}function Vb(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+`
`+t+`
`+s+" "+o})}function si(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+Mb(n,t)+(r?" "+r:"")})}function Nb(n,e){n.info(function(){return"TIMEOUT: "+e})}bu.prototype.info=function(){};function Mb(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return Id(t)}catch{return e}}var ir={},z_=null;function Ru(){return z_=z_||new Se}ir.Ta="serverreachability";function gv(n){Ue.call(this,ir.Ta,n)}be(gv,Ue);function Zs(n){let e=Ru();xe(e,new gv(e))}ir.STAT_EVENT="statevent";function mv(n,e){Ue.call(this,ir.STAT_EVENT,n),this.stat=e}be(mv,Ue);function Ge(n){let e=Ru();xe(e,new mv(e,n))}ir.Ua="timingevent";function yv(n,e){Ue.call(this,ir.Ua,n),this.size=e}be(yv,Ue);function io(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return O.setTimeout(function(){n()},e)}var Du={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},_v={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Sd(){}Sd.prototype.h=null;function G_(n){return n.h||(n.h=n.i())}function vv(){}var so={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function bd(){Ue.call(this,"d")}be(bd,Ue);function Rd(){Ue.call(this,"c")}be(Rd,Ue);var ad;function Pu(){}be(Pu,Sd);Pu.prototype.g=function(){return new XMLHttpRequest};Pu.prototype.i=function(){return{}};ad=new Pu;function oo(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new Js(this),this.P=Ob,n=Jh?125:void 0,this.V=new Su(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new wv}function wv(){this.i=null,this.g="",this.h=!1}var Ob=45e3,Ev={},ud={};A=oo.prototype;A.setTimeout=function(n){this.P=n};function cd(n,e,t){n.L=1,n.A=xu(en(e)),n.u=t,n.S=!0,Iv(n,null)}function Iv(n,e){n.G=Date.now(),ao(n),n.B=en(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),Pv(t.i,"t",r),n.o=0,t=n.l.J,n.h=new wv,n.g=Xv(n.l,t?e:null,!n.u),0<n.O&&(n.M=new od(Le(n.Pa,n,n.g),n.O)),fv(n.U,n.g,"readystatechange",n.nb),e=n.I?rv(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),Zs(),xb(n.j,n.v,n.B,n.m,n.W,n.u)}A.nb=function(n){n=n.target;let e=this.M;e&&Mt(n)==3?e.l():this.Pa(n)};A.Pa=function(n){try{if(n==this.g)e:{let l=Mt(this.g);var e=this.g.Ia();let h=this.g.da();if(!(3>l)&&(l!=3||Jh||this.g&&(this.h.h||this.g.ja()||Q_(this.g)))){this.J||l!=4||e==7||(e==8||0>=h?Zs(3):Zs(2)),ku(this);var t=this.g.da();this.ca=t;t:if(Tv(this)){var r=Q_(this.g);n="";var i=r.length,s=Mt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){tr(this),Ws(this);var o="";break t}this.h.i=new O.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=t==200,Vb(this.j,this.v,this.B,this.m,this.W,l,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Ks(a)){var c=a;break t}}c=null}if(t=c)si(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ld(this,t);else{this.i=!1,this.s=3,Ge(12),tr(this),Ws(this);break e}}this.S?(Av(this,l,o),Jh&&this.i&&l==3&&(fv(this.U,this.V,"tick",this.mb),this.V.start())):(si(this.j,this.m,o,null),ld(this,o)),l==4&&tr(this),this.i&&!this.J&&(l==4?Wv(this.l,this):(this.i=!1,ao(this)))}else rR(this.g),t==400&&0<o.indexOf("Unknown SID")?(this.s=3,Ge(12)):(this.s=0,Ge(13)),tr(this),Ws(this)}}}catch{}finally{}};function Tv(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function Av(n,e,t){let r=!0,i;for(;!n.J&&n.o<t.length;)if(i=Fb(n,t),i==ud){e==4&&(n.s=4,Ge(14),r=!1),si(n.j,n.m,null,"[Incomplete Response]");break}else if(i==Ev){n.s=4,Ge(15),si(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}else si(n.j,n.m,i,null),ld(n,i);Tv(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),e!=4||t.length!=0||n.h.h||(n.s=1,Ge(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,e=n.l,e.g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),Nd(e),e.M=!0,Ge(11))):(si(n.j,n.m,t,"[Invalid Chunked Response]"),tr(n),Ws(n))}A.mb=function(){if(this.g){var n=Mt(this.g),e=this.g.ja();this.o<e.length&&(ku(this),Av(this,n,e),this.i&&n!=4&&ao(this))}};function Fb(n,e){var t=n.o,r=e.indexOf(`
`,t);return r==-1?ud:(t=Number(e.substring(t,r)),isNaN(t)?Ev:(r+=1,r+t>e.length?ud:(e=e.slice(r,r+t),n.o=r+t,e)))}A.cancel=function(){this.J=!0,tr(this)};function ao(n){n.Y=Date.now()+n.P,Cv(n,n.P)}function Cv(n,e){if(n.C!=null)throw Error("WatchDog timer not null");n.C=io(Le(n.lb,n),e)}function ku(n){n.C&&(O.clearTimeout(n.C),n.C=null)}A.lb=function(){this.C=null;let n=Date.now();0<=n-this.Y?(Nb(this.j,this.B),this.L!=2&&(Zs(),Ge(17)),tr(this),this.s=2,Ws(this)):Cv(this,this.Y-n)};function Ws(n){n.l.H==0||n.J||Wv(n.l,n)}function tr(n){ku(n);var e=n.M;e&&typeof e.sa=="function"&&e.sa(),n.M=null,Ad(n.V),pv(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function ld(n,e){try{var t=n.l;if(t.H!=0&&(t.g==n||hd(t.i,n))){if(!n.K&&hd(t.i,n)&&t.H==3){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){e:if(!t.u){if(t.g)if(t.g.G+3e3<n.G)_u(t),Mu(t);else break e;Vd(t),Ge(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&t.A==0&&!t.v&&(t.v=io(Le(t.ib,t),6e3));if(1>=Vv(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else nr(t,11)}else if((n.K||t.g==n)&&_u(t),!Ks(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(t.V=c[0],c=c[1],t.H==2)if(c[0]=="c"){t.K=c[1],t.pa=c[2];let l=c[3];l!=null&&(t.ra=l,t.l.info("VER="+t.ra));let h=c[4];h!=null&&(t.Ga=h,t.l.info("SVER="+t.Ga));let d=c[5];d!=null&&typeof d=="number"&&0<d&&(r=1.5*d,t.L=r,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;let f=n.g;if(f){let E=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(E){var s=r.i;s.g||E.indexOf("spdy")==-1&&E.indexOf("quic")==-1&&E.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(Dd(s,s.h),s.h=null))}if(r.F){let w=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;w&&(r.Da=w,ie(r.I,r.F,w))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms")),r=t;var o=n;if(r.wa=Yv(r,r.J?r.pa:null,r.Y),o.K){Nv(r.i,o);var a=o,u=r.L;u&&a.setTimeout(u),a.C&&(ku(a),ao(a)),r.g=o}else Gv(r);0<t.j.length&&Ou(t)}else c[0]!="stop"&&c[0]!="close"||nr(t,7);else t.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?nr(t,7):xd(t):c[0]!="noop"&&t.h&&t.h.Aa(c),t.A=0)}}Zs(4)}catch{}}function Lb(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(Iu(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}e=[],t=0;for(r in n)e[t++]=n[r];return e}function Ub(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(Iu(n)||typeof n=="string"){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(let r in n)e[t++]=r;return e}}}function Sv(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(Iu(n)||typeof n=="string")Array.prototype.forEach.call(n,e,void 0);else for(var t=Ub(n),r=Lb(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}var bv=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function jb(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function rr(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof rr){this.h=n.h,mu(this,n.j),this.s=n.s,this.g=n.g,yu(this,n.m),this.l=n.l;var e=n.i,t=new eo;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),H_(this,t),this.o=n.o}else n&&(e=String(n).match(bv))?(this.h=!1,mu(this,e[1]||"",!0),this.s=Gs(e[2]||""),this.g=Gs(e[3]||"",!0),yu(this,e[4]),this.l=Gs(e[5]||"",!0),H_(this,e[6]||"",!0),this.o=Gs(e[7]||"")):(this.h=!1,this.i=new eo(null,this.h))}rr.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Hs(e,W_,!0),":");var t=this.g;return(t||e=="file")&&(n.push("//"),(e=this.s)&&n.push(Hs(e,W_,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&n.push(":",String(t))),(t=this.l)&&(this.g&&t.charAt(0)!="/"&&n.push("/"),n.push(Hs(t,t.charAt(0)=="/"?$b:qb,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Hs(t,Gb)),n.join("")};function en(n){return new rr(n)}function mu(n,e,t){n.j=t?Gs(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function yu(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function H_(n,e,t){e instanceof eo?(n.i=e,Hb(n.i,n.h)):(t||(e=Hs(e,zb)),n.i=new eo(e,n.h))}function ie(n,e,t){n.i.set(e,t)}function xu(n){return ie(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Gs(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Hs(n,e,t){return typeof n=="string"?(n=encodeURI(n).replace(e,Bb),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Bb(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var W_=/[#\/\?@]/g,qb=/[#\?:]/g,$b=/[#\?]/g,zb=/[#\?@]/g,Gb=/#/g;function eo(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function Cn(n){n.g||(n.g=new Map,n.h=0,n.i&&jb(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}A=eo.prototype;A.add=function(n,e){Cn(this),this.i=null,n=ui(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this};function Rv(n,e){Cn(n),e=ui(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function Dv(n,e){return Cn(n),e=ui(n,e),n.g.has(e)}A.forEach=function(n,e){Cn(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)};A.ta=function(){Cn(this);let n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){let i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t};A.Z=function(n){Cn(this);let e=[];if(typeof n=="string")Dv(this,n)&&(e=e.concat(this.g.get(ui(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e};A.set=function(n,e){return Cn(this),this.i=null,n=ui(this,n),Dv(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};A.get=function(n,e){return n?(n=this.Z(n),0<n.length?String(n[0]):e):e};function Pv(n,e,t){Rv(n,e),0<t.length&&(n.i=null,n.g.set(ui(n,e),gd(t)),n.h+=t.length)}A.toString=function(){if(this.i)return this.i;if(!this.g)return"";let n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];let s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};function ui(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function Hb(n,e){e&&!n.j&&(Cn(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(Rv(this,r),Pv(this,i,t))},n)),n.j=e}var Wb=class{constructor(n,e){this.g=n,this.map=e}};function kv(n){this.l=n||Kb,O.PerformanceNavigationTiming?(n=O.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(O.g&&O.g.Ka&&O.g.Ka()&&O.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Kb=10;function xv(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function Vv(n){return n.h?1:n.g?n.g.size:0}function hd(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function Dd(n,e){n.g?n.g.add(e):n.h=e}function Nv(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}kv.prototype.cancel=function(){if(this.i=Mv(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let n of this.g.values())n.cancel();this.g.clear()}};function Mv(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let e=n.i;for(let t of n.g.values())e=e.concat(t.F);return e}return gd(n.i)}var Qb=class{stringify(n){return O.JSON.stringify(n,void 0)}parse(n){return O.JSON.parse(n,void 0)}};function Yb(){this.g=new Qb}function Xb(n,e,t){let r=t||"";try{Sv(n,function(i,s){let o=i;no(i)&&(o=Id(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function Jb(n,e){let t=new bu;if(O.Image){let r=new Image;r.onload=cu(pu,t,r,"TestLoadImage: loaded",!0,e),r.onerror=cu(pu,t,r,"TestLoadImage: error",!1,e),r.onabort=cu(pu,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=cu(pu,t,r,"TestLoadImage: timeout",!1,e),O.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}function pu(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function uo(n){this.l=n.ec||null,this.j=n.ob||!1}be(uo,Sd);uo.prototype.g=function(){return new Vu(this.l,this.j)};uo.prototype.i=function(n){return function(){return n}}({});function Vu(n,e){Se.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=Pd,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}be(Vu,Se);var Pd=0;A=Vu.prototype;A.open=function(n,e){if(this.readyState!=Pd)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,to(this)};A.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||O).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};A.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,co(this)),this.readyState=Pd};A.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,to(this)),this.g&&(this.readyState=3,to(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof O.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Ov(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function Ov(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}A.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?co(this):to(this),this.readyState==3&&Ov(this)}};A.Za=function(n){this.g&&(this.response=this.responseText=n,co(this))};A.Ya=function(n){this.g&&(this.response=n,co(this))};A.ka=function(){this.g&&co(this)};function co(n){n.readyState=4,n.l=null,n.j=null,n.A=null,to(n)}A.setRequestHeader=function(n,e){this.v.append(n,e)};A.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};A.getAllResponseHeaders=function(){if(!this.h)return"";let n=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,n.push(t[0]+": "+t[1]),t=e.next();return n.join(`\r
`)};function to(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(Vu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var Zb=O.JSON.parse;function he(n){Se.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Fv,this.L=this.M=!1}be(he,Se);var Fv="",eR=/^https?$/i,tR=["POST","PUT"];A=he.prototype;A.Oa=function(n){this.M=n};A.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():ad.g(),this.C=this.u?G_(this.u):G_(ad),this.g.onreadystatechange=Le(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){K_(this,s);return}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let s of r.keys())t.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(t.keys()).find(s=>s.toLowerCase()=="content-type"),i=O.FormData&&n instanceof O.FormData,!(0<=Z_(tR,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{jv(this),0<this.B&&((this.L=nR(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Le(this.ua,this)):this.A=Cd(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){K_(this,s)}};function nR(n){return ai&&typeof n.timeout=="number"&&n.ontimeout!==void 0}A.ua=function(){typeof pd<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,xe(this,"timeout"),this.abort(8))};function K_(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Lv(n),Nu(n)}function Lv(n){n.F||(n.F=!0,xe(n,"complete"),xe(n,"error"))}A.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,xe(this,"complete"),xe(this,"abort"),Nu(this))};A.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Nu(this,!0)),he.$.N.call(this)};A.La=function(){this.s||(this.G||this.v||this.l?Uv(this):this.kb())};A.kb=function(){Uv(this)};function Uv(n){if(n.h&&typeof pd<"u"&&(!n.C[1]||Mt(n)!=4||n.da()!=2)){if(n.v&&Mt(n)==4)Cd(n.La,0,n);else if(xe(n,"readystatechange"),Mt(n)==4){n.h=!1;try{let o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=o===0){var i=String(n.I).match(bv)[1]||null;!i&&O.self&&O.self.location&&(i=O.self.location.protocol.slice(0,-1)),r=!eR.test(i?i.toLowerCase():"")}t=r}if(t)xe(n,"complete"),xe(n,"success");else{n.m=6;try{var s=2<Mt(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",Lv(n)}}finally{Nu(n)}}}}function Nu(n,e){if(n.g){jv(n);let t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||xe(n,"ready");try{t.onreadystatechange=r}catch{}}}function jv(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(O.clearTimeout(n.A),n.A=null)}A.isActive=function(){return!!this.g};function Mt(n){return n.g?n.g.readyState:0}A.da=function(){try{return 2<Mt(this)?this.g.status:-1}catch{return-1}};A.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};A.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),Zb(e)}};function Q_(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case Fv:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function rR(n){let e={};n=(n.g&&2<=Mt(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<n.length;r++){if(Ks(n[r]))continue;var t=Db(n[r]);let i=t[0];if(t=t[1],typeof t!="string")continue;t=t.trim();let s=e[i]||[];e[i]=s,s.push(t)}Cb(e,function(r){return r.join(", ")})}A.Ia=function(){return this.m};A.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function Bv(n){let e="";return yd(n,function(t,r){e+=r,e+=":",e+=t,e+=`\r
`}),e}function kd(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=Bv(t),typeof n=="string"?t!=null&&encodeURIComponent(String(t)):ie(n,e,t))}function $s(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function qv(n){this.Ga=0,this.j=[],this.l=new bu,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=$s("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=$s("baseRetryDelayMs",5e3,n),this.hb=$s("retryDelaySeedMs",1e4,n),this.eb=$s("forwardChannelMaxRetries",2,n),this.xa=$s("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new kv(n&&n.concurrentRequestLimit),this.Ja=new Yb,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}A=qv.prototype;A.ra=8;A.H=1;function xd(n){if($v(n),n.H==3){var e=n.W++,t=en(n.I);if(ie(t,"SID",n.K),ie(t,"RID",e),ie(t,"TYPE","terminate"),lo(n,t),e=new oo(n,n.l,e),e.L=2,e.A=xu(en(t)),t=!1,O.navigator&&O.navigator.sendBeacon)try{t=O.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&O.Image&&(new Image().src=e.A,t=!0),t||(e.g=Xv(e.l,null),e.g.ha(e.A)),e.G=Date.now(),ao(e)}Qv(n)}function Mu(n){n.g&&(Nd(n),n.g.cancel(),n.g=null)}function $v(n){Mu(n),n.u&&(O.clearTimeout(n.u),n.u=null),_u(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&O.clearTimeout(n.m),n.m=null)}function Ou(n){if(!xv(n.i)&&!n.m){n.m=!0;var e=n.Na;Ys||hv(),Xs||(Ys(),Xs=!0),Td.add(e,n),n.C=0}}function iR(n,e){return Vv(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=e.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=io(Le(n.Na,n,e),Kv(n,n.C)),n.C++,!0)}A.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;let i=new oo(this,this.l,n),s=this.s;if(this.U&&(s?(s=rv(s),iv(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){t:{var r=this.j[t];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=t;break e}if(e===4096||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=zv(this,i,e),t=en(this.I),ie(t,"RID",n),ie(t,"CVER",22),this.F&&ie(t,"X-HTTP-Session-Id",this.F),lo(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(Bv(s)))+"&"+e:this.o&&kd(t,this.o,s)),Dd(this.i,i),this.bb&&ie(t,"TYPE","init"),this.P?(ie(t,"$req",e),ie(t,"SID","null"),i.aa=!0,cd(i,t,null)):cd(i,t,e),this.H=2}}else this.H==3&&(n?Y_(this,n):this.j.length==0||xv(this.i)||Y_(this))};function Y_(n,e){var t;e?t=e.m:t=n.W++;let r=en(n.I);ie(r,"SID",n.K),ie(r,"RID",t),ie(r,"AID",n.V),lo(n,r),n.o&&n.s&&kd(r,n.o,n.s),t=new oo(n,n.l,t,n.C+1),n.o===null&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=zv(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),Dd(n.i,t),cd(t,r,e)}function lo(n,e){n.na&&yd(n.na,function(t,r){ie(e,r,t)}),n.h&&Sv({},function(t,r){ie(e,r,t)})}function zv(n,e,t){t=Math.min(n.j.length,t);var r=n.h?Le(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){let o=["count="+t];s==-1?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let u=0;u<t;u++){let c=i[u].g,l=i[u].map;if(c-=s,0>c)s=Math.max(0,i[u].g-100),a=!1;else try{Xb(l,o,"req"+c+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function Gv(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;Ys||hv(),Xs||(Ys(),Xs=!0),Td.add(e,n),n.A=0}}function Vd(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=io(Le(n.Ma,n),Kv(n,n.A)),n.A++,!0)}A.Ma=function(){if(this.u=null,Hv(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=io(Le(this.jb,this),n)}};A.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Ge(10),Mu(this),Hv(this))};function Nd(n){n.B!=null&&(O.clearTimeout(n.B),n.B=null)}function Hv(n){n.g=new oo(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var e=en(n.wa);ie(e,"RID","rpc"),ie(e,"SID",n.K),ie(e,"AID",n.V),ie(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&ie(e,"TO",n.qa),ie(e,"TYPE","xmlhttp"),lo(n,e),n.o&&n.s&&kd(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=xu(en(e)),t.u=null,t.S=!0,Iv(t,n)}A.ib=function(){this.v!=null&&(this.v=null,Mu(this),Vd(this),Ge(19))};function _u(n){n.v!=null&&(O.clearTimeout(n.v),n.v=null)}function Wv(n,e){var t=null;if(n.g==e){_u(n),Nd(n),n.g=null;var r=2}else if(hd(n.i,e))t=e.F,Nv(n.i,e),r=1;else return;if(n.H!=0){if(e.i)if(r==1){t=e.u?e.u.length:0,e=Date.now()-e.G;var i=n.C;r=Ru(),xe(r,new yv(r,t)),Ou(n)}else Gv(n);else if(i=e.s,i==3||i==0&&0<e.ca||!(r==1&&iR(n,e)||r==2&&Vd(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:nr(n,5);break;case 4:nr(n,10);break;case 3:nr(n,6);break;default:nr(n,2)}}}function Kv(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function nr(n,e){if(n.l.info("Error code "+e),e==2){var t=null;n.h&&(t=null);var r=Le(n.pb,n);t||(t=new rr("//www.google.com/images/cleardot.gif"),O.location&&O.location.protocol=="http"||mu(t,"https"),xu(t)),Jb(t.toString(),r)}else Ge(2);n.H=0,n.h&&n.h.za(e),Qv(n),$v(n)}A.pb=function(n){n?(this.l.info("Successfully pinged google.com"),Ge(2)):(this.l.info("Failed to ping google.com"),Ge(1))};function Qv(n){if(n.H=0,n.ma=[],n.h){let e=Mv(n.i);(e.length!=0||n.j.length!=0)&&(B_(n.ma,e),B_(n.ma,n.j),n.i.i.length=0,gd(n.j),n.j.length=0),n.h.ya()}}function Yv(n,e,t){var r=t instanceof rr?en(t):new rr(t);if(r.g!="")e&&(r.g=e+"."+r.g),yu(r,r.m);else{var i=O.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new rr(null);r&&mu(s,r),e&&(s.g=e),i&&yu(s,i),t&&(s.l=t),r=s}return t=n.F,e=n.Da,t&&e&&ie(r,t,e),ie(r,"VER",n.ra),lo(n,r),r}function Xv(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=n.Ha&&!n.va?new he(new uo({ob:t})):new he(n.va),e.Oa(n.J),e}A.isActive=function(){return!!this.h&&this.h.isActive(this)};function Jv(){}A=Jv.prototype;A.Ba=function(){};A.Aa=function(){};A.za=function(){};A.ya=function(){};A.isActive=function(){return!0};A.Va=function(){};function vu(){if(ai&&!(10<=Number(Eb)))throw Error("Environmental error: no available transport.")}vu.prototype.g=function(n,e){return new tt(n,e)};function tt(n,e){Se.call(this),this.g=new qv(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!Ks(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Ks(e)&&(this.g.F=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new ci(this)}be(tt,Se);tt.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;Ge(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=Yv(n,null,n.Y),Ou(n)};tt.prototype.close=function(){xd(this.g)};tt.prototype.u=function(n){var e=this.g;if(typeof n=="string"){var t={};t.__data__=n,n=t}else this.v&&(t={},t.__data__=Id(n),n=t);e.j.push(new Wb(e.fb++,n)),e.H==3&&Ou(e)};tt.prototype.N=function(){this.g.h=null,delete this.j,xd(this.g),delete this.g,tt.$.N.call(this)};function Zv(n){bd.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(let t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}be(Zv,bd);function ew(){Rd.call(this),this.status=1}be(ew,Rd);function ci(n){this.g=n}be(ci,Jv);ci.prototype.Ba=function(){xe(this.g,"a")};ci.prototype.Aa=function(n){xe(this.g,new Zv(n))};ci.prototype.za=function(n){xe(this.g,new ew)};ci.prototype.ya=function(){xe(this.g,"b")};function sR(){this.blockSize=-1}function Et(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}be(Et,sR);Et.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function Xh(n,e,t){t||(t=0);var r=Array(16);if(typeof e=="string")for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;e=n.g[0],t=n.g[1],i=n.g[2];var s=n.g[3],o=e+(s^t&(i^s))+r[0]+3614090360&4294967295;e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[1]+3905402710&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[3]+3250441966&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[4]+4118548399&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[5]+1200080426&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[7]+4249261313&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[8]+1770035416&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[9]+2336552879&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[11]+2304563134&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[12]+1804603682&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[13]+4254626195&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[15]+1236535329&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(i^s&(t^i))+r[1]+4129170786&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[6]+3225465664&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[0]+3921069994&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[5]+3593408605&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[10]+38016083&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[4]+3889429448&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[9]+568446438&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[14]+3275163606&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[8]+1163531501&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[13]+2850285829&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[2]+4243563512&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[12]+2368359562&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(t^i^s)+r[5]+4294588738&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[8]+2272392833&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[14]+4259657740&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[1]+2763975236&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[4]+1272893353&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[10]+3200236656&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[13]+681279174&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[0]+3936430074&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[6]+76029189&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[9]+3654602809&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[12]+3873151461&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[2]+3299628645&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(i^(t|~s))+r[0]+4096336452&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[7]+1126891415&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[5]+4237533241&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[12]+1700485571&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[3]+2399980690&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[1]+2240044497&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[8]+1873313359&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[15]+4264355552&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[13]+1309151649&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[4]+4149444226&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[11]+3174756917&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}Et.prototype.j=function(n,e){e===void 0&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(i==0)for(;s<=t;)Xh(this,n,s),s+=this.blockSize;if(typeof n=="string"){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){Xh(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){Xh(this,r),i=0;break}}this.h=i,this.i+=e};Et.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=t&255,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};function X(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=n[i]|0;r&&s==e||(t[i]=s,r=!1)}this.g=t}var oR={};function Md(n){return-128<=n&&128>n?_b(n,function(e){return new X([e|0],0>e?-1:0)}):new X([n|0],0>n?-1:0)}function Ot(n){if(isNaN(n)||!isFinite(n))return oi;if(0>n)return ke(Ot(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=dd;return new X(e,0)}function tw(n,e){if(n.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(n.charAt(0)=="-")return ke(tw(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=Ot(Math.pow(e,8)),r=oi,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=Ot(Math.pow(e,s)),r=r.R(s).add(Ot(o))):(r=r.R(t),r=r.add(Ot(o)))}return r}var dd=4294967296,oi=Md(0),fd=Md(1),X_=Md(16777216);A=X.prototype;A.ea=function(){if(ct(this))return-ke(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:dd+r)*e,e*=dd}return n};A.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(Zt(this))return"0";if(ct(this))return"-"+ke(this).toString(n);for(var e=Ot(Math.pow(n,6)),t=this,r="";;){var i=Eu(t,e).g;t=wu(t,i.R(e));var s=((0<t.g.length?t.g[0]:t.h)>>>0).toString(n);if(t=i,Zt(t))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};A.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function Zt(n){if(n.h!=0)return!1;for(var e=0;e<n.g.length;e++)if(n.g[e]!=0)return!1;return!0}function ct(n){return n.h==-1}A.X=function(n){return n=wu(this,n),ct(n)?-1:Zt(n)?0:1};function ke(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new X(t,~n.h).add(fd)}A.abs=function(){return ct(this)?ke(this):this};A.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(this.D(i)&65535)+(n.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,t[i]=o<<16|s}return new X(t,t[t.length-1]&-2147483648?-1:0)};function wu(n,e){return n.add(ke(e))}A.R=function(n){if(Zt(this)||Zt(n))return oi;if(ct(this))return ct(n)?ke(this).R(ke(n)):ke(ke(this).R(n));if(ct(n))return ke(this.R(ke(n)));if(0>this.X(X_)&&0>n.X(X_))return Ot(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=n.D(i)>>>16,u=n.D(i)&65535;t[2*r+2*i]+=o*u,gu(t,2*r+2*i),t[2*r+2*i+1]+=s*u,gu(t,2*r+2*i+1),t[2*r+2*i+1]+=o*a,gu(t,2*r+2*i+1),t[2*r+2*i+2]+=s*a,gu(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new X(t,0)};function gu(n,e){for(;(n[e]&65535)!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function zs(n,e){this.g=n,this.h=e}function Eu(n,e){if(Zt(e))throw Error("division by zero");if(Zt(n))return new zs(oi,oi);if(ct(n))return e=Eu(ke(n),e),new zs(ke(e.g),ke(e.h));if(ct(e))return e=Eu(n,ke(e)),new zs(ke(e.g),e.h);if(30<n.g.length){if(ct(n)||ct(e))throw Error("slowDivide_ only works with positive integers.");for(var t=fd,r=e;0>=r.X(n);)t=J_(t),r=J_(r);var i=ii(t,1),s=ii(r,1);for(r=ii(r,2),t=ii(t,2);!Zt(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=ii(r,1),t=ii(t,1)}return e=wu(n,i.R(e)),new zs(i,e)}for(i=oi;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=Math.ceil(Math.log(t)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=Ot(t),o=s.R(e);ct(o)||0<o.X(n);)t-=r,s=Ot(t),o=s.R(e);Zt(s)&&(s=fd),i=i.add(s),n=wu(n,o)}return new zs(i,n)}A.gb=function(n){return Eu(this,n).h};A.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new X(t,this.h&n.h)};A.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new X(t,this.h|n.h)};A.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new X(t,this.h^n.h)};function J_(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new X(t,n.h)}function ii(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new X(i,n.h)}vu.prototype.createWebChannel=vu.prototype.g;tt.prototype.send=tt.prototype.u;tt.prototype.open=tt.prototype.m;tt.prototype.close=tt.prototype.close;Du.NO_ERROR=0;Du.TIMEOUT=8;Du.HTTP_ERROR=6;_v.COMPLETE="complete";vv.EventType=so;so.OPEN="a";so.CLOSE="b";so.ERROR="c";so.MESSAGE="d";Se.prototype.listen=Se.prototype.O;he.prototype.listenOnce=he.prototype.P;he.prototype.getLastError=he.prototype.Sa;he.prototype.getLastErrorCode=he.prototype.Ia;he.prototype.getStatus=he.prototype.da;he.prototype.getResponseJson=he.prototype.Wa;he.prototype.getResponseText=he.prototype.ja;he.prototype.send=he.prototype.ha;he.prototype.setWithCredentials=he.prototype.Oa;Et.prototype.digest=Et.prototype.l;Et.prototype.reset=Et.prototype.reset;Et.prototype.update=Et.prototype.j;X.prototype.add=X.prototype.add;X.prototype.multiply=X.prototype.R;X.prototype.modulo=X.prototype.gb;X.prototype.compare=X.prototype.X;X.prototype.toNumber=X.prototype.ea;X.prototype.toString=X.prototype.toString;X.prototype.getBits=X.prototype.D;X.fromNumber=Ot;X.fromString=tw;var nw=It.createWebChannelTransport=function(){return new vu},rw=It.getStatEventTarget=function(){return Ru()},Fu=It.ErrorCode=Du,iw=It.EventType=_v,sw=It.Event=ir,Od=It.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},ow=It.FetchXmlHttpFactory=uo,ho=It.WebChannel=vv,aw=It.XhrIo=he,uw=It.Md5=Et,sr=It.Integer=X;var cw="@firebase/firestore";var we=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};we.UNAUTHENTICATED=new we(null),we.GOOGLE_CREDENTIALS=new we("google-credentials-uid"),we.FIRST_PARTY=new we("first-party-uid"),we.MOCK_USER=new we("mock-user");var ji="10.11.1";var xn=new Ea("@firebase/firestore");function pi(){return xn.logLevel}function cE(n){xn.setLogLevel(n)}function v(n,...e){if(xn.logLevel<=Pt.DEBUG){let t=e.map(jp);xn.debug(`Firestore (${ji}): ${n}`,...t)}}function ge(n,...e){if(xn.logLevel<=Pt.ERROR){let t=e.map(jp);xn.error(`Firestore (${ji}): ${n}`,...t)}}function ht(n,...e){if(xn.logLevel<=Pt.WARN){let t=e.map(jp);xn.warn(`Firestore (${ji}): ${n}`,...t)}}function jp(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function S(n="Unexpected state"){let e=`FIRESTORE (${ji}) INTERNAL ASSERTION FAILED: `+n;throw ge(e),new Error(e)}function P(n,e){n||S()}function lE(n,e){n||S()}function T(n,e){return n}var m={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},y=class extends wa{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Ee=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Ku=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Bd=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(we.UNAUTHENTICATED))}shutdown(){}},qd=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},$d=class{constructor(e){this.t=e,this.currentUser=we.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.i,i=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve(),s=new Ee;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Ee,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;e.enqueueRetryable(()=>g(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},a=u=>{v("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(u=>a(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?a(u):(v("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Ee)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(v("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(P(typeof r.accessToken=="string"),new Ku(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return P(e===null||typeof e=="string"),new we(e)}},zd=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=we.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Gd=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new zd(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(we.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Hd=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Wd=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){let r=s=>{s.error!=null&&v("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,v("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{v("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):v("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(P(typeof t.token=="string"),this.R=t.token,new Hd(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function aR(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var Qu=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=aR(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}};function U(n,e){return n<e?-1:n>e?1:0}function Ti(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function hE(n){return n+"\0"}var ce=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new y(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new y(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new y(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new y(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?U(this.nanoseconds,e.nanoseconds):U(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var x=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new ce(0,0))}static max(){return new n(new ce(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Yu=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&S(),r===void 0?r=e.length-t:r>e.length-t&&S(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},W=class n extends Yu{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new y(m.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},uR=/^[_a-zA-Z][_a-zA-Z0-9]*$/,me=class n extends Yu{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return uR.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new y(m.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new y(m.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new y(m.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new y(m.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var I=class n{constructor(e){this.path=e}static fromPath(e){return new n(W.fromString(e))}static fromName(e){return new n(W.fromString(e).popFirst(5))}static empty(){return new n(W.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&W.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return W.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new W(e.slice()))}};var Ai=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};function Kd(n){return n.fields.find(e=>e.kind===2)}function ar(n){return n.fields.filter(e=>e.kind!==2)}Ai.UNKNOWN_ID=-1;var wi=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Ao=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,dt.min())}};function dE(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=x.fromTimestamp(r===1e9?new ce(t+1,0):new ce(t,r));return new dt(i,I.empty(),e)}function fE(n){return new dt(n.readTime,n.key,-1)}var dt=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(x.min(),I.empty(),-1)}static max(){return new n(x.max(),I.empty(),-1)}};function Bp(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=I.comparator(n.documentKey,e.documentKey),t!==0?t:U(n.largestBatchId,e.largestBatchId))}var pE="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Xu=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function qn(n){return g(this,null,function*(){if(n.code!==m.FAILED_PRECONDITION||n.message!==pE)throw n;v("LocalStore","Unexpectedly lost primary lease")})}var p=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&S(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let u=0;u<s;u++){let c=u;t(e[c]).next(l=>{o[c]=l,++a,a===s&&r(o)},l=>i(l))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var Ju=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Ee,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new fr(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=qp(r.target.error);this.V.reject(new fr(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new fr(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(v("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new Yd(t)}},Vn=class n{constructor(e,t,r){this.name=e,this.version=t,this.p=r,n.S(hs())===12.2&&ge("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return v("SimpleDb","Removing database:",e),ur(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!va())return!1;if(n.C())return!0;let e=hs(),t=n.S(e),r=0<t&&t<10,i=gE(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.v)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}M(e){return g(this,null,function*(){return this.db||(v("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new fr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new y(m.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new y(m.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new fr(e,o))},i.onupgradeneeded=s=>{v("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.O(o,i.transaction,s.oldVersion,this.version).next(()=>{v("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return g(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(e);let a=Ju.open(this.db,e,s?"readonly":"readwrite",r),u=i(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),p.reject(c))).toPromise();return u.catch(()=>{}),yield a.m,u}catch(a){let u=a,c=u.name!=="FirebaseError"&&o<3;if(v("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),this.close(),!c)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function gE(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var Qd=class{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return ur(this.B.delete())}},fr=class extends y{constructor(e,t){super(m.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function $n(n){return n.name==="IndexedDbTransactionError"}var Yd=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(v("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(v("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),ur(r)}add(e){return v("SimpleDb","ADD",this.store.name,e,e),ur(this.store.add(e))}get(e){return ur(this.store.get(e)).next(t=>(t===void 0&&(t=null),v("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return v("SimpleDb","DELETE",this.store.name,e),ur(this.store.delete(e))}count(){return v("SimpleDb","COUNT",this.store.name),ur(this.store.count())}U(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new p((o,a)=>{s.onerror=u=>{a(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{let s=this.cursor(r),o=[];return this.W(s,(a,u)=>{o.push(u)}).next(()=>o)}}G(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new p((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}j(e,t){v("SimpleDb","DELETE ALL",this.store.name);let r=this.options(e,t);r.H=!1;let i=this.cursor(r);return this.W(i,(s,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.W(i,t)}Y(e){let t=this.cursor({});return new p((r,i)=>{t.onerror=s=>{let o=qp(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){let r=[];return new p((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void i();let u=new Qd(a),c=t(a.primaryKey,a.value,u);if(c instanceof p){let l=c.catch(h=>(u.done(),p.reject(h)));r.push(l)}u.isDone?i():u.K===null?a.continue():a.continue(u.K)}}).next(()=>p.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function ur(n){return new p((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=qp(r.target.error);t(i)}})}var lw=!1;function qp(n){let e=Vn.S(hs());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new y("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return lw||(lw=!0,setTimeout(()=>{throw r},0)),r}}return n}var Xd=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){v("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>g(this,null,function*(){this.task=null;try{v("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){$n(t)?v("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield qn(t)}yield this.X(6e4)}))}},Jd=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return g(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let r=new Set,i=t,s=!0;return p.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return v("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>t-i)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(i,s)).next(a=>(v("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=fE(s);Bp(o,r)>0&&(r=o)}),new dt(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var nt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function Ho(n){return n==null}function Co(n){return n===0&&1/n==-1/0}function mE(n){return typeof n=="number"&&Number.isInteger(n)&&!Co(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function He(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=hw(e)),e=cR(n.get(t),e);return hw(e)}function cR(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function hw(n){return n+""}function Ft(n){let e=n.length;if(P(e>=2),e===2)return P(n.charAt(0)===""&&n.charAt(1)===""),W.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf("",s);switch((o<0||o>t)&&S(),n.charAt(o+1)){case"":let a=n.substring(s,o),u;i.length===0?u=a:(i+=a,u=i,i=""),r.push(u);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:S()}s=o+2}return new W(r)}var dw=["userId","batchId"];function qu(n,e){return[n,He(e)]}function yE(n,e,t){return[n,He(e),t]}var lR={},hR=["prefixPath","collectionGroup","readTime","documentId"],dR=["prefixPath","collectionGroup","documentId"],fR=["collectionGroup","readTime","prefixPath","documentId"],pR=["canonicalId","targetId"],gR=["targetId","path"],mR=["path","targetId"],yR=["collectionId","parent"],_R=["indexId","uid"],vR=["uid","sequenceNumber"],wR=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ER=["indexId","uid","orderedDocumentKey"],IR=["userId","collectionPath","documentId"],TR=["userId","collectionPath","largestBatchId"],AR=["userId","collectionGroup","largestBatchId"],_E=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],CR=[..._E,"documentOverlays"],vE=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],wE=vE,EE=[...wE,"indexConfiguration","indexState","indexEntries"],SR=EE;var So=class extends Xu{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function De(n,e){let t=T(n);return Vn.F(t._e,e)}function fw(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Cr(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function IE(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var se=class n{constructor(e,t){this.comparator=e,this.root=t||Ut.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ut.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ut.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new vi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new vi(this.root,e,this.comparator,!1)}getReverseIterator(){return new vi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new vi(this.root,e,this.comparator,!0)}},vi=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Ut=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw S();let e=this.left.check();if(e!==this.right.check())throw S();return e+(this.isRed()?0:1)}};Ut.EMPTY=null,Ut.RED=!0,Ut.BLACK=!1;Ut.EMPTY=new class{constructor(){this.size=0}get key(){throw S()}get value(){throw S()}get color(){throw S()}get left(){throw S()}get right(){throw S()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Ut(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var ne=class n{constructor(e){this.comparator=e,this.data=new se(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Zu(this.data.getIterator())}getIteratorFrom(e){return new Zu(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Zu=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function li(n){return n.hasNext()?n.getNext():void 0}var rt=class n{constructor(e){this.fields=e,e.sort(me.comparator)}static empty(){return new n([])}unionWith(e){let t=new ne(me.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ti(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var ec=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function TE(){return typeof atob<"u"}var Re=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new ec("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return U(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Re.EMPTY_BYTE_STRING=new Re("");var bR=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function rn(n){if(P(!!n),typeof n=="string"){let e=0,t=bR.exec(n);if(P(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:de(n.seconds),nanos:de(n.nanos)}}function de(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Nn(n){return typeof n=="string"?Re.fromBase64String(n):Re.fromUint8Array(n)}function zc(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function $p(n){let e=n.mapValue.fields.__previous_value__;return zc(e)?$p(e):e}function bo(n){let e=rn(n.mapValue.fields.__local_write_time__.timestampValue);return new ce(e.seconds,e.nanos)}var Zd=class{constructor(e,t,r,i,s,o,a,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}},Mn=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var Pn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},$u={nullValue:"NULL_VALUE"};function pr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?zc(n)?4:AE(n)?9007199254740991:10:S()}function qt(n,e){if(n===e)return!0;let t=pr(n);if(t!==pr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return bo(n).isEqual(bo(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=rn(i.timestampValue),a=rn(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return Nn(i.bytesValue).isEqual(Nn(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return de(i.geoPointValue.latitude)===de(s.geoPointValue.latitude)&&de(i.geoPointValue.longitude)===de(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return de(i.integerValue)===de(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=de(i.doubleValue),a=de(s.doubleValue);return o===a?Co(o)===Co(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Ti(n.arrayValue.values||[],e.arrayValue.values||[],qt);case 10:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(fw(o)!==fw(a))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!qt(o[u],a[u])))return!1;return!0}(n,e);default:return S()}}function Ro(n,e){return(n.values||[]).find(t=>qt(t,e))!==void 0}function On(n,e){if(n===e)return 0;let t=pr(n),r=pr(e);if(t!==r)return U(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return U(n.booleanValue,e.booleanValue);case 2:return function(s,o){let a=de(s.integerValue||s.doubleValue),u=de(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,e);case 3:return pw(n.timestampValue,e.timestampValue);case 4:return pw(bo(n),bo(e));case 5:return U(n.stringValue,e.stringValue);case 6:return function(s,o){let a=Nn(s),u=Nn(o);return a.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){let l=U(a[c],u[c]);if(l!==0)return l}return U(a.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let a=U(de(s.latitude),de(o.latitude));return a!==0?a:U(de(s.longitude),de(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,o){let a=s.values||[],u=o.values||[];for(let c=0;c<a.length&&c<u.length;++c){let l=On(a[c],u[c]);if(l)return l}return U(a.length,u.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===Pn.mapValue&&o===Pn.mapValue)return 0;if(s===Pn.mapValue)return 1;if(o===Pn.mapValue)return-1;let a=s.fields||{},u=Object.keys(a),c=o.fields||{},l=Object.keys(c);u.sort(),l.sort();for(let h=0;h<u.length&&h<l.length;++h){let d=U(u[h],l[h]);if(d!==0)return d;let f=On(a[u[h]],c[l[h]]);if(f!==0)return f}return U(u.length,l.length)}(n.mapValue,e.mapValue);default:throw S()}}function pw(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return U(n,e);let t=rn(n),r=rn(e),i=U(t.seconds,r.seconds);return i!==0?i:U(t.nanos,r.nanos)}function Ci(n){return ef(n)}function ef(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=rn(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Nn(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return I.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=ef(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${ef(t.fields[o])}`;return i+"}"}(n.mapValue):S()}function gr(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function tf(n){return!!n&&"integerValue"in n}function Do(n){return!!n&&"arrayValue"in n}function gw(n){return!!n&&"nullValue"in n}function mw(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function zu(n){return!!n&&"mapValue"in n}function vo(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Cr(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=vo(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=vo(n.arrayValue.values[t]);return e}return Object.assign({},n)}function AE(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function RR(n){return"nullValue"in n?$u:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?gr(Mn.empty(),I.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:S()}function DR(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?gr(Mn.empty(),I.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Pn:S()}function yw(n,e){let t=On(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function _w(n,e){let t=On(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var Be=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!zu(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=vo(t)}setAll(e){let t=me.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=vo(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());zu(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return qt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];zu(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Cr(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(vo(this.value))}};function CE(n){let e=[];return Cr(n.fields,(t,r)=>{let i=new me([t]);if(zu(r)){let s=CE(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new rt(e)}var Ie=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,x.min(),x.min(),x.min(),Be.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,x.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,x.min(),x.min(),Be.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,x.min(),x.min(),Be.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(x.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Be.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Be.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=x.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var $t=class{constructor(e,t){this.position=e,this.inclusive=t}};function vw(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField()?r=I.comparator(I.fromName(o.referenceValue),t.key):r=On(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function ww(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!qt(n.position[t],e.position[t]))return!1;return!0}var mr=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function PR(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var tc=class{},G=class n extends tc{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new sf(e,t,r):t==="array-contains"?new uf(e,r):t==="in"?new nc(e,r):t==="not-in"?new cf(e,r):t==="array-contains-any"?new lf(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new of(e,r):new af(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(On(t,this.value)):t!==null&&pr(this.value)===pr(t)&&this.matchesComparison(On(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return S()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},J=class n extends tc{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new n(e,t)}matches(e){return Si(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function Si(n){return n.op==="and"}function nf(n){return n.op==="or"}function zp(n){return SE(n)&&Si(n)}function SE(n){for(let e of n.filters)if(e instanceof J)return!1;return!0}function rf(n){if(n instanceof G)return n.field.canonicalString()+n.op.toString()+Ci(n.value);if(zp(n))return n.filters.map(e=>rf(e)).join(",");{let e=n.filters.map(t=>rf(t)).join(",");return`${n.op}(${e})`}}function bE(n,e){return n instanceof G?function(r,i){return i instanceof G&&r.op===i.op&&r.field.isEqual(i.field)&&qt(r.value,i.value)}(n,e):n instanceof J?function(r,i){return i instanceof J&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&bE(o,i.filters[a]),!0):!1}(n,e):void S()}function RE(n,e){let t=n.filters.concat(e);return J.create(t,n.op)}function DE(n){return n instanceof G?function(t){return`${t.field.canonicalString()} ${t.op} ${Ci(t.value)}`}(n):n instanceof J?function(t){return t.op.toString()+" {"+t.getFilters().map(DE).join(" ,")+"}"}(n):"Filter"}var sf=class extends G{constructor(e,t,r){super(e,t,r),this.key=I.fromName(r.referenceValue)}matches(e){let t=I.comparator(e.key,this.key);return this.matchesComparison(t)}},of=class extends G{constructor(e,t){super(e,"in",t),this.keys=PE("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},af=class extends G{constructor(e,t){super(e,"not-in",t),this.keys=PE("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function PE(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>I.fromName(r.referenceValue))}var uf=class extends G{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Do(t)&&Ro(t.arrayValue,this.value)}},nc=class extends G{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Ro(this.value.arrayValue,t)}},cf=class extends G{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ro(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Ro(this.value.arrayValue,t)}},lf=class extends G{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Do(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Ro(this.value.arrayValue,r))}};var hf=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ue=null}};function df(n,e=null,t=[],r=[],i=null,s=null,o=null){return new hf(n,e,t,r,i,s,o)}function yr(n){let e=T(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>rf(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),Ho(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ci(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ci(r)).join(",")),e.ue=t}return e.ue}function Wo(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!PR(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!bE(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!ww(n.startAt,e.startAt)&&ww(n.endAt,e.endAt)}function rc(n){return I.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function ic(n,e){return n.filters.filter(t=>t instanceof G&&t.field.isEqual(e))}function Ew(n,e,t){let r=$u,i=!0;for(let s of ic(n,e)){let o=$u,a=!0;switch(s.op){case"<":case"<=":o=RR(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=$u}yw({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];yw({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function Iw(n,e,t){let r=Pn,i=!0;for(let s of ic(n,e)){let o=Pn,a=!0;switch(s.op){case">=":case">":o=DR(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Pn}_w({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];_w({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}var Tt=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function kE(n,e,t,r,i,s,o,a){return new Tt(n,e,t,r,i,s,o,a)}function Bi(n){return new Tt(n)}function Tw(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Gp(n){return n.collectionGroup!==null}function Ei(n){let e=T(n);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new ne(me.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new mr(s,r))}),t.has(me.keyField().canonicalString())||e.ce.push(new mr(me.keyField(),r))}return e.ce}function We(n){let e=T(n);return e.le||(e.le=kR(e,Ei(n))),e.le}function kR(n,e){if(n.limitType==="F")return df(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new mr(i.field,s)});let t=n.endAt?new $t(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new $t(n.startAt.position,n.startAt.inclusive):null;return df(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function ff(n,e){let t=n.filters.concat([e]);return new Tt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function sc(n,e,t){return new Tt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ko(n,e){return Wo(We(n),We(e))&&n.limitType===e.limitType}function xE(n){return`${yr(We(n))}|lt:${n.limitType}`}function gi(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>DE(i)).join(", ")}]`),Ho(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Ci(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Ci(i)).join(",")),`Target(${r})`}(We(n))}; limitType=${n.limitType})`}function Qo(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):I.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of Ei(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,a,u){let c=vw(o,a,u);return o.inclusive?c<=0:c<0}(r.startAt,Ei(r),i)||r.endAt&&!function(o,a,u){let c=vw(o,a,u);return o.inclusive?c>=0:c>0}(r.endAt,Ei(r),i))}(n,e)}function VE(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function NE(n){return(e,t)=>{let r=!1;for(let i of Ei(n)){let s=xR(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function xR(n,e,t){let r=n.field.isKeyField()?I.comparator(e.key,t.key):function(s,o,a){let u=o.data.field(s),c=a.data.field(s);return u!==null&&c!==null?On(u,c):S()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return S()}}var zt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Cr(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return IE(this.inner)}size(){return this.innerSize}};var VR=new se(I.comparator);function Xe(){return VR}var ME=new se(I.comparator);function yo(...n){let e=ME;for(let t of n)e=e.insert(t.key,t);return e}function OE(n){let e=ME;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Lt(){return wo()}function FE(){return wo()}function wo(){return new zt(n=>n.toString(),(n,e)=>n.isEqual(e))}var NR=new se(I.comparator),MR=new ne(I.comparator);function j(...n){let e=MR;for(let t of n)e=e.add(t);return e}var OR=new ne(U);function Hp(){return OR}function LE(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Co(e)?"-0":e}}function UE(n){return{integerValue:""+n}}function jE(n,e){return mE(e)?UE(e):LE(n,e)}var bi=class{constructor(){this._=void 0}};function FR(n,e,t){return n instanceof Fn?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&zc(s)&&(s=$p(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof sn?qE(n,e):n instanceof on?$E(n,e):function(i,s){let o=BE(i,s),a=Aw(o)+Aw(i.Pe);return tf(o)&&tf(i.Pe)?UE(a):LE(i.serializer,a)}(n,e)}function LR(n,e,t){return n instanceof sn?qE(n,e):n instanceof on?$E(n,e):t}function BE(n,e){return n instanceof Ln?function(r){return tf(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var Fn=class extends bi{},sn=class extends bi{constructor(e){super(),this.elements=e}};function qE(n,e){let t=zE(e);for(let r of n.elements)t.some(i=>qt(i,r))||t.push(r);return{arrayValue:{values:t}}}var on=class extends bi{constructor(e){super(),this.elements=e}};function $E(n,e){let t=zE(e);for(let r of n.elements)t=t.filter(i=>!qt(i,r));return{arrayValue:{values:t}}}var Ln=class extends bi{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function Aw(n){return de(n.integerValue||n.doubleValue)}function zE(n){return Do(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var _r=class{constructor(e,t){this.field=e,this.transform=t}};function UR(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof sn&&i instanceof sn||r instanceof on&&i instanceof on?Ti(r.elements,i.elements,qt):r instanceof Ln&&i instanceof Ln?qt(r.Pe,i.Pe):r instanceof Fn&&i instanceof Fn}(n.transform,e.transform)}var pf=class{constructor(e,t){this.version=e,this.transformResults=t}},fe=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Gu(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Ri=class{};function GE(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new jn(n.key,fe.none()):new Un(n.key,n.data,fe.none());{let t=n.data,r=Be.empty(),i=new ne(me.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new At(n.key,r,new rt(i.toArray()),fe.none())}}function jR(n,e,t){n instanceof Un?function(i,s,o){let a=i.value.clone(),u=Sw(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof At?function(i,s,o){if(!Gu(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=Sw(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(HE(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Eo(n,e,t,r){return n instanceof Un?function(s,o,a,u){if(!Gu(s.precondition,o))return a;let c=s.value.clone(),l=bw(s.fieldTransforms,u,o);return c.setAll(l),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof At?function(s,o,a,u){if(!Gu(s.precondition,o))return a;let c=bw(s.fieldTransforms,u,o),l=o.data;return l.setAll(HE(s)),l.setAll(c),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,e,t,r):function(s,o,a){return Gu(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function BR(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=BE(r.transform,i||null);s!=null&&(t===null&&(t=Be.empty()),t.set(r.field,s))}return t||null}function Cw(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Ti(r,i,(s,o)=>UR(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var Un=class extends Ri{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},At=class extends Ri{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function HE(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function Sw(n,e,t){let r=new Map;P(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,LR(o,a,t[i]))}return r}function bw(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,FR(s,o,e))}return r}var jn=class extends Ri{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Po=class extends Ri{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var ko=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&jR(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Eo(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Eo(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=FE();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let u=GE(o,a);u!==null&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(x.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),j())}isEqual(e){return this.batchId===e.batchId&&Ti(this.mutations,e.mutations,(t,r)=>Cw(t,r))&&Ti(this.baseMutations,e.baseMutations,(t,r)=>Cw(t,r))}},gf=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){P(e.mutations.length===r.length);let i=function(){return NR}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var xo=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var mf=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var _e,H;function WE(n){switch(n){default:return S();case m.CANCELLED:case m.UNKNOWN:case m.DEADLINE_EXCEEDED:case m.RESOURCE_EXHAUSTED:case m.INTERNAL:case m.UNAVAILABLE:case m.UNAUTHENTICATED:return!1;case m.INVALID_ARGUMENT:case m.NOT_FOUND:case m.ALREADY_EXISTS:case m.PERMISSION_DENIED:case m.FAILED_PRECONDITION:case m.ABORTED:case m.OUT_OF_RANGE:case m.UNIMPLEMENTED:case m.DATA_LOSS:return!0}}function KE(n){if(n===void 0)return ge("GRPC error has no .code"),m.UNKNOWN;switch(n){case _e.OK:return m.OK;case _e.CANCELLED:return m.CANCELLED;case _e.UNKNOWN:return m.UNKNOWN;case _e.DEADLINE_EXCEEDED:return m.DEADLINE_EXCEEDED;case _e.RESOURCE_EXHAUSTED:return m.RESOURCE_EXHAUSTED;case _e.INTERNAL:return m.INTERNAL;case _e.UNAVAILABLE:return m.UNAVAILABLE;case _e.UNAUTHENTICATED:return m.UNAUTHENTICATED;case _e.INVALID_ARGUMENT:return m.INVALID_ARGUMENT;case _e.NOT_FOUND:return m.NOT_FOUND;case _e.ALREADY_EXISTS:return m.ALREADY_EXISTS;case _e.PERMISSION_DENIED:return m.PERMISSION_DENIED;case _e.FAILED_PRECONDITION:return m.FAILED_PRECONDITION;case _e.ABORTED:return m.ABORTED;case _e.OUT_OF_RANGE:return m.OUT_OF_RANGE;case _e.UNIMPLEMENTED:return m.UNIMPLEMENTED;case _e.DATA_LOSS:return m.DATA_LOSS;default:return S()}}(H=_e||(_e={}))[H.OK=0]="OK",H[H.CANCELLED=1]="CANCELLED",H[H.UNKNOWN=2]="UNKNOWN",H[H.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",H[H.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",H[H.NOT_FOUND=5]="NOT_FOUND",H[H.ALREADY_EXISTS=6]="ALREADY_EXISTS",H[H.PERMISSION_DENIED=7]="PERMISSION_DENIED",H[H.UNAUTHENTICATED=16]="UNAUTHENTICATED",H[H.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",H[H.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",H[H.ABORTED=10]="ABORTED",H[H.OUT_OF_RANGE=11]="OUT_OF_RANGE",H[H.UNIMPLEMENTED=12]="UNIMPLEMENTED",H[H.INTERNAL=13]="INTERNAL",H[H.UNAVAILABLE=14]="UNAVAILABLE",H[H.DATA_LOSS=15]="DATA_LOSS";var Rw=null;function QE(){return new TextEncoder}var qR=new sr([4294967295,4294967295],0);function Dw(n){let e=QE().encode(n),t=new uw;return t.update(e),new Uint8Array(t.digest())}function Pw(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new sr([t,r],0),new sr([i,s],0)]}var yf=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new dr(`Invalid padding: ${t}`);if(r<0)throw new dr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new dr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new dr(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=sr.fromNumber(this.Ie)}Ee(e,t,r){let i=e.add(t.multiply(sr.fromNumber(r)));return i.compare(qR)===1&&(i=new sr([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=Dw(e),[r,i]=Pw(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);if(!this.de(o))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;let t=Dw(e),[r,i]=Pw(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},dr=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Vo=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,No.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(x.min(),i,new se(U),Xe(),j())}},No=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,j(),j(),j())}};var Ii=class{constructor(e,t,r,i){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=i}},oc=class{constructor(e,t){this.targetId=e,this.me=t}},ac=class{constructor(e,t,r=Re.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},uc=class{constructor(){this.fe=0,this.ge=xw(),this.pe=Re.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=j(),t=j(),r=j();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:S()}}),new No(this.pe,this.ye,e,t,r)}ve(){this.we=!1,this.ge=xw()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,P(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},_f=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=Xe(),this.qe=kw(),this.Qe=new se(U)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.ve(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:S()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,i)=>{this.ze(i)&&t(i)})}He(e){let t=e.targetId,r=e.me.count,i=this.Je(t);if(i){let s=i.target;if(rc(s))if(r===0){let o=new I(s.path);this.Ue(t,o,Ie.newNoDocument(o,x.min()))}else P(r===1);else{let o=this.Ye(t);if(o!==r){let a=this.Ze(e),u=a?this.Xe(a,e,o):1;if(u!==0){this.je(t);let c=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}Rw?.et(function(l,h,d,f,E){var w,_,D,M,C,V;let L={localCacheCount:l,existenceFilterCount:h.count,databaseId:d.database,projectId:d.projectId},z=h.unchangedNames;return z&&(L.bloomFilter={applied:E===0,hashCount:(w=z?.hashCount)!==null&&w!==void 0?w:0,bitmapLength:(M=(D=(_=z?.bits)===null||_===void 0?void 0:_.bitmap)===null||D===void 0?void 0:D.length)!==null&&M!==void 0?M:0,padding:(V=(C=z?.bits)===null||C===void 0?void 0:C.padding)!==null&&V!==void 0?V:0,mightContain:le=>{var Qe;return(Qe=f?.mightContain(le))!==null&&Qe!==void 0&&Qe}}),L}(o,e.me,this.Le.tt(),a,u))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o,a;try{o=Nn(r).toUint8Array()}catch(u){if(u instanceof ec)return ht("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new yf(o,i,s)}catch(u){return ht(u instanceof dr?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){let r=this.Le.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,s,null),i++)}),i}rt(e){let t=new Map;this.Be.forEach((s,o)=>{let a=this.Je(o);if(a){if(s.current&&rc(a.target)){let u=new I(a.target.path);this.ke.get(u)!==null||this.it(o,u)||this.Ue(o,u,Ie.newNoDocument(u,e))}s.be&&(t.set(o,s.Ce()),s.ve())}});let r=j();this.qe.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{let c=this.Je(u);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));let i=new Vo(e,t,this.Qe,this.ke,r);return this.ke=Xe(),this.qe=kw(),this.Qe=new se(U),i}$e(e,t){if(!this.ze(e))return;let r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new uc,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new ne(U),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||v("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new uc),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function kw(){return new se(I.comparator)}function xw(){return new se(I.comparator)}var $R={asc:"ASCENDING",desc:"DESCENDING"},zR={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},GR={and:"AND",or:"OR"},vf=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function wf(n,e){return n.useProto3Json||Ho(e)?e:{value:e}}function Di(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function YE(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function HR(n,e){return Di(n,e.toTimestamp())}function ye(n){return P(!!n),x.fromTimestamp(function(t){let r=rn(t);return new ce(r.seconds,r.nanos)}(n))}function Wp(n,e){return Ef(n,e).canonicalString()}function Ef(n,e){let t=function(i){return new W(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function XE(n){let e=W.fromString(n);return P(aI(e)),e}function Mo(n,e){return Wp(n.databaseId,e.path)}function jt(n,e){let t=XE(e);if(t.get(1)!==n.databaseId.projectId)throw new y(m.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new y(m.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new I(eI(t))}function JE(n,e){return Wp(n.databaseId,e)}function ZE(n){let e=XE(n);return e.length===4?W.emptyPath():eI(e)}function If(n){return new W(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function eI(n){return P(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Vw(n,e,t){return{name:Mo(n,e),fields:t.value.mapValue.fields}}function tI(n,e,t){let r=jt(n,e.name),i=ye(e.updateTime),s=e.createTime?ye(e.createTime):x.min(),o=new Be({mapValue:{fields:e.fields}}),a=Ie.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function WR(n,e){return"found"in e?function(r,i){P(!!i.found),i.found.name,i.found.updateTime;let s=jt(r,i.found.name),o=ye(i.found.updateTime),a=i.found.createTime?ye(i.found.createTime):x.min(),u=new Be({mapValue:{fields:i.found.fields}});return Ie.newFoundDocument(s,o,a,u)}(n,e):"missing"in e?function(r,i){P(!!i.missing),P(!!i.readTime);let s=jt(r,i.missing),o=ye(i.readTime);return Ie.newNoDocument(s,o)}(n,e):S()}function KR(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:S()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(c,l){return c.useProto3Json?(P(l===void 0||typeof l=="string"),Re.fromBase64String(l||"")):(P(l===void 0||l instanceof Buffer||l instanceof Uint8Array),Re.fromUint8Array(l||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){let l=c.code===void 0?m.UNKNOWN:KE(c.code);return new y(l,c.message||"")}(o);t=new ac(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=jt(n,r.document.name),s=ye(r.document.updateTime),o=r.document.createTime?ye(r.document.createTime):x.min(),a=new Be({mapValue:{fields:r.document.fields}}),u=Ie.newFoundDocument(i,s,o,a),c=r.targetIds||[],l=r.removedTargetIds||[];t=new Ii(c,l,u.key,u)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=jt(n,r.document),s=r.readTime?ye(r.readTime):x.min(),o=Ie.newNoDocument(i,s),a=r.removedTargetIds||[];t=new Ii([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=jt(n,r.document),s=r.removedTargetIds||[];t=new Ii([],s,i,null)}else{if(!("filter"in e))return S();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new mf(i,s),a=r.targetId;t=new oc(a,o)}}return t}function Oo(n,e){let t;if(e instanceof Un)t={update:Vw(n,e.key,e.value)};else if(e instanceof jn)t={delete:Mo(n,e.key)};else if(e instanceof At)t={update:Vw(n,e.key,e.data),updateMask:eD(e.fieldMask)};else{if(!(e instanceof Po))return S();t={verify:Mo(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){let a=o.transform;if(a instanceof Fn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof sn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof on)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Ln)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw S()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:HR(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:S()}(n,e.precondition)),t}function Tf(n,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?fe.updateTime(ye(s.updateTime)):s.exists!==void 0?fe.exists(s.exists):fe.none()}(e.currentDocument):fe.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let u=null;if("setToServerValue"in a)P(a.setToServerValue==="REQUEST_TIME"),u=new Fn;else if("appendMissingElements"in a){let l=a.appendMissingElements.values||[];u=new sn(l)}else if("removeAllFromArray"in a){let l=a.removeAllFromArray.values||[];u=new on(l)}else"increment"in a?u=new Ln(o,a.increment):S();let c=me.fromServerFormat(a.fieldPath);return new _r(c,u)}(n,i)):[];if(e.update){e.update.name;let i=jt(n,e.update.name),s=new Be({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(u){let c=u.fieldPaths||[];return new rt(c.map(l=>me.fromServerFormat(l)))}(e.updateMask);return new At(i,s,o,t,r)}return new Un(i,s,t,r)}if(e.delete){let i=jt(n,e.delete);return new jn(i,t)}if(e.verify){let i=jt(n,e.verify);return new Po(i,t)}return S()}function QR(n,e){return n&&n.length>0?(P(e!==void 0),n.map(t=>function(i,s){let o=i.updateTime?ye(i.updateTime):ye(s);return o.isEqual(x.min())&&(o=ye(s)),new pf(o,i.transformResults||[])}(t,e))):[]}function nI(n,e){return{documents:[JE(n,e.path)]}}function rI(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=JE(n,i);let s=function(c){if(c.length!==0)return oI(J.create(c,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(c){if(c.length!==0)return c.map(l=>function(d){return{field:mi(d.field),direction:XR(d.dir)}}(l))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=wf(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:i}}function iI(n){let e=ZE(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){P(r===1);let l=t.from[0];l.allDescendants?i=l.collectionId:e=e.child(l.collectionId)}let s=[];t.where&&(s=function(h){let d=sI(h);return d instanceof J&&zp(d)?d.getFilters():[d]}(t.where));let o=[];t.orderBy&&(o=function(h){return h.map(d=>function(E){return new mr(yi(E.field),function(_){switch(_){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(E.direction))}(d))}(t.orderBy));let a=null;t.limit&&(a=function(h){let d;return d=typeof h=="object"?h.value:h,Ho(d)?null:d}(t.limit));let u=null;t.startAt&&(u=function(h){let d=!!h.before,f=h.values||[];return new $t(f,d)}(t.startAt));let c=null;return t.endAt&&(c=function(h){let d=!h.before,f=h.values||[];return new $t(f,d)}(t.endAt)),kE(e,i,o,s,a,"F",u,c)}function YR(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return S()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function sI(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=yi(t.unaryFilter.field);return G.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=yi(t.unaryFilter.field);return G.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=yi(t.unaryFilter.field);return G.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=yi(t.unaryFilter.field);return G.create(o,"!=",{nullValue:"NULL_VALUE"});default:return S()}}(n):n.fieldFilter!==void 0?function(t){return G.create(yi(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return S()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return J.create(t.compositeFilter.filters.map(r=>sI(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return S()}}(t.compositeFilter.op))}(n):S()}function XR(n){return $R[n]}function JR(n){return zR[n]}function ZR(n){return GR[n]}function mi(n){return{fieldPath:n.canonicalString()}}function yi(n){return me.fromServerFormat(n.fieldPath)}function oI(n){return n instanceof G?function(t){if(t.op==="=="){if(mw(t.value))return{unaryFilter:{field:mi(t.field),op:"IS_NAN"}};if(gw(t.value))return{unaryFilter:{field:mi(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(mw(t.value))return{unaryFilter:{field:mi(t.field),op:"IS_NOT_NAN"}};if(gw(t.value))return{unaryFilter:{field:mi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:mi(t.field),op:JR(t.op),value:t.value}}}(n):n instanceof J?function(t){let r=t.getFilters().map(i=>oI(i));return r.length===1?r[0]:{compositeFilter:{op:ZR(t.op),filters:r}}}(n):S()}function eD(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function aI(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Pi=class n{constructor(e,t,r,i,s=x.min(),o=x.min(),a=Re.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var cc=class{constructor(e){this.ut=e}};function tD(n,e){let t;if(e.document)t=tI(n.ut,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=I.fromSegments(e.noDocument.path),i=wr(e.noDocument.readTime);t=Ie.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return S();{let r=I.fromSegments(e.unknownDocument.path),i=wr(e.unknownDocument.version);t=Ie.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){let s=new ce(i[0],i[1]);return x.fromTimestamp(s)}(e.readTime)),t}function Nw(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:lc(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,o){return{name:Mo(s,o.key),fields:o.data.value.mapValue.fields,updateTime:Di(s,o.version.toTimestamp()),createTime:Di(s,o.createTime.toTimestamp())}}(n.ut,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:vr(e.version)};else{if(!e.isUnknownDocument())return S();r.unknownDocument={path:t.path.toArray(),version:vr(e.version)}}return r}function lc(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function vr(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function wr(n){let e=new ce(n.seconds,n.nanoseconds);return x.fromTimestamp(e)}function cr(n,e){let t=(e.baseMutations||[]).map(s=>Tf(n.ut,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>Tf(n.ut,s)),i=ce.fromMillis(e.localWriteTimeMs);return new ko(e.batchId,i,t,r)}function _o(n){let e=wr(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?wr(n.lastLimboFreeSnapshotVersion):x.min(),r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){return P(s.documents.length===1),We(Bi(ZE(s.documents[0])))}(n.query):function(s){return We(iI(s))}(n.query),new Pi(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Re.fromBase64String(n.resumeToken))}function uI(n,e){let t=vr(e.snapshotVersion),r=vr(e.lastLimboFreeSnapshotVersion),i;i=rc(e.target)?nI(n.ut,e.target):rI(n.ut,e.target)._t;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:yr(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Kp(n){let e=iI({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?sc(e,e.limit,"L"):e}function Fd(n,e){return new xo(e.largestBatchId,Tf(n.ut,e.overlayMutation))}function Mw(n,e){let t=e.path.lastSegment();return[n,He(e.path.popLast()),t]}function Ow(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:vr(r.readTime),documentKey:He(r.documentKey.path),largestBatchId:r.largestBatchId}}var Af=class{getBundleMetadata(e,t){return Fw(e).get(t).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:wr(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,t){return Fw(e).put(function(i){return{bundleId:i.id,createTime:vr(ye(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return Lw(e).get(t).next(r=>{if(r)return function(s){return{name:s.name,query:Kp(s.bundledQuery),readTime:wr(s.readTime)}}(r)})}saveNamedQuery(e,t){return Lw(e).put(function(i){return{name:i.name,readTime:vr(ye(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};function Fw(n){return De(n,"bundles")}function Lw(n){return De(n,"namedQueries")}var hc=class n{constructor(e,t){this.serializer=e,this.userId=t}static ct(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return fo(e).get(Mw(this.userId,t)).next(r=>r?Fd(this.serializer,r):null)}getOverlays(e,t){let r=Lt();return p.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new xo(t,o);i.push(this.lt(e,a))}),p.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(He(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(fo(e).j("collectionPathOverlayIndex",a))}),p.waitFor(s)}getOverlaysForCollection(e,t,r){let i=Lt(),s=He(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return fo(e).U("collectionPathOverlayIndex",o).next(a=>{for(let u of a){let c=Fd(this.serializer,u);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=Lt(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return fo(e).J({index:"collectionGroupOverlayIndex",range:a},(u,c,l)=>{let h=Fd(this.serializer,c);s.size()<i||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):l.done()}).next(()=>s)}lt(e,t){return fo(e).put(function(i,s,o){let[a,u,c]=Mw(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Oo(i.ut,o.mutation)}}(this.serializer,this.userId,t))}};function fo(n){return De(n,"documentOverlays")}var tn=class{constructor(){}ht(e,t){this.Pt(e,t),t.It()}Pt(e,t){if("nullValue"in e)this.Tt(t,5);else if("booleanValue"in e)this.Tt(t,10),t.Et(e.booleanValue?1:0);else if("integerValue"in e)this.Tt(t,15),t.Et(de(e.integerValue));else if("doubleValue"in e){let r=de(e.doubleValue);isNaN(r)?this.Tt(t,13):(this.Tt(t,15),Co(r)?t.Et(0):t.Et(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Tt(t,20),typeof r=="string"&&(r=rn(r)),t.dt(`${r.seconds||""}`),t.Et(r.nanos||0)}else if("stringValue"in e)this.At(e.stringValue,t),this.Rt(t);else if("bytesValue"in e)this.Tt(t,30),t.Vt(Nn(e.bytesValue)),this.Rt(t);else if("referenceValue"in e)this.ft(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Tt(t,45),t.Et(r.latitude||0),t.Et(r.longitude||0)}else"mapValue"in e?AE(e)?this.Tt(t,Number.MAX_SAFE_INTEGER):(this.gt(e.mapValue,t),this.Rt(t)):"arrayValue"in e?(this.yt(e.arrayValue,t),this.Rt(t)):S()}At(e,t){this.Tt(t,25),this.wt(e,t)}wt(e,t){t.dt(e)}gt(e,t){let r=e.fields||{};this.Tt(t,55);for(let i of Object.keys(r))this.At(i,t),this.Pt(r[i],t)}yt(e,t){let r=e.values||[];this.Tt(t,50);for(let i of r)this.Pt(i,t)}ft(e,t){this.Tt(t,37),I.fromName(e).path.forEach(r=>{this.Tt(t,60),this.wt(r,t)})}Tt(e,t){e.Et(t)}Rt(e){e.Et(2)}};tn.St=new tn;function nD(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function Uw(n){let e=64-function(r){let i=0;for(let s=0;s<8;++s){let o=nD(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(e/8)}var Cf=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}bt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Dt(r.value),r=t.next();this.Ct()}vt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Dt(r);else if(r<2048)this.Dt(960|r>>>6),this.Dt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Dt(480|r>>>12),this.Dt(128|63&r>>>6),this.Dt(128|63&r);else{let i=t.codePointAt(0);this.Dt(240|i>>>18),this.Dt(128|63&i>>>12),this.Dt(128|63&i>>>6),this.Dt(128|63&i)}}this.Ct()}Ot(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{let i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Nt(e){let t=this.Lt(e),r=Uw(t);this.Bt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}kt(e){let t=this.Lt(e),r=Uw(t);this.Bt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}qt(){this.Qt(255),this.Qt(255)}Kt(){this.$t(255),this.$t(255)}reset(){this.position=0}seed(e){this.Bt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Ut(){return this.buffer.slice(0,this.position)}Lt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Dt(e){let t=255&e;t===0?(this.Qt(0),this.Qt(255)):t===255?(this.Qt(255),this.Qt(0)):this.Qt(t)}Ft(e){let t=255&e;t===0?(this.$t(0),this.$t(255)):t===255?(this.$t(255),this.$t(0)):this.$t(e)}Ct(){this.Qt(0),this.Qt(1)}Mt(){this.$t(0),this.$t(1)}Qt(e){this.Bt(1),this.buffer[this.position++]=e}$t(e){this.Bt(1),this.buffer[this.position++]=~e}Bt(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},Sf=class{constructor(e){this.Wt=e}Vt(e){this.Wt.bt(e)}dt(e){this.Wt.xt(e)}Et(e){this.Wt.Nt(e)}It(){this.Wt.qt()}},bf=class{constructor(e){this.Wt=e}Vt(e){this.Wt.vt(e)}dt(e){this.Wt.Ot(e)}Et(e){this.Wt.kt(e)}It(){this.Wt.Kt()}},lr=class{constructor(){this.Wt=new Cf,this.Gt=new Sf(this.Wt),this.zt=new bf(this.Wt)}seed(e){this.Wt.seed(e)}jt(e){return e===0?this.Gt:this.zt}Ut(){return this.Wt.Ut()}reset(){this.Wt.reset()}};var hr=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Ht(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function Sn(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=jw(n.arrayValue,e.arrayValue),t!==0?t:(t=jw(n.directionalValue,e.directionalValue),t!==0?t:I.comparator(n.documentKey,e.documentKey)))}function jw(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var dc=class{constructor(e){this.Jt=new ne((t,r)=>me.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.Yt=e.orderBy,this.Zt=[];for(let t of e.filters){let r=t;r.isInequality()?this.Jt=this.Jt.add(r):this.Zt.push(r)}}get Xt(){return this.Jt.size>1}en(e){if(P(e.collectionGroup===this.collectionId),this.Xt)return!1;let t=Kd(e);if(t!==void 0&&!this.tn(t))return!1;let r=ar(e),i=new Set,s=0,o=0;for(;s<r.length&&this.tn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Jt.size>0){let a=this.Jt.getIterator().getNext();if(!i.has(a.field.canonicalString())){let u=r[s];if(!this.nn(a,u)||!this.rn(this.Yt[o++],u))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.Yt.length||!this.rn(this.Yt[o++],a))return!1}return!0}sn(){if(this.Xt)return null;let e=new ne(me.comparator),t=[];for(let r of this.Zt)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new wi(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new wi(r.field,0))}for(let r of this.Yt)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new wi(r.field,r.dir==="asc"?0:1)));return new Ai(Ai.UNKNOWN_ID,this.collectionId,t,Ao.empty())}tn(e){for(let t of this.Zt)if(this.nn(t,e))return!0;return!1}nn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}rn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function cI(n){var e,t;if(P(n instanceof G||n instanceof J),n instanceof G){if(n instanceof nc){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>G.create(n.field,"==",s)))||[];return J.create(i,"or")}return n}let r=n.filters.map(i=>cI(i));return J.create(r,n.op)}function rD(n){if(n.getFilters().length===0)return[];let e=Pf(cI(n));return P(lI(e)),Rf(e)||Df(e)?[e]:e.getFilters()}function Rf(n){return n instanceof G}function Df(n){return n instanceof J&&zp(n)}function lI(n){return Rf(n)||Df(n)||function(t){if(t instanceof J&&nf(t)){for(let r of t.getFilters())if(!Rf(r)&&!Df(r))return!1;return!0}return!1}(n)}function Pf(n){if(P(n instanceof G||n instanceof J),n instanceof G)return n;if(n.filters.length===1)return Pf(n.filters[0]);let e=n.filters.map(r=>Pf(r)),t=J.create(e,n.op);return t=fc(t),lI(t)?t:(P(t instanceof J),P(Si(t)),P(t.filters.length>1),t.filters.reduce((r,i)=>Qp(r,i)))}function Qp(n,e){let t;return P(n instanceof G||n instanceof J),P(e instanceof G||e instanceof J),t=n instanceof G?e instanceof G?function(i,s){return J.create([i,s],"and")}(n,e):Bw(n,e):e instanceof G?Bw(e,n):function(i,s){if(P(i.filters.length>0&&s.filters.length>0),Si(i)&&Si(s))return RE(i,s.getFilters());let o=nf(i)?i:s,a=nf(i)?s:i,u=o.filters.map(c=>Qp(c,a));return J.create(u,"or")}(n,e),fc(t)}function Bw(n,e){if(Si(e))return RE(e,n.getFilters());{let t=e.filters.map(r=>Qp(n,r));return J.create(t,"or")}}function fc(n){if(P(n instanceof G||n instanceof J),n instanceof G)return n;let e=n.getFilters();if(e.length===1)return fc(e[0]);if(SE(n))return n;let t=e.map(i=>fc(i)),r=[];return t.forEach(i=>{i instanceof G?r.push(i):i instanceof J&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:J.create(r,n.op)}var kf=class{constructor(){this.on=new Fo}addToCollectionParentIndex(e,t){return this.on.add(t),p.resolve()}getCollectionParents(e,t){return p.resolve(this.on.getEntries(t))}addFieldIndex(e,t){return p.resolve()}deleteFieldIndex(e,t){return p.resolve()}deleteAllFieldIndexes(e){return p.resolve()}createTargetIndexes(e,t){return p.resolve()}getDocumentsMatchingTarget(e,t){return p.resolve(null)}getIndexType(e,t){return p.resolve(0)}getFieldIndexes(e,t){return p.resolve([])}getNextCollectionGroupToUpdate(e){return p.resolve(null)}getMinOffset(e,t){return p.resolve(dt.min())}getMinOffsetFromCollectionGroup(e,t){return p.resolve(dt.min())}updateCollectionGroup(e,t,r){return p.resolve()}updateIndexEntries(e,t){return p.resolve()}},Fo=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new ne(W.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ne(W.comparator)).toArray()}};var Lu=new Uint8Array(0),xf=class{constructor(e,t){this.databaseId=t,this._n=new Fo,this.an=new zt(r=>yr(r),(r,i)=>Wo(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this._n.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this._n.add(t)});let s={collectionId:r,parent:He(i)};return qw(e).put(s)}return p.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[hE(t),""],!1,!0);return qw(e).U(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(Ft(o.parent))}return r})}addFieldIndex(e,t){let r=po(e),i=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=di(e);return s.next(a=>{o.put(Ow(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let r=po(e),i=di(e),s=hi(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=po(e),r=hi(e),i=di(e);return t.j().next(()=>r.j()).next(()=>i.j())}createTargetIndexes(e,t){return p.forEach(this.un(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let s=new dc(r).sn();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let r=hi(e),i=!0,s=new Map;return p.forEach(this.un(t),o=>this.cn(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=j(),a=[];return p.forEach(s,(u,c)=>{v("IndexedDbIndexManager",`Using index ${function(C){return`id=${C.indexId}|cg=${C.collectionGroup}|f=${C.fields.map(V=>`${V.fieldPath}:${V.kind}`).join(",")}`}(u)} to execute ${yr(t)}`);let l=function(C,V){let L=Kd(V);if(L===void 0)return null;for(let z of ic(C,L.fieldPath))switch(z.op){case"array-contains-any":return z.value.arrayValue.values||[];case"array-contains":return[z.value]}return null}(c,u),h=function(C,V){let L=new Map;for(let z of ar(V))for(let le of ic(C,z.fieldPath))switch(le.op){case"==":case"in":L.set(z.fieldPath.canonicalString(),le.value);break;case"not-in":case"!=":return L.set(z.fieldPath.canonicalString(),le.value),Array.from(L.values())}return null}(c,u),d=function(C,V){let L=[],z=!0;for(let le of ar(V)){let Qe=le.kind===0?Ew(C,le.fieldPath,C.startAt):Iw(C,le.fieldPath,C.startAt);L.push(Qe.value),z&&(z=Qe.inclusive)}return new $t(L,z)}(c,u),f=function(C,V){let L=[],z=!0;for(let le of ar(V)){let Qe=le.kind===0?Iw(C,le.fieldPath,C.endAt):Ew(C,le.fieldPath,C.endAt);L.push(Qe.value),z&&(z=Qe.inclusive)}return new $t(L,z)}(c,u),E=this.ln(u,c,d),w=this.ln(u,c,f),_=this.hn(u,c,h),D=this.Pn(u.indexId,l,E,d.inclusive,w,f.inclusive,_);return p.forEach(D,M=>r.G(M,t.limit).next(C=>{C.forEach(V=>{let L=I.fromSegments(V.documentKey);o.has(L)||(o=o.add(L),a.push(L))})}))}).next(()=>a)}return p.resolve(null)})}un(e){let t=this.an.get(e);return t||(e.filters.length===0?t=[e]:t=rD(J.create(e.filters,"and")).map(r=>df(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.an.set(e,t),t)}Pn(e,t,r,i,s,o,a){let u=(t!=null?t.length:1)*Math.max(r.length,s.length),c=u/(t!=null?t.length:1),l=[];for(let h=0;h<u;++h){let d=t?this.In(t[h/c]):Lu,f=this.Tn(e,d,r[h%c],i),E=this.En(e,d,s[h%c],o),w=a.map(_=>this.Tn(e,d,_,!0));l.push(...this.createRange(f,E,w))}return l}Tn(e,t,r,i){let s=new hr(e,I.empty(),t,r);return i?s:s.Ht()}En(e,t,r,i){let s=new hr(e,I.empty(),t,r);return i?s.Ht():s}cn(e,t){let r=new dc(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.en(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.un(t);return p.forEach(i,s=>this.cn(e,s).next(o=>{o?r!==0&&o.fields.length<function(u){let c=new ne(me.comparator),l=!1;for(let h of u.filters)for(let d of h.getFlattenedFilters())d.field.isKeyField()||(d.op==="array-contains"||d.op==="array-contains-any"?l=!0:c=c.add(d.field));for(let h of u.orderBy)h.field.isKeyField()||(c=c.add(h.field));return c.size+(l?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&r===2?1:r)}dn(e,t){let r=new lr;for(let i of ar(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.jt(i.kind);tn.St.ht(s,o)}return r.Ut()}In(e){let t=new lr;return tn.St.ht(e,t.jt(0)),t.Ut()}An(e,t){let r=new lr;return tn.St.ht(gr(this.databaseId,t),r.jt(function(s){let o=ar(s);return o.length===0?0:o[o.length-1].kind}(e))),r.Ut()}hn(e,t,r){if(r===null)return[];let i=[];i.push(new lr);let s=0;for(let o of ar(e)){let a=r[s++];for(let u of i)if(this.Rn(t,o.fieldPath)&&Do(a))i=this.Vn(i,o,a);else{let c=u.jt(o.kind);tn.St.ht(a,c)}}return this.mn(i)}ln(e,t,r){return this.hn(e,t,r.position)}mn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Ut();return t}Vn(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let u=new lr;u.seed(a.Ut()),tn.St.ht(o,u.jt(t.kind)),s.push(u)}return s}Rn(e,t){return!!e.filters.find(r=>r instanceof G&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=po(e),i=di(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(s=>{let o=[];return p.forEach(s,a=>i.get([a.indexId,this.uid]).next(u=>{o.push(function(l,h){let d=h?new Ao(h.sequenceNumber,new dt(wr(h.readTime),new I(Ft(h.documentKey)),h.largestBatchId)):Ao.empty(),f=l.fields.map(([E,w])=>new wi(me.fromServerFormat(E),w));return new Ai(l.indexId,l.collectionGroup,f,d)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:U(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=po(e),s=di(e);return this.fn(e).next(o=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>p.forEach(a,u=>s.put(Ow(u.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return p.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?p.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),p.forEach(a,u=>this.gn(e,i,u).next(c=>{let l=this.pn(s,u);return c.isEqual(l)?p.resolve():this.yn(e,s,u,c,l)}))))})}wn(e,t,r,i){return hi(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.An(r,t.key),documentKey:t.key.path.toArray()})}Sn(e,t,r,i){return hi(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.An(r,t.key),t.key.path.toArray()])}gn(e,t,r){let i=hi(e),s=new ne(Sn);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.An(r,t)])},(o,a)=>{s=s.add(new hr(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}pn(e,t){let r=new ne(Sn),i=this.dn(t,e);if(i==null)return r;let s=Kd(t);if(s!=null){let o=e.data.field(s.fieldPath);if(Do(o))for(let a of o.arrayValue.values||[])r=r.add(new hr(t.indexId,e.key,this.In(a),i))}else r=r.add(new hr(t.indexId,e.key,Lu,i));return r}yn(e,t,r,i,s){v("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(u,c,l,h,d){let f=u.getIterator(),E=c.getIterator(),w=li(f),_=li(E);for(;w||_;){let D=!1,M=!1;if(w&&_){let C=l(w,_);C<0?M=!0:C>0&&(D=!0)}else w!=null?M=!0:D=!0;D?(h(_),_=li(E)):M?(d(w),w=li(f)):(w=li(f),_=li(E))}}(i,s,Sn,a=>{o.push(this.wn(e,t,r,a))},a=>{o.push(this.Sn(e,t,r,a))}),p.waitFor(o)}fn(e){let t=1;return di(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Sn(o,a)).filter((o,a,u)=>!a||Sn(o,u[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=Sn(o,e),u=Sn(o,t);if(a===0)i[0]=e.Ht();else if(a>0&&u<0)i.push(o),i.push(o.Ht());else if(u>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.bn(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Lu,[]],u=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Lu,[]];s.push(IDBKeyRange.bound(a,u))}return s}bn(e,t){return Sn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next($w)}getMinOffset(e,t){return p.mapArray(this.un(t),r=>this.cn(e,r).next(i=>i||S())).next($w)}};function qw(n){return De(n,"collectionParents")}function hi(n){return De(n,"indexEntries")}function po(n){return De(n,"indexConfiguration")}function di(n){return De(n,"indexState")}function $w(n){P(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;Bp(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new dt(e.readTime,e.documentKey,t)}var zw={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},lt=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function hI(n,e,t){let r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId),a=0,u=r.J({range:o},(l,h,d)=>(a++,d.delete()));s.push(u.next(()=>{P(a===1)}));let c=[];for(let l of t.mutations){let h=yE(e,l.key.path,t.batchId);s.push(i.delete(h)),c.push(l.key)}return p.waitFor(s).next(()=>c)}function pc(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw S();e=n.noDocument}return JSON.stringify(e).length}lt.DEFAULT_COLLECTION_PERCENTILE=10,lt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,lt.DEFAULT=new lt(41943040,lt.DEFAULT_COLLECTION_PERCENTILE,lt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),lt.DISABLED=new lt(-1,0,0);var gc=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Dn={}}static ct(e,t,r,i){P(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return bn(e).J({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=_i(e),o=bn(e);return o.add({}).next(a=>{P(typeof a=="number");let u=new ko(a,t,r,i),c=function(f,E,w){let _=w.baseMutations.map(M=>Oo(f.ut,M)),D=w.mutations.map(M=>Oo(f.ut,M));return{userId:E,batchId:w.batchId,localWriteTimeMs:w.localWriteTime.toMillis(),baseMutations:_,mutations:D}}(this.serializer,this.userId,u),l=[],h=new ne((d,f)=>U(d.canonicalString(),f.canonicalString()));for(let d of i){let f=yE(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),l.push(o.put(c)),l.push(s.put(f,lR))}return h.forEach(d=>{l.push(this.indexManager.addToCollectionParentIndex(e,d))}),e.addOnCommittedListener(()=>{this.Dn[a]=u.keys()}),p.waitFor(l).next(()=>u)})}lookupMutationBatch(e,t){return bn(e).get(t).next(r=>r?(P(r.userId===this.userId),cr(this.serializer,r)):null)}Cn(e,t){return this.Dn[t]?p.resolve(this.Dn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.Dn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return bn(e).J({index:"userMutationsIndex",range:i},(o,a,u)=>{a.userId===this.userId&&(P(a.batchId>=r),s=cr(this.serializer,a)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return bn(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return bn(e).U("userMutationsIndex",t).next(r=>r.map(i=>cr(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=qu(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return _i(e).J({range:i},(o,a,u)=>{let[c,l,h]=o,d=Ft(l);if(c===this.userId&&t.path.isEqual(d))return bn(e).get(h).next(f=>{if(!f)throw S();P(f.userId===this.userId),s.push(cr(this.serializer,f))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ne(U),i=[];return t.forEach(s=>{let o=qu(this.userId,s.path),a=IDBKeyRange.lowerBound(o),u=_i(e).J({range:a},(c,l,h)=>{let[d,f,E]=c,w=Ft(f);d===this.userId&&s.path.isEqual(w)?r=r.add(E):h.done()});i.push(u)}),p.waitFor(i).next(()=>this.vn(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=qu(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new ne(U);return _i(e).J({range:o},(u,c,l)=>{let[h,d,f]=u,E=Ft(d);h===this.userId&&r.isPrefixOf(E)?E.length===i&&(a=a.add(f)):l.done()}).next(()=>this.vn(e,a))}vn(e,t){let r=[],i=[];return t.forEach(s=>{i.push(bn(e).get(s).next(o=>{if(o===null)throw S();P(o.userId===this.userId),r.push(cr(this.serializer,o))}))}),p.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return hI(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Fn(t.batchId)}),p.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Fn(e){delete this.Dn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return p.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return _i(e).J({range:r},(s,o,a)=>{if(s[0]===this.userId){let u=Ft(s[1]);i.push(u)}else a.done()}).next(()=>{P(i.length===0)})})}containsKey(e,t){return dI(e,this.userId,t)}Mn(e){return fI(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function dI(n,e,t){let r=qu(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return _i(n).J({range:s,H:!0},(a,u,c)=>{let[l,h,d]=a;l===e&&h===i&&(o=!0),c.done()}).next(()=>o)}function bn(n){return De(n,"mutations")}function _i(n){return De(n,"documentMutations")}function fI(n){return De(n,"mutationQueues")}var ki=class n{constructor(e){this.xn=e}next(){return this.xn+=2,this.xn}static On(){return new n(0)}static Nn(){return new n(-1)}};var Vf=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Ln(e).next(t=>{let r=new ki(t.highestTargetId);return t.highestTargetId=r.next(),this.Bn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Ln(e).next(t=>x.fromTimestamp(new ce(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Ln(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Ln(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Bn(e,i)))}addTargetData(e,t){return this.kn(e,t).next(()=>this.Ln(e).next(r=>(r.targetCount+=1,this.qn(t,r),this.Bn(e,r))))}updateTargetData(e,t){return this.kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>fi(e).delete(t.targetId)).next(()=>this.Ln(e)).next(r=>(P(r.targetCount>0),r.targetCount-=1,this.Bn(e,r)))}removeTargets(e,t,r){let i=0,s=[];return fi(e).J((o,a)=>{let u=_o(a);u.sequenceNumber<=t&&r.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>p.waitFor(s)).next(()=>i)}forEachTarget(e,t){return fi(e).J((r,i)=>{let s=_o(i);t(s)})}Ln(e){return Gw(e).get("targetGlobalKey").next(t=>(P(t!==null),t))}Bn(e,t){return Gw(e).put("targetGlobalKey",t)}kn(e,t){return fi(e).put(uI(this.serializer,t))}qn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Ln(e).next(t=>t.targetCount)}getTargetData(e,t){let r=yr(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return fi(e).J({range:i,index:"queryTargetsIndex"},(o,a,u)=>{let c=_o(a);Wo(t,c.target)&&(s=c,u.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=Rn(e);return t.forEach(o=>{let a=He(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),p.waitFor(i)}removeMatchingKeys(e,t,r){let i=Rn(e);return p.forEach(t,s=>{let o=He(s.path);return p.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=Rn(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Rn(e),s=j();return i.J({range:r,H:!0},(o,a,u)=>{let c=Ft(o[1]),l=new I(c);s=s.add(l)}).next(()=>s)}containsKey(e,t){let r=He(t.path),i=IDBKeyRange.bound([r],[hE(r)],!1,!0),s=0;return Rn(e).J({index:"documentTargetsIndex",H:!0,range:i},([o,a],u,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}ot(e,t){return fi(e).get(t).next(r=>r?_o(r):null)}};function fi(n){return De(n,"targets")}function Gw(n){return De(n,"targetGlobal")}function Rn(n){return De(n,"targetDocuments")}function Hw([n,e],[t,r]){let i=U(n,t);return i===0?U(e,r):i}var Nf=class{constructor(e){this.Qn=e,this.buffer=new ne(Hw),this.Kn=0}$n(){return++this.Kn}Un(e){let t=[e,this.$n()];if(this.buffer.size<this.Qn)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();Hw(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},Mf=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Wn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Gn(6e4)}stop(){this.Wn&&(this.Wn.cancel(),this.Wn=null)}get started(){return this.Wn!==null}Gn(e){v("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Wn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>g(this,null,function*(){this.Wn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){$n(t)?v("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield qn(t)}yield this.Gn(3e5)}))}},Of=class{constructor(e,t){this.zn=e,this.params=t}calculateTargetCount(e,t){return this.zn.jn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return p.resolve(nt.oe);let r=new Nf(t);return this.zn.forEachTarget(e,i=>r.Un(i.sequenceNumber)).next(()=>this.zn.Hn(e,i=>r.Un(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.zn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.zn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(v("LruGarbageCollector","Garbage collection skipped; disabled"),p.resolve(zw)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(v("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),zw):this.Jn(e,t))}getCacheSize(e){return this.zn.getCacheSize(e)}Jn(e,t){let r,i,s,o,a,u,c,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(v("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,o=Date.now(),this.nthSequenceNumber(e,i))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,t))).next(h=>(s=h,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(c=Date.now(),pi()<=Pt.DEBUG&&v("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-l}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(u-a)+`ms
	Removed ${h} documents in `+(c-u)+`ms
Total Duration: ${c-l}ms`),p.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:h})))}};function iD(n,e){return new Of(n,e)}var Ff=class{constructor(e,t){this.db=e,this.garbageCollector=iD(this,t)}jn(e){let t=this.Yn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Yn(e){let t=0;return this.Hn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Hn(e,t){return this.Zn(e,(r,i)=>t(i))}addReference(e,t,r){return Uu(e,r)}removeReference(e,t,r){return Uu(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Uu(e,t)}Xn(e,t){return function(i,s){let o=!1;return fI(i).Y(a=>dI(i,a,s).next(u=>(u&&(o=!0),p.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.Zn(e,(o,a)=>{if(a<=t){let u=this.Xn(e,o).next(c=>{if(!c)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,x.min()),Rn(e).delete(function(h){return[0,He(h.path)]}(o))))});i.push(u)}}).next(()=>p.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Uu(e,t)}Zn(e,t){let r=Rn(e),i,s=nt.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{o===0?(s!==nt.oe&&t(new I(Ft(i)),s),s=c,i=u):s=nt.oe}).next(()=>{s!==nt.oe&&t(new I(Ft(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function Uu(n,e){return Rn(n).put(function(r,i){return{targetId:0,path:He(r.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}var mc=class{constructor(){this.changes=new zt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ie.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?p.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Lf=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return or(e).put(r)}removeEntry(e,t,r){return or(e).delete(function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],lc(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.er(e,r)))}getEntry(e,t){let r=Ie.newInvalidDocument(t);return or(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(go(t))},(i,s)=>{r=this.tr(t,s)}).next(()=>r)}nr(e,t){let r={size:0,document:Ie.newInvalidDocument(t)};return or(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(go(t))},(i,s)=>{r={document:this.tr(t,s),size:pc(s)}}).next(()=>r)}getEntries(e,t){let r=Xe();return this.rr(e,t,(i,s)=>{let o=this.tr(i,s);r=r.insert(i,o)}).next(()=>r)}ir(e,t){let r=Xe(),i=new se(I.comparator);return this.rr(e,t,(s,o)=>{let a=this.tr(s,o);r=r.insert(s,a),i=i.insert(s,pc(o))}).next(()=>({documents:r,sr:i}))}rr(e,t,r){if(t.isEmpty())return p.resolve();let i=new ne(Qw);t.forEach(u=>i=i.add(u));let s=IDBKeyRange.bound(go(i.first()),go(i.last())),o=i.getIterator(),a=o.getNext();return or(e).J({index:"documentKeyIndex",range:s},(u,c,l)=>{let h=I.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&Qw(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?l.$(go(a)):l.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),lc(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return or(e).U(IDBKeyRange.bound(a,u,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let l=Xe();for(let h of c){let d=this.tr(I.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);d.isFoundDocument()&&(Qo(t,d)||i.has(d.key))&&(l=l.insert(d.key,d))}return l})}getAllFromCollectionGroup(e,t,r,i){let s=Xe(),o=Kw(t,r),a=Kw(t,dt.max());return or(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,l)=>{let h=this.tr(I.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(h.key,h),s.size===i&&l.done()}).next(()=>s)}newChangeBuffer(e){return new Uf(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Ww(e).get("remoteDocumentGlobalKey").next(t=>(P(!!t),t))}er(e,t){return Ww(e).put("remoteDocumentGlobalKey",t)}tr(e,t){if(t){let r=tD(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(x.min())))return r}return Ie.newInvalidDocument(e)}};function pI(n){return new Lf(n)}var Uf=class extends mc{constructor(e,t){super(),this._r=e,this.trackRemovals=t,this.ar=new zt(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new ne((s,o)=>U(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.ar.get(s);if(t.push(this._r.removeEntry(e,s,a.readTime)),o.isValidDocument()){let u=Nw(this._r.serializer,o);i=i.add(s.path.popLast());let c=pc(u);r+=c-a.size,t.push(this._r.addEntry(e,s,u))}else if(r-=a.size,this.trackRemovals){let u=Nw(this._r.serializer,o.convertToNoDocument(x.min()));t.push(this._r.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this._r.indexManager.addToCollectionParentIndex(e,s))}),t.push(this._r.updateMetadata(e,r)),p.waitFor(t)}getFromCache(e,t){return this._r.nr(e,t).next(r=>(this.ar.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this._r.ir(e,t).next(({documents:r,sr:i})=>(i.forEach((s,o)=>{this.ar.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function Ww(n){return De(n,"remoteDocumentGlobal")}function or(n){return De(n,"remoteDocumentsV14")}function go(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Kw(n,e){let t=e.documentKey.path.toArray();return[n,lc(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Qw(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=U(t[s],r[s]),i)return i;return i=U(t.length,r.length),i||(i=U(t[t.length-2],r[r.length-2]),i||U(t[t.length-1],r[r.length-1]))}var jf=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var yc=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Eo(r.mutation,i,rt.empty(),ce.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,j()).next(()=>r))}getLocalViewOfDocuments(e,t,r=j()){let i=Lt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=yo();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=Lt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,j()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Xe(),o=wo(),a=function(){return wo()}();return t.forEach((u,c)=>{let l=r.get(c.key);i.has(c.key)&&(l===void 0||l.mutation instanceof At)?s=s.insert(c.key,c):l!==void 0?(o.set(c.key,l.mutation.getFieldMask()),Eo(l.mutation,c,l.mutation.getFieldMask(),ce.now())):o.set(c.key,rt.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((c,l)=>o.set(c,l)),t.forEach((c,l)=>{var h;return a.set(c,new jf(l,(h=o.get(c))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(e,t){let r=wo(),i=new se((o,a)=>o-a),s=j();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(u=>{let c=t.get(u);if(c===null)return;let l=r.get(u)||rt.empty();l=a.applyToLocalView(c,l),r.set(u,l);let h=(i.get(a.batchId)||j()).add(u);i=i.insert(a.batchId,h)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let u=a.getNext(),c=u.key,l=u.value,h=FE();l.forEach(d=>{if(!s.has(d)){let f=GE(t.get(d),r.get(d));f!==null&&h.set(d,f),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return p.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(o){return I.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Gp(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):p.resolve(Lt()),a=-1,u=s;return o.next(c=>p.forEach(c,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(l)?p.resolve():this.remoteDocumentCache.getEntry(e,l).next(d=>{u=u.insert(l,d)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,u,c,j())).next(l=>({batchId:a,changes:OE(l)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new I(t)).next(r=>{let i=yo();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=yo();return this.indexManager.getCollectionParents(e,s).next(a=>p.forEach(a,u=>{let c=function(h,d){return new Tt(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(l=>{l.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((u,c)=>{let l=c.getKey();o.get(l)===null&&(o=o.insert(l,Ie.newInvalidDocument(l)))});let a=yo();return o.forEach((u,c)=>{let l=s.get(u);l!==void 0&&Eo(l.mutation,c,rt.empty(),ce.now()),Qo(t,c)&&(a=a.insert(u,c))}),a})}};var Bf=class{constructor(e){this.serializer=e,this.ur=new Map,this.cr=new Map}getBundleMetadata(e,t){return p.resolve(this.ur.get(t))}saveBundleMetadata(e,t){return this.ur.set(t.id,function(i){return{id:i.id,version:i.version,createTime:ye(i.createTime)}}(t)),p.resolve()}getNamedQuery(e,t){return p.resolve(this.cr.get(t))}saveNamedQuery(e,t){return this.cr.set(t.name,function(i){return{name:i.name,query:Kp(i.bundledQuery),readTime:ye(i.readTime)}}(t)),p.resolve()}};var qf=class{constructor(){this.overlays=new se(I.comparator),this.lr=new Map}getOverlay(e,t){return p.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Lt();return p.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.lt(e,t,s)}),p.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.lr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.lr.delete(r)),p.resolve()}getOverlaysForCollection(e,t,r){let i=Lt(),s=t.length+1,o=new I(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return p.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new se((c,l)=>c-l),o=this.overlays.getIterator();for(;o.hasNext();){let c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let l=s.get(c.largestBatchId);l===null&&(l=Lt(),s=s.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}let a=Lt(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=i)););return p.resolve(a)}lt(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.lr.get(i.largestBatchId).delete(r.key);this.lr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new xo(t,r));let s=this.lr.get(t);s===void 0&&(s=j(),this.lr.set(t,s)),this.lr.set(t,s.add(r.key))}};var Lo=class{constructor(){this.hr=new ne(ve.Pr),this.Ir=new ne(ve.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(e,t){let r=new ve(e,t);this.hr=this.hr.add(r),this.Ir=this.Ir.add(r)}Er(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.dr(new ve(e,t))}Ar(e,t){e.forEach(r=>this.removeReference(r,t))}Rr(e){let t=new I(new W([])),r=new ve(t,e),i=new ve(t,e+1),s=[];return this.Ir.forEachInRange([r,i],o=>{this.dr(o),s.push(o.key)}),s}Vr(){this.hr.forEach(e=>this.dr(e))}dr(e){this.hr=this.hr.delete(e),this.Ir=this.Ir.delete(e)}mr(e){let t=new I(new W([])),r=new ve(t,e),i=new ve(t,e+1),s=j();return this.Ir.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new ve(e,0),r=this.hr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},ve=class{constructor(e,t){this.key=e,this.gr=t}static Pr(e,t){return I.comparator(e.key,t.key)||U(e.gr,t.gr)}static Tr(e,t){return U(e.gr,t.gr)||I.comparator(e.key,t.key)}};var $f=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.pr=1,this.yr=new ne(ve.Pr)}checkEmpty(e){return p.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.pr;this.pr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new ko(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.yr=this.yr.add(new ve(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return p.resolve(o)}lookupMutationBatch(e,t){return p.resolve(this.wr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.Sr(r),s=i<0?0:i;return p.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return p.resolve(this.mutationQueue.length===0?-1:this.pr-1)}getAllMutationBatches(e){return p.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new ve(t,0),i=new ve(t,Number.POSITIVE_INFINITY),s=[];return this.yr.forEachInRange([r,i],o=>{let a=this.wr(o.gr);s.push(a)}),p.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ne(U);return t.forEach(i=>{let s=new ve(i,0),o=new ve(i,Number.POSITIVE_INFINITY);this.yr.forEachInRange([s,o],a=>{r=r.add(a.gr)})}),p.resolve(this.br(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;I.isDocumentKey(s)||(s=s.child(""));let o=new ve(new I(s),0),a=new ne(U);return this.yr.forEachWhile(u=>{let c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(u.gr)),!0)},o),p.resolve(this.br(a))}br(e){let t=[];return e.forEach(r=>{let i=this.wr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){P(this.Dr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.yr;return p.forEach(t.mutations,i=>{let s=new ve(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.yr=r})}Fn(e){}containsKey(e,t){let r=new ve(t,0),i=this.yr.firstAfterOrEqual(r);return p.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,p.resolve()}Dr(e,t){return this.Sr(e)}Sr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}wr(e){let t=this.Sr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var zf=class{constructor(e){this.Cr=e,this.docs=function(){return new se(I.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Cr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return p.resolve(r?r.document.mutableCopy():Ie.newInvalidDocument(t))}getEntries(e,t){let r=Xe();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Ie.newInvalidDocument(i))}),p.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Xe(),o=t.path,a=new I(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){let{key:c,value:{document:l}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Bp(fE(l),r)<=0||(i.has(l.key)||Qo(t,l))&&(s=s.insert(l.key,l.mutableCopy()))}return p.resolve(s)}getAllFromCollectionGroup(e,t,r,i){S()}vr(e,t){return p.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Gf(this)}getSize(e){return p.resolve(this.size)}},Gf=class extends mc{constructor(e){super(),this._r=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this._r.addEntry(e,i)):this._r.removeEntry(r)}),p.waitFor(t)}getFromCache(e,t){return this._r.getEntry(e,t)}getAllFromCache(e,t){return this._r.getEntries(e,t)}};var Hf=class{constructor(e){this.persistence=e,this.Fr=new zt(t=>yr(t),Wo),this.lastRemoteSnapshotVersion=x.min(),this.highestTargetId=0,this.Mr=0,this.Or=new Lo,this.targetCount=0,this.Nr=ki.On()}forEachTarget(e,t){return this.Fr.forEach((r,i)=>t(i)),p.resolve()}getLastRemoteSnapshotVersion(e){return p.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return p.resolve(this.Mr)}allocateTargetId(e){return this.highestTargetId=this.Nr.next(),p.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Mr&&(this.Mr=t),p.resolve()}kn(e){this.Fr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Nr=new ki(t),this.highestTargetId=t),e.sequenceNumber>this.Mr&&(this.Mr=e.sequenceNumber)}addTargetData(e,t){return this.kn(t),this.targetCount+=1,p.resolve()}updateTargetData(e,t){return this.kn(t),p.resolve()}removeTargetData(e,t){return this.Fr.delete(t.target),this.Or.Rr(t.targetId),this.targetCount-=1,p.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.Fr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Fr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),p.waitFor(s).next(()=>i)}getTargetCount(e){return p.resolve(this.targetCount)}getTargetData(e,t){let r=this.Fr.get(t)||null;return p.resolve(r)}addMatchingKeys(e,t,r){return this.Or.Er(t,r),p.resolve()}removeMatchingKeys(e,t,r){this.Or.Ar(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),p.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Or.Rr(t),p.resolve()}getMatchingKeysForTargetId(e,t){let r=this.Or.mr(t);return p.resolve(r)}containsKey(e,t){return p.resolve(this.Or.containsKey(t))}};var _c=class{constructor(e,t){this.Lr={},this.overlays={},this.Br=new nt(0),this.kr=!1,this.kr=!0,this.referenceDelegate=e(this),this.qr=new Hf(this),this.indexManager=new kf,this.remoteDocumentCache=function(i){return new zf(i)}(r=>this.referenceDelegate.Qr(r)),this.serializer=new cc(t),this.Kr=new Bf(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new qf,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Lr[e.toKey()];return r||(r=new $f(t,this.referenceDelegate),this.Lr[e.toKey()]=r),r}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(e,t,r){v("MemoryPersistence","Starting transaction:",e);let i=new Wf(this.Br.next());return this.referenceDelegate.$r(),r(i).next(s=>this.referenceDelegate.Ur(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Wr(e,t){return p.or(Object.values(this.Lr).map(r=>()=>r.containsKey(e,t)))}},Wf=class extends Xu{constructor(e){super(),this.currentSequenceNumber=e}},vc=class n{constructor(e){this.persistence=e,this.Gr=new Lo,this.zr=null}static jr(e){return new n(e)}get Hr(){if(this.zr)return this.zr;throw S()}addReference(e,t,r){return this.Gr.addReference(r,t),this.Hr.delete(r.toString()),p.resolve()}removeReference(e,t,r){return this.Gr.removeReference(r,t),this.Hr.add(r.toString()),p.resolve()}markPotentiallyOrphaned(e,t){return this.Hr.add(t.toString()),p.resolve()}removeTarget(e,t){this.Gr.Rr(t.targetId).forEach(i=>this.Hr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Hr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}$r(){this.zr=new Set}Ur(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return p.forEach(this.Hr,r=>{let i=I.fromPath(r);return this.Jr(e,i).next(s=>{s||t.removeEntry(i,x.min())})}).next(()=>(this.zr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Jr(e,t).next(r=>{r?this.Hr.delete(t.toString()):this.Hr.add(t.toString())})}Qr(e){return 0}Jr(e,t){return p.or([()=>p.resolve(this.Gr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Wr(e,t)])}};var Kf=class{constructor(e){this.serializer=e}O(e,t,r,i){let s=new Ju("createOrUpgrade",t);r<1&&i>=1&&(function(u){u.createObjectStore("owner")}(e),function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",dw,{unique:!0}),u.createObjectStore("documentMutations")}(e),Yw(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=p.resolve();return r<3&&i>=3&&(r!==0&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),Yw(e)),o=o.next(()=>function(u){let c=u.store("targetGlobal"),l={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:x.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",l)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(u,c){return c.store("mutations").U().next(l=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",dw,{unique:!0});let h=c.store("mutations"),d=l.map(f=>h.put(f));return p.waitFor(d)})}(e,s))),o=o.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.Zr(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.Xr(s)))),r<7&&i>=7&&(o=o.next(()=>this.ei(s))),r<8&&i>=8&&(o=o.next(()=>this.ti(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.ni(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(u){let c=u.createObjectStore("documentOverlays",{keyPath:IR});c.createIndex("collectionPathOverlayIndex",TR,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",AR,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>function(u){let c=u.createObjectStore("remoteDocumentsV14",{keyPath:hR});c.createIndex("documentKeyIndex",dR),c.createIndex("collectionGroupIndex",fR)}(e)).next(()=>this.ri(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.ii(e,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:_R}).createIndex("sequenceNumberIndex",vR,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:wR}).createIndex("documentKeyIndex",ER,{unique:!1})}(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),o}Xr(e){let t=0;return e.store("remoteDocuments").J((r,i)=>{t+=pc(i)}).next(()=>{let r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Zr(e){let t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(i=>p.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>p.forEach(a,u=>{P(u.userId===s.userId);let c=cr(this.serializer,u);return hI(e,s.userId,c).next(()=>{})}))}))}ei(e){let t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return r.J((o,a)=>{let u=new W(o),c=function(h){return[0,He(h)]}(u);s.push(t.get(c).next(l=>l?p.resolve():(h=>t.put({targetId:0,path:He(h),sequenceNumber:i.highestListenSequenceNumber}))(u)))}).next(()=>p.waitFor(s))})}ti(e,t){e.createObjectStore("collectionParents",{keyPath:yR});let r=t.store("collectionParents"),i=new Fo,s=o=>{if(i.add(o)){let a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:He(u)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{let u=new W(o);return s(u.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,u],c)=>{let l=Ft(a);return s(l.popLast())}))}ni(e){let t=e.store("targets");return t.J((r,i)=>{let s=_o(i),o=uI(this.serializer,s);return t.put(o)})}ri(e,t){let r=t.store("remoteDocuments"),i=[];return r.J((s,o)=>{let a=t.store("remoteDocumentsV14"),u=function(h){return h.document?new I(W.fromString(h.document.name).popFirst(5)):h.noDocument?I.fromSegments(h.noDocument.path):h.unknownDocument?I.fromSegments(h.unknownDocument.path):S()}(o).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>p.waitFor(i))}ii(e,t){let r=t.store("mutations"),i=pI(this.serializer),s=new _c(vc.jr,this.serializer.ut);return r.U().next(o=>{let a=new Map;return o.forEach(u=>{var c;let l=(c=a.get(u.userId))!==null&&c!==void 0?c:j();cr(this.serializer,u).keys().forEach(h=>l=l.add(h)),a.set(u.userId,l)}),p.forEach(a,(u,c)=>{let l=new we(c),h=hc.ct(this.serializer,l),d=s.getIndexManager(l),f=gc.ct(l,this.serializer,d,s.referenceDelegate);return new yc(i,f,h,d).recalculateAndSaveOverlaysForDocumentKeys(new So(t,nt.oe),u).next()})})}};function Yw(n){n.createObjectStore("targetDocuments",{keyPath:gR}).createIndex("documentTargetsIndex",mR,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",pR,{unique:!0}),n.createObjectStore("targetGlobal")}var Ld="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Qf=class n{constructor(e,t,r,i,s,o,a,u,c,l,h=16){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.si=s,this.window=o,this.document=a,this.oi=c,this._i=l,this.ai=h,this.Br=null,this.kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ui=null,this.inForeground=!1,this.ci=null,this.li=null,this.hi=Number.NEGATIVE_INFINITY,this.Pi=d=>Promise.resolve(),!n.D())throw new y(m.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Ff(this,i),this.Ii=t+"main",this.serializer=new cc(u),this.Ti=new Vn(this.Ii,this.ai,new Kf(this.serializer)),this.qr=new Vf(this.referenceDelegate,this.serializer),this.remoteDocumentCache=pI(this.serializer),this.Kr=new Af,this.window&&this.window.localStorage?this.Ei=this.window.localStorage:(this.Ei=null,l===!1&&ge("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.di().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new y(m.FAILED_PRECONDITION,Ld);return this.Ai(),this.Ri(),this.Vi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.qr.getHighestSequenceNumber(e))}).then(e=>{this.Br=new nt(e,this.oi)}).then(()=>{this.kr=!0}).catch(e=>(this.Ti&&this.Ti.close(),Promise.reject(e)))}mi(e){return this.Pi=t=>g(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ti.L(t=>g(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.si.enqueueAndForget(()=>g(this,null,function*(){this.started&&(yield this.di())})))}di(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>ju(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)))})}).next(()=>this.gi(e)).next(t=>this.isPrimary&&!t?this.pi(e).next(()=>!1):!!t&&this.yi(e).next(()=>!0))).catch(e=>{if($n(e))return v("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return v("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.si.enqueueRetryable(()=>this.Pi(e)),this.isPrimary=e})}fi(e){return mo(e).get("owner").next(t=>p.resolve(this.wi(t)))}Si(e){return ju(e).delete(this.clientId)}bi(){return g(this,null,function*(){if(this.isPrimary&&!this.Di(this.hi,18e5)){this.hi=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=De(t,"clientMetadata");return r.U().next(i=>{let s=this.Ci(i,18e5),o=i.filter(a=>s.indexOf(a)===-1);return p.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ei)for(let t of e)this.Ei.removeItem(this.vi(t.clientId))}})}Vi(){this.li=this.si.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.di().then(()=>this.bi()).then(()=>this.Vi()))}wi(e){return!!e&&e.ownerId===this.clientId}gi(e){return this._i?p.resolve(!0):mo(e).get("owner").next(t=>{if(t!==null&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)){if(this.wi(t)&&this.networkEnabled)return!0;if(!this.wi(t)){if(!t.allowTabSynchronization)throw new y(m.FAILED_PRECONDITION,Ld);return!1}}return!(!this.networkEnabled||!this.inForeground)||ju(e).U().next(r=>this.Ci(r,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&v("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return g(this,null,function*(){this.kr=!1,this.Mi(),this.li&&(this.li.cancel(),this.li=null),this.xi(),this.Oi(),yield this.Ti.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new So(e,nt.oe);return this.pi(t).next(()=>this.Si(t))}),this.Ti.close(),this.Ni()})}Ci(e,t){return e.filter(r=>this.Di(r.updateTimeMs,t)&&!this.Fi(r.clientId))}Li(){return this.runTransaction("getActiveClients","readonly",e=>ju(e).U().next(t=>this.Ci(t,18e5).map(r=>r.clientId)))}get started(){return this.kr}getMutationQueue(e,t){return gc.ct(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new xf(e,this.serializer.ut.databaseId)}getDocumentOverlayCache(e){return hc.ct(this.serializer,e)}getBundleCache(){return this.Kr}runTransaction(e,t,r){v("IndexedDbPersistence","Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(u){return u===16?SR:u===15?EE:u===14?wE:u===13?vE:u===12?CR:u===11?_E:void S()}(this.ai),o;return this.Ti.runTransaction(e,i,s,a=>(o=new So(a,this.Br?this.Br.next():nt.oe),t==="readwrite-primary"?this.fi(o).next(u=>!!u||this.gi(o)).next(u=>{if(!u)throw ge(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)),new y(m.FAILED_PRECONDITION,pE);return r(o)}).next(u=>this.yi(o).next(()=>u)):this.Bi(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Bi(e){return mo(e).get("owner").next(t=>{if(t!==null&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)&&!this.wi(t)&&!(this._i||this.allowTabSynchronization&&t.allowTabSynchronization))throw new y(m.FAILED_PRECONDITION,Ld)})}yi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return mo(e).put("owner",t)}static D(){return Vn.D()}pi(e){let t=mo(e);return t.get("owner").next(r=>this.wi(r)?(v("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):p.resolve())}Di(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(ge(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Ai(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.ci=()=>{this.si.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.di()))},this.document.addEventListener("visibilitychange",this.ci),this.inForeground=this.document.visibilityState==="visible")}xi(){this.ci&&(this.document.removeEventListener("visibilitychange",this.ci),this.ci=null)}Ri(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.ui=()=>{this.Mi();let t=/(?:Version|Mobile)\/1[456]/;Dl()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.si.enterRestrictedMode(!0),this.si.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ui))}Oi(){this.ui&&(this.window.removeEventListener("pagehide",this.ui),this.ui=null)}Fi(e){var t;try{let r=((t=this.Ei)===null||t===void 0?void 0:t.getItem(this.vi(e)))!==null;return v("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return ge("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Mi(){if(this.Ei)try{this.Ei.setItem(this.vi(this.clientId),String(Date.now()))}catch(e){ge("Failed to set zombie client id.",e)}}Ni(){if(this.Ei)try{this.Ei.removeItem(this.vi(this.clientId))}catch{}}vi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function mo(n){return De(n,"owner")}function ju(n){return De(n,"clientMetadata")}function Yp(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}var Yf=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.ki=r,this.qi=i}static Qi(e,t){let r=j(),i=j();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var Xf=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var wc=class{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=function(){return Dl()?8:gE(hs())>0?6:4}()}initialize(e,t){this.Gi=e,this.indexManager=t,this.Ki=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.zi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ji(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Xf;return this.Hi(e,t,o).next(a=>{if(s.result=a,this.$i)return this.Ji(e,t,o,a.size)})}).next(()=>s.result)}Ji(e,t,r,i){return r.documentReadCount<this.Ui?(pi()<=Pt.DEBUG&&v("QueryEngine","SDK will not create cache indexes for query:",gi(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),p.resolve()):(pi()<=Pt.DEBUG&&v("QueryEngine","Query:",gi(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Wi*i?(pi()<=Pt.DEBUG&&v("QueryEngine","The SDK decides to create cache indexes for query:",gi(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,We(t))):p.resolve())}zi(e,t){if(Tw(t))return p.resolve(null);let r=We(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=sc(t,null,"F"),r=We(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=j(...s);return this.Gi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{let c=this.Yi(t,a);return this.Zi(t,c,o,u.readTime)?this.zi(e,sc(t,null,"F")):this.Xi(e,c,t,u)}))})))}ji(e,t,r,i){return Tw(t)||i.isEqual(x.min())?p.resolve(null):this.Gi.getDocuments(e,r).next(s=>{let o=this.Yi(t,s);return this.Zi(t,o,r,i)?p.resolve(null):(pi()<=Pt.DEBUG&&v("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),gi(t)),this.Xi(e,o,t,dE(i,-1)).next(a=>a))})}Yi(e,t){let r=new ne(NE(e));return t.forEach((i,s)=>{Qo(e,s)&&(r=r.add(s))}),r}Zi(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Hi(e,t,r){return pi()<=Pt.DEBUG&&v("QueryEngine","Using full collection scan to execute query:",gi(t)),this.Gi.getDocumentsMatchingQuery(e,t,dt.min(),r)}Xi(e,t,r,i){return this.Gi.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var Jf=class{constructor(e,t,r,i){this.persistence=e,this.es=t,this.serializer=i,this.ts=new se(U),this.ns=new zt(s=>yr(s),Wo),this.rs=new Map,this.ss=e.getRemoteDocumentCache(),this.qr=e.getTargetCache(),this.Kr=e.getBundleCache(),this.os(r)}os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new yc(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ts))}};function gI(n,e,t,r){return new Jf(n,e,t,r)}function mI(n,e){return g(this,null,function*(){let t=T(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.os(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],u=j();for(let c of i){o.push(c.batchId);for(let l of c.mutations)u=u.add(l.key)}for(let c of s){a.push(c.batchId);for(let l of c.mutations)u=u.add(l.key)}return t.localDocuments.getDocuments(r,u).next(c=>({_s:c,removedBatchIds:o,addedBatchIds:a}))})})})}function sD(n,e){let t=T(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.ss.newChangeBuffer({trackRemovals:!0});return function(a,u,c,l){let h=c.batch,d=h.keys(),f=p.resolve();return d.forEach(E=>{f=f.next(()=>l.getEntry(u,E)).next(w=>{let _=c.docVersions.get(E);P(_!==null),w.version.compareTo(_)<0&&(h.applyToRemoteDocument(w,c),w.isValidDocument()&&(w.setReadTime(c.commitVersion),l.addEntry(w)))})}),f.next(()=>a.mutationQueue.removeMutationBatch(u,h))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=j();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function yI(n){let e=T(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.qr.getLastRemoteSnapshotVersion(t))}function oD(n,e){let t=T(n),r=e.snapshotVersion,i=t.ts;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.ss.newChangeBuffer({trackRemovals:!0});i=t.ts;let a=[];e.targetChanges.forEach((l,h)=>{let d=i.get(h);if(!d)return;a.push(t.qr.removeMatchingKeys(s,l.removedDocuments,h).next(()=>t.qr.addMatchingKeys(s,l.addedDocuments,h)));let f=d.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(h)!==null?f=f.withResumeToken(Re.EMPTY_BYTE_STRING,x.min()).withLastLimboFreeSnapshotVersion(x.min()):l.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(l.resumeToken,r)),i=i.insert(h,f),function(w,_,D){return w.resumeToken.approximateByteSize()===0||_.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=3e8?!0:D.addedDocuments.size+D.modifiedDocuments.size+D.removedDocuments.size>0}(d,f,l)&&a.push(t.qr.updateTargetData(s,f))});let u=Xe(),c=j();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(_I(s,o,e.documentUpdates).next(l=>{u=l.us,c=l.cs})),!r.isEqual(x.min())){let l=t.qr.getLastRemoteSnapshotVersion(s).next(h=>t.qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(l)}return p.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(t.ts=i,s))}function _I(n,e,t){let r=j(),i=j();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Xe();return t.forEach((a,u)=>{let c=s.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(x.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||u.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):v("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{us:o,cs:i}})}function aD(n,e){let t=T(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function xi(n,e){let t=T(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.qr.getTargetData(r,e).next(s=>s?(i=s,p.resolve(i)):t.qr.allocateTargetId(r).next(o=>(i=new Pi(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.qr.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.ts.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ts=t.ts.insert(r.targetId,r),t.ns.set(e,r.targetId)),r})}function Vi(n,e,t){return g(this,null,function*(){let r=T(n),i=r.ts.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!$n(o))throw o;v("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.ts=r.ts.remove(e),r.ns.delete(i.target)})}function Ec(n,e,t){let r=T(n),i=x.min(),s=j();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,l){let h=T(u),d=h.ns.get(l);return d!==void 0?p.resolve(h.ts.get(d)):h.qr.getTargetData(c,l)}(r,o,We(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.qr.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>r.es.getDocumentsMatchingQuery(o,e,t?i:x.min(),t?s:j())).next(a=>(EI(r,VE(e),a),{documents:a,ls:s})))}function vI(n,e){let t=T(n),r=T(t.qr),i=t.ts.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.ot(s,e).next(o=>o?o.target:null))}function wI(n,e){let t=T(n),r=t.rs.get(e)||x.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.ss.getAllFromCollectionGroup(i,e,dE(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(EI(t,e,i),i))}function EI(n,e,t){let r=n.rs.get(e)||x.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.rs.set(e,r)}function uD(n,e,t,r){return g(this,null,function*(){let i=T(n),s=j(),o=Xe();for(let c of t){let l=e.hs(c.metadata.name);c.document&&(s=s.add(l));let h=e.Ps(c);h.setReadTime(e.Is(c.metadata.readTime)),o=o.insert(l,h)}let a=i.ss.newChangeBuffer({trackRemovals:!0}),u=yield xi(i,function(l){return We(Bi(W.fromString(`__bundle__/docs/${l}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>_I(c,a,o).next(l=>(a.apply(c),l)).next(l=>i.qr.removeMatchingKeysForTargetId(c,u.targetId).next(()=>i.qr.addMatchingKeys(c,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,l.us,l.cs)).next(()=>l.us)))})}function cD(r,i){return g(this,arguments,function*(n,e,t=j()){let s=yield xi(n,We(Kp(e.bundledQuery))),o=T(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let u=ye(e.readTime);if(s.snapshotVersion.compareTo(u)>=0)return o.Kr.saveNamedQuery(a,e);let c=s.withResumeToken(Re.EMPTY_BYTE_STRING,u);return o.ts=o.ts.insert(c.targetId,c),o.qr.updateTargetData(a,c).next(()=>o.qr.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.qr.addMatchingKeys(a,t,s.targetId)).next(()=>o.Kr.saveNamedQuery(a,e))})})}function Xw(n,e){return`firestore_clients_${n}_${e}`}function Jw(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Ud(n,e){return`firestore_targets_${n}_${e}`}var Ic=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Ts(e,t,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new y(i.error.code,i.error.message))),o?new n(e,t,i.state,s):(ge("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Es(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Io=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ts(e,t){let r=JSON.parse(t),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new y(r.error.code,r.error.message))),s?new n(e,r.state,i):(ge("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Es(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Tc=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ts(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=Hp();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=mE(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(ge("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},Zf=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static Ts(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(ge("SharedClientState",`Failed to parse online state: ${e}`),null)}},Uo=class{constructor(){this.activeTargetIds=Hp()}ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}As(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Es(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},To=class{constructor(e,t,r,i,s){this.window=e,this.si=t,this.persistenceKey=r,this.Rs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Vs=this.fs.bind(this),this.gs=new se(U),this.started=!1,this.ps=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ys=Xw(this.persistenceKey,this.Rs),this.ws=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.gs=this.gs.insert(this.Rs,new Uo),this.Ss=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.bs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ds=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.Cs=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.vs=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.Vs)}static D(e){return!(!e||!e.localStorage)}start(){return g(this,null,function*(){let e=yield this.syncEngine.Li();for(let r of e){if(r===this.Rs)continue;let i=this.getItem(Xw(this.persistenceKey,r));if(i){let s=Tc.Ts(r,i);s&&(this.gs=this.gs.insert(s.clientId,s))}}this.Fs();let t=this.storage.getItem(this.Cs);if(t){let r=this.Ms(t);r&&this.xs(r)}for(let r of this.ps)this.fs(r);this.ps=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.ws,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Os(this.gs)}isActiveQueryTarget(e){let t=!1;return this.gs.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ns(e,"pending")}updateMutationState(e,t,r){this.Ns(e,t,r),this.Ls(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(Ud(this.persistenceKey,e));if(r){let i=Io.Ts(e,r);i&&(t=i.state)}}return this.Bs.ds(e),this.Fs(),t}removeLocalQueryTarget(e){this.Bs.As(e),this.Fs()}isLocalQueryTarget(e){return this.Bs.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Ud(this.persistenceKey,e))}updateQueryState(e,t,r){this.ks(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Ls(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.qs(e)}notifyBundleLoaded(e){this.Qs(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Vs),this.removeItem(this.ys),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return v("SharedClientState","READ",e,t),t}setItem(e,t){v("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){v("SharedClientState","REMOVE",e),this.storage.removeItem(e)}fs(e){let t=e;if(t.storageArea===this.storage){if(v("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ys)return void ge("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.si.enqueueRetryable(()=>g(this,null,function*(){if(this.started){if(t.key!==null){if(this.Ss.test(t.key)){if(t.newValue==null){let r=this.Ks(t.key);return this.$s(r,null)}{let r=this.Us(t.key,t.newValue);if(r)return this.$s(r.clientId,r)}}else if(this.bs.test(t.key)){if(t.newValue!==null){let r=this.Ws(t.key,t.newValue);if(r)return this.Gs(r)}}else if(this.Ds.test(t.key)){if(t.newValue!==null){let r=this.zs(t.key,t.newValue);if(r)return this.js(r)}}else if(t.key===this.Cs){if(t.newValue!==null){let r=this.Ms(t.newValue);if(r)return this.xs(r)}}else if(t.key===this.ws){let r=function(s){let o=nt.oe;if(s!=null)try{let a=JSON.parse(s);P(typeof a=="number"),o=a}catch(a){ge("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==nt.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.vs){let r=this.Hs(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.Js(i)))}}}else this.ps.push(t)}))}}get Bs(){return this.gs.get(this.Rs)}Fs(){this.setItem(this.ys,this.Bs.Es())}Ns(e,t,r){let i=new Ic(this.currentUser,e,t,r),s=Jw(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Es())}Ls(e){let t=Jw(this.persistenceKey,this.currentUser,e);this.removeItem(t)}qs(e){let t={clientId:this.Rs,onlineState:e};this.storage.setItem(this.Cs,JSON.stringify(t))}ks(e,t,r){let i=Ud(this.persistenceKey,e),s=new Io(e,t,r);this.setItem(i,s.Es())}Qs(e){let t=JSON.stringify(Array.from(e));this.setItem(this.vs,t)}Ks(e){let t=this.Ss.exec(e);return t?t[1]:null}Us(e,t){let r=this.Ks(e);return Tc.Ts(r,t)}Ws(e,t){let r=this.bs.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return Ic.Ts(new we(s),i,t)}zs(e,t){let r=this.Ds.exec(e),i=Number(r[1]);return Io.Ts(i,t)}Ms(e){return Zf.Ts(e)}Hs(e){return JSON.parse(e)}Gs(e){return g(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Ys(e.batchId,e.state,e.error);v("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}js(e){return this.syncEngine.Zs(e.targetId,e.state,e.error)}$s(e,t){let r=t?this.gs.insert(e,t):this.gs.remove(e),i=this.Os(this.gs),s=this.Os(r),o=[],a=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||a.push(u)}),this.syncEngine.Xs(o,a).then(()=>{this.gs=r})}xs(e){this.gs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Os(e){let t=Hp();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},Ac=class{constructor(){this.eo=new Uo,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.eo.ds(e),this.no[e]||"not-current"}updateQueryState(e,t,r){this.no[e]=t}removeLocalQueryTarget(e){this.eo.As(e)}isLocalQueryTarget(e){return this.eo.activeTargetIds.has(e)}clearQueryState(e){delete this.no[e]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(e){return this.eo.activeTargetIds.has(e)}start(){return this.eo=new Uo,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var ep=class{ro(e){}shutdown(){}};var Cc=class{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(e){this.ao.push(e)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){v("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ao)e(0)}_o(){v("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ao)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Bu=null;function jd(){return Bu===null?Bu=function(){return 268435456+Math.round(2147483648*Math.random())}():Bu++,"0x"+Bu.toString(16)}var lD={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var tp=class{constructor(e){this.co=e.co,this.lo=e.lo}ho(e){this.Po=e}Io(e){this.To=e}Eo(e){this.Ao=e}onMessage(e){this.Ro=e}close(){this.lo()}send(e){this.co(e)}Vo(){this.Po()}mo(){this.To()}fo(e){this.Ao(e)}po(e){this.Ro(e)}};var je="WebChannelConnection",np=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.yo=r+"://"+t.host,this.wo=`projects/${i}/databases/${s}`,this.So=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get bo(){return!1}Do(t,r,i,s,o){let a=jd(),u=this.Co(t,r.toUriEncodedString());v("RestConnection",`Sending RPC '${t}' ${a}:`,u,i);let c={"google-cloud-resource-prefix":this.wo,"x-goog-request-params":this.So};return this.vo(c,s,o),this.Fo(t,u,c,i).then(l=>(v("RestConnection",`Received RPC '${t}' ${a}: `,l),l),l=>{throw ht("RestConnection",`RPC '${t}' ${a} failed with error: `,l,"url: ",u,"request:",i),l})}Mo(t,r,i,s,o,a){return this.Do(t,r,i,s,o)}vo(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+ji}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}Co(t,r){let i=lD[t];return`${this.yo}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Fo(e,t,r,i){let s=jd();return new Promise((o,a)=>{let u=new aw;u.setWithCredentials(!0),u.listenOnce(iw.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Fu.NO_ERROR:let l=u.getResponseJson();v(je,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(l)),o(l);break;case Fu.TIMEOUT:v(je,`RPC '${e}' ${s} timed out`),a(new y(m.DEADLINE_EXCEEDED,"Request time out"));break;case Fu.HTTP_ERROR:let h=u.getStatus();if(v(je,`RPC '${e}' ${s} failed with status:`,h,"response text:",u.getResponseText()),h>0){let d=u.getResponseJson();Array.isArray(d)&&(d=d[0]);let f=d?.error;if(f&&f.status&&f.message){let E=function(_){let D=_.toLowerCase().replace(/_/g,"-");return Object.values(m).indexOf(D)>=0?D:m.UNKNOWN}(f.status);a(new y(E,f.message))}else a(new y(m.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new y(m.UNAVAILABLE,"Connection failed."));break;default:S()}}finally{v(je,`RPC '${e}' ${s} completed.`)}});let c=JSON.stringify(i);v(je,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",c,r,15)})}xo(e,t,r){let i=jd(),s=[this.yo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=nw(),a=rw(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.xmlHttpFactory=new ow({})),this.vo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;let l=s.join("");v(je,`Creating RPC '${e}' stream ${i}: ${l}`,u);let h=o.createWebChannel(l,u),d=!1,f=!1,E=new tp({co:_=>{f?v(je,`Not sending because RPC '${e}' stream ${i} is closed:`,_):(d||(v(je,`Opening RPC '${e}' stream ${i} transport.`),h.open(),d=!0),v(je,`RPC '${e}' stream ${i} sending:`,_),h.send(_))},lo:()=>h.close()}),w=(_,D,M)=>{_.listen(D,C=>{try{M(C)}catch(V){setTimeout(()=>{throw V},0)}})};return w(h,ho.EventType.OPEN,()=>{f||(v(je,`RPC '${e}' stream ${i} transport opened.`),E.Vo())}),w(h,ho.EventType.CLOSE,()=>{f||(f=!0,v(je,`RPC '${e}' stream ${i} transport closed`),E.fo())}),w(h,ho.EventType.ERROR,_=>{f||(f=!0,ht(je,`RPC '${e}' stream ${i} transport errored:`,_),E.fo(new y(m.UNAVAILABLE,"The operation could not be completed")))}),w(h,ho.EventType.MESSAGE,_=>{var D;if(!f){let M=_.data[0];P(!!M);let C=M,V=C.error||((D=C[0])===null||D===void 0?void 0:D.error);if(V){v(je,`RPC '${e}' stream ${i} received error:`,V);let L=V.status,z=function(mA){let Wg=_e[mA];if(Wg!==void 0)return KE(Wg)}(L),le=V.message;z===void 0&&(z=m.INTERNAL,le="Unknown error status: "+L+" with message "+V.message),f=!0,E.fo(new y(z,le)),h.close()}else v(je,`RPC '${e}' stream ${i} received:`,M),E.po(M)}}),w(a,sw.STAT_EVENT,_=>{_.stat===Od.PROXY?v(je,`RPC '${e}' stream ${i} detected buffering proxy`):_.stat===Od.NOPROXY&&v(je,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{E.mo()},0),E}};function II(){return typeof window<"u"?window:null}function Hu(){return typeof document<"u"?document:null}function Yo(n){return new vf(n,!0)}var jo=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.si=e,this.timerId=t,this.Oo=r,this.No=i,this.Lo=s,this.Bo=0,this.ko=null,this.qo=Date.now(),this.reset()}reset(){this.Bo=0}Qo(){this.Bo=this.Lo}Ko(e){this.cancel();let t=Math.floor(this.Bo+this.$o()),r=Math.max(0,Date.now()-this.qo),i=Math.max(0,t-r);i>0&&v("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Bo} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.ko=this.si.enqueueAfterDelay(this.timerId,i,()=>(this.qo=Date.now(),e())),this.Bo*=this.No,this.Bo<this.Oo&&(this.Bo=this.Oo),this.Bo>this.Lo&&(this.Bo=this.Lo)}Uo(){this.ko!==null&&(this.ko.skipDelay(),this.ko=null)}cancel(){this.ko!==null&&(this.ko.cancel(),this.ko=null)}$o(){return(Math.random()-.5)*this.Bo}};var Sc=class{constructor(e,t,r,i,s,o,a,u){this.si=e,this.Wo=r,this.Go=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.zo=0,this.jo=null,this.Ho=null,this.stream=null,this.Jo=new jo(e,t)}Yo(){return this.state===1||this.state===5||this.Zo()}Zo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Xo()}stop(){return g(this,null,function*(){this.Yo()&&(yield this.close(0))})}e_(){this.state=0,this.Jo.reset()}t_(){this.Zo()&&this.jo===null&&(this.jo=this.si.enqueueAfterDelay(this.Wo,6e4,()=>this.n_()))}r_(e){this.i_(),this.stream.send(e)}n_(){return g(this,null,function*(){if(this.Zo())return this.close(0)})}i_(){this.jo&&(this.jo.cancel(),this.jo=null)}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}close(e,t){return g(this,null,function*(){this.i_(),this.s_(),this.Jo.cancel(),this.zo++,e!==4?this.Jo.reset():t&&t.code===m.RESOURCE_EXHAUSTED?(ge(t.toString()),ge("Using maximum backoff delay to prevent overloading the backend."),this.Jo.Qo()):t&&t.code===m.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.o_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.Eo(t)})}o_(){}auth(){this.state=1;let e=this.__(this.zo),t=this.zo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.zo===t&&this.a_(r,i)},r=>{e(()=>{let i=new y(m.UNKNOWN,"Fetching auth token failed: "+r.message);return this.u_(i)})})}a_(e,t){let r=this.__(this.zo);this.stream=this.c_(e,t),this.stream.ho(()=>{r(()=>this.listener.ho())}),this.stream.Io(()=>{r(()=>(this.state=2,this.Ho=this.si.enqueueAfterDelay(this.Go,1e4,()=>(this.Zo()&&(this.state=3),Promise.resolve())),this.listener.Io()))}),this.stream.Eo(i=>{r(()=>this.u_(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Xo(){this.state=5,this.Jo.Ko(()=>g(this,null,function*(){this.state=0,this.start()}))}u_(e){return v("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}__(e){return t=>{this.si.enqueueAndForget(()=>this.zo===e?t():(v("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},rp=class extends Sc{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}c_(e,t){return this.connection.xo("Listen",e,t)}onMessage(e){this.Jo.reset();let t=KR(this.serializer,e),r=function(s){if(!("targetChange"in s))return x.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?x.min():o.readTime?ye(o.readTime):x.min()}(e);return this.listener.l_(t,r)}h_(e){let t={};t.database=If(this.serializer),t.addTarget=function(s,o){let a,u=o.target;if(a=rc(u)?{documents:nI(s,u)}:{query:rI(s,u)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=YE(s,o.resumeToken);let c=wf(s,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(x.min())>0){a.readTime=Di(s,o.snapshotVersion.toTimestamp());let c=wf(s,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);let r=YR(this.serializer,e);r&&(t.labels=r),this.r_(t)}P_(e){let t={};t.database=If(this.serializer),t.removeTarget=e,this.r_(t)}},ip=class extends Sc{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.I_=!1}get T_(){return this.I_}start(){this.I_=!1,this.lastStreamToken=void 0,super.start()}o_(){this.I_&&this.E_([])}c_(e,t){return this.connection.xo("Write",e,t)}onMessage(e){if(P(!!e.streamToken),this.lastStreamToken=e.streamToken,this.I_){this.Jo.reset();let t=QR(e.writeResults,e.commitTime),r=ye(e.commitTime);return this.listener.d_(r,t)}return P(!e.writeResults||e.writeResults.length===0),this.I_=!0,this.listener.A_()}R_(){let e={};e.database=If(this.serializer),this.r_(e)}E_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>Oo(this.serializer,r))};this.r_(t)}};var sp=class extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.V_=!1}m_(){if(this.V_)throw new y(m.FAILED_PRECONDITION,"The client has already been terminated.")}Do(e,t,r,i){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Do(e,Ef(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===m.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new y(m.UNKNOWN,s.toString())})}Mo(e,t,r,i,s){return this.m_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Mo(e,Ef(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===m.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new y(m.UNKNOWN,o.toString())})}terminate(){this.V_=!0,this.connection.terminate()}};var op=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){this.g_===0&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(e){this.state==="Online"?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.S_("Offline")))}set(e){this.C_(),this.g_=0,e==="Online"&&(this.y_=!1),this.S_(e)}S_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}b_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(ge(t),this.y_=!1):v("OnlineStateTracker",t)}C_(){this.p_!==null&&(this.p_.cancel(),this.p_=null)}};var ap=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=s,this.O_.ro(o=>{r.enqueueAndForget(()=>g(this,null,function*(){zn(this)&&(v("RemoteStore","Restarting streams for network reachability change."),yield function(u){return g(this,null,function*(){let c=T(u);c.M_.add(4),yield qi(c),c.N_.set("Unknown"),c.M_.delete(4),yield Xo(c)})}(this))}))}),this.N_=new op(r,i)}};function Xo(n){return g(this,null,function*(){if(zn(n))for(let e of n.x_)yield e(!0)})}function qi(n){return g(this,null,function*(){for(let e of n.x_)yield e(!1)})}function Gc(n,e){let t=T(n);t.F_.has(e.targetId)||(t.F_.set(e.targetId,e),Zp(t)?Jp(t):zi(t).Zo()&&Xp(t,e))}function Ni(n,e){let t=T(n),r=zi(t);t.F_.delete(e),r.Zo()&&TI(t,e),t.F_.size===0&&(r.Zo()?r.t_():zn(t)&&t.N_.set("Unknown"))}function Xp(n,e){if(n.L_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(x.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}zi(n).h_(e)}function TI(n,e){n.L_.xe(e),zi(n).P_(e)}function Jp(n){n.L_=new _f({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.F_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),zi(n).start(),n.N_.w_()}function Zp(n){return zn(n)&&!zi(n).Yo()&&n.F_.size>0}function zn(n){return T(n).M_.size===0}function AI(n){n.L_=void 0}function hD(n){return g(this,null,function*(){n.N_.set("Online")})}function dD(n){return g(this,null,function*(){n.F_.forEach((e,t)=>{Xp(n,e)})})}function fD(n,e){return g(this,null,function*(){AI(n),Zp(n)?(n.N_.D_(e),Jp(n)):n.N_.set("Unknown")})}function pD(n,e,t){return g(this,null,function*(){if(n.N_.set("Online"),e instanceof ac&&e.state===2&&e.cause)try{yield function(i,s){return g(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.F_.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.F_.delete(a),i.L_.removeTarget(a))})}(n,e)}catch(r){v("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield bc(n,r)}else if(e instanceof Ii?n.L_.Ke(e):e instanceof oc?n.L_.He(e):n.L_.We(e),!t.isEqual(x.min()))try{let r=yield yI(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){let a=s.L_.rt(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){let l=s.F_.get(c);l&&s.F_.set(c,l.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{let l=s.F_.get(u);if(!l)return;s.F_.set(u,l.withResumeToken(Re.EMPTY_BYTE_STRING,l.snapshotVersion)),TI(s,u);let h=new Pi(l.target,u,c,l.sequenceNumber);Xp(s,h)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){v("RemoteStore","Failed to raise snapshot:",r),yield bc(n,r)}})}function bc(n,e,t){return g(this,null,function*(){if(!$n(e))throw e;n.M_.add(1),yield qi(n),n.N_.set("Offline"),t||(t=()=>yI(n.localStore)),n.asyncQueue.enqueueRetryable(()=>g(this,null,function*(){v("RemoteStore","Retrying IndexedDB access"),yield t(),n.M_.delete(1),yield Xo(n)}))})}function CI(n,e){return e().catch(t=>bc(n,t,e))}function $i(n){return g(this,null,function*(){let e=T(n),t=Bn(e),r=e.v_.length>0?e.v_[e.v_.length-1].batchId:-1;for(;gD(e);)try{let i=yield aD(e.localStore,r);if(i===null){e.v_.length===0&&t.t_();break}r=i.batchId,mD(e,i)}catch(i){yield bc(e,i)}SI(e)&&bI(e)})}function gD(n){return zn(n)&&n.v_.length<10}function mD(n,e){n.v_.push(e);let t=Bn(n);t.Zo()&&t.T_&&t.E_(e.mutations)}function SI(n){return zn(n)&&!Bn(n).Yo()&&n.v_.length>0}function bI(n){Bn(n).start()}function yD(n){return g(this,null,function*(){Bn(n).R_()})}function _D(n){return g(this,null,function*(){let e=Bn(n);for(let t of n.v_)e.E_(t.mutations)})}function vD(n,e,t){return g(this,null,function*(){let r=n.v_.shift(),i=gf.from(r,e,t);yield CI(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield $i(n)})}function wD(n,e){return g(this,null,function*(){e&&Bn(n).T_&&(yield function(r,i){return g(this,null,function*(){if(function(o){return WE(o)&&o!==m.ABORTED}(i.code)){let s=r.v_.shift();Bn(r).e_(),yield CI(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield $i(r)}})}(n,e)),SI(n)&&bI(n)})}function Zw(n,e){return g(this,null,function*(){let t=T(n);t.asyncQueue.verifyOperationInProgress(),v("RemoteStore","RemoteStore received new credentials");let r=zn(t);t.M_.add(3),yield qi(t),r&&t.N_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.M_.delete(3),yield Xo(t)})}function up(n,e){return g(this,null,function*(){let t=T(n);e?(t.M_.delete(2),yield Xo(t)):e||(t.M_.add(2),yield qi(t),t.N_.set("Unknown"))})}function zi(n){return n.B_||(n.B_=function(t,r,i){let s=T(t);return s.m_(),new rp(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:hD.bind(null,n),Io:dD.bind(null,n),Eo:fD.bind(null,n),l_:pD.bind(null,n)}),n.x_.push(e=>g(this,null,function*(){e?(n.B_.e_(),Zp(n)?Jp(n):n.N_.set("Unknown")):(yield n.B_.stop(),AI(n))}))),n.B_}function Bn(n){return n.k_||(n.k_=function(t,r,i){let s=T(t);return s.m_(),new ip(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:()=>Promise.resolve(),Io:yD.bind(null,n),Eo:wD.bind(null,n),A_:_D.bind(null,n),d_:vD.bind(null,n)}),n.x_.push(e=>g(this,null,function*(){e?(n.k_.e_(),yield $i(n)):(yield n.k_.stop(),n.v_.length>0&&(v("RemoteStore",`Stopping write stream with ${n.v_.length} pending writes`),n.v_=[]))}))),n.k_}var cp=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Ee,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new y(m.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Gi(n,e){if(ge("AsyncQueue",`${e}: ${n}`),$n(n))return new y(m.UNAVAILABLE,`${e}: ${n}`);throw n}var Rc=class n{constructor(e){this.comparator=e?(t,r)=>e(t,r)||I.comparator(t.key,r.key):(t,r)=>I.comparator(t.key,r.key),this.keyedMap=yo(),this.sortedSet=new se(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Dc=class{constructor(){this.q_=new se(I.comparator)}track(e){let t=e.doc.key,r=this.q_.get(t);r?e.type!==0&&r.type===3?this.q_=this.q_.insert(t,e):e.type===3&&r.type!==1?this.q_=this.q_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.q_=this.q_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.q_=this.q_.remove(t):e.type===1&&r.type===2?this.q_=this.q_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):S():this.q_=this.q_.insert(t,e)}Q_(){let e=[];return this.q_.inorderTraversal((t,r)=>{e.push(r)}),e}},Mi=class n{constructor(e,t,r,i,s,o,a,u,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,Rc.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ko(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var lp=class{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(e=>e.G_())}},hp=class{constructor(){this.queries=new zt(e=>xE(e),Ko),this.onlineState="Unknown",this.z_=new Set}};function eg(n,e){return g(this,null,function*(){let t=T(n),r=3,i=e.query,s=t.queries.get(i);s?!s.W_()&&e.G_()&&(r=2):(s=new lp,r=e.G_()?0:1);try{switch(r){case 0:s.K_=yield t.onListen(i,!0);break;case 1:s.K_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let a=Gi(o,`Initialization of query '${gi(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.U_.push(e),e.j_(t.onlineState),s.K_&&e.H_(s.K_)&&ng(t)})}function tg(n,e){return g(this,null,function*(){let t=T(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.U_.indexOf(e);o>=0&&(s.U_.splice(o,1),s.U_.length===0?i=e.G_()?0:1:!s.W_()&&e.G_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function ED(n,e){let t=T(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.U_)a.H_(i)&&(r=!0);o.K_=i}}r&&ng(t)}function ID(n,e,t){let r=T(n),i=r.queries.get(e);if(i)for(let s of i.U_)s.onError(t);r.queries.delete(e)}function ng(n){n.z_.forEach(e=>{e.next()})}var dp,eE;(eE=dp||(dp={})).J_="default",eE.Cache="cache";var Bo=class{constructor(e,t,r){this.query=e,this.Y_=t,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=r||{}}H_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Mi(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),t=!0):this.ta(e,this.onlineState)&&(this.na(e),t=!0),this.X_=e,t}onError(e){this.Y_.error(e)}j_(e){this.onlineState=e;let t=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),t=!0),t}ta(e,t){if(!e.fromCache||!this.G_())return!0;let r=t!=="Offline";return(!this.options.ra||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ea(e){if(e.docChanges.length>0)return!0;let t=this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}na(e){e=Mi.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}G_(){return this.options.source!==dp.Cache}};var fp=class{constructor(e,t){this.ia=e,this.byteLength=t}sa(){return"metadata"in this.ia}};var Pc=class{constructor(e){this.serializer=e}hs(e){return jt(this.serializer,e)}Ps(e){return e.metadata.exists?tI(this.serializer,e.document,!1):Ie.newNoDocument(this.hs(e.metadata.name),this.Is(e.metadata.readTime))}Is(e){return ye(e)}},pp=class{constructor(e,t,r){this.oa=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=RI(e)}_a(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ia.namedQuery)this.queries.push(e.ia.namedQuery);else if(e.ia.documentMetadata){this.documents.push({metadata:e.ia.documentMetadata}),e.ia.documentMetadata.exists||++t;let r=W.fromString(e.ia.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.ia.document&&(this.documents[this.documents.length-1].document=e.ia.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}aa(e){let t=new Map,r=new Pc(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.hs(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||j()).add(s);t.set(o,a)}}return t}complete(){return g(this,null,function*(){let e=yield uD(this.localStore,new Pc(this.serializer),this.documents,this.oa.id),t=this.aa(this.documents);for(let r of this.queries)yield cD(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,ua:this.collectionGroups,ca:e}})}};function RI(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var kc=class{constructor(e){this.key=e}},xc=class{constructor(e){this.key=e}},Vc=class{constructor(e,t){this.query=e,this.la=t,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=j(),this.mutatedKeys=j(),this.Ia=NE(e),this.Ta=new Rc(this.Ia)}get Ea(){return this.la}da(e,t){let r=t?t.Aa:new Dc,i=t?t.Ta:this.Ta,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((l,h)=>{let d=i.get(l),f=Qo(this.query,h)?h:null,E=!!d&&this.mutatedKeys.has(d.key),w=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations),_=!1;d&&f?d.data.isEqual(f.data)?E!==w&&(r.track({type:3,doc:f}),_=!0):this.Ra(d,f)||(r.track({type:2,doc:f}),_=!0,(u&&this.Ia(f,u)>0||c&&this.Ia(f,c)<0)&&(a=!0)):!d&&f?(r.track({type:0,doc:f}),_=!0):d&&!f&&(r.track({type:1,doc:d}),_=!0,(u||c)&&(a=!0)),_&&(f?(o=o.add(f),s=w?s.add(l):s.delete(l)):(o=o.delete(l),s=s.delete(l)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let l=this.query.limitType==="F"?o.last():o.first();o=o.delete(l.key),s=s.delete(l.key),r.track({type:1,doc:l})}return{Ta:o,Aa:r,Zi:a,mutatedKeys:s}}Ra(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;let o=e.Aa.Q_();o.sort((l,h)=>function(f,E){let w=_=>{switch(_){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return S()}};return w(f)-w(E)}(l.type,h.type)||this.Ia(l.doc,h.doc)),this.Va(r),i=i!=null&&i;let a=t&&!i?this.ma():[],u=this.Pa.size===0&&this.current&&!i?1:0,c=u!==this.ha;return this.ha=u,o.length!==0||c?{snapshot:new Mi(this.query,e.Ta,s,o,e.mutatedKeys,u===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),fa:a}:{fa:a}}j_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new Dc,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{fa:[]}}ga(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}Va(e){e&&(e.addedDocuments.forEach(t=>this.la=this.la.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.la=this.la.delete(t)),this.current=e.current)}ma(){if(!this.current)return[];let e=this.Pa;this.Pa=j(),this.Ta.forEach(r=>{this.ga(r.key)&&(this.Pa=this.Pa.add(r.key))});let t=[];return e.forEach(r=>{this.Pa.has(r)||t.push(new xc(r))}),this.Pa.forEach(r=>{e.has(r)||t.push(new kc(r))}),t}pa(e){this.la=e.ls,this.Pa=j();let t=this.da(e.documents);return this.applyChanges(t,!0)}ya(){return Mi.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,this.ha===0,this.hasCachedResults)}},gp=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},mp=class{constructor(e){this.key=e,this.wa=!1}},yp=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Sa={},this.ba=new zt(a=>xE(a),Ko),this.Da=new Map,this.Ca=new Set,this.va=new se(I.comparator),this.Fa=new Map,this.Ma=new Lo,this.xa={},this.Oa=new Map,this.Na=ki.Nn(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return this.La===!0}};function TD(n,e,t=!0){return g(this,null,function*(){let r=Hc(n),i,s=r.ba.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ya()):i=yield DI(r,e,t,!0),i})}function AD(n,e){return g(this,null,function*(){let t=Hc(n);yield DI(t,e,!0,!1)})}function DI(n,e,t,r){return g(this,null,function*(){let i=yield xi(n.localStore,We(e)),s=i.targetId,o=t?n.sharedClientState.addLocalQueryTarget(s):"not-current",a;return r&&(a=yield rg(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&Gc(n.remoteStore,i),a})}function rg(n,e,t,r,i){return g(this,null,function*(){n.Ba=(h,d,f)=>function(w,_,D,M){return g(this,null,function*(){let C=_.view.da(D);C.Zi&&(C=yield Ec(w.localStore,_.query,!1).then(({documents:le})=>_.view.da(le,C)));let V=M&&M.targetChanges.get(_.targetId),L=M&&M.targetMismatches.get(_.targetId)!=null,z=_.view.applyChanges(C,w.isPrimaryClient,V,L);return _p(w,_.targetId,z.fa),z.snapshot})}(n,h,d,f);let s=yield Ec(n.localStore,e,!0),o=new Vc(e,s.ls),a=o.da(s.documents),u=No.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,u);_p(n,t,c.fa);let l=new gp(e,t,o);return n.ba.set(e,l),n.Da.has(t)?n.Da.get(t).push(e):n.Da.set(t,[e]),c.snapshot})}function CD(n,e,t){return g(this,null,function*(){let r=T(n),i=r.ba.get(e),s=r.Da.get(i.targetId);if(s.length>1)return r.Da.set(i.targetId,s.filter(o=>!Ko(o,e))),void r.ba.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Vi(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Ni(r.remoteStore,i.targetId),Oi(r,i.targetId)}).catch(qn))):(Oi(r,i.targetId),yield Vi(r.localStore,i.targetId,!0))})}function SD(n,e){return g(this,null,function*(){let t=T(n),r=t.ba.get(e),i=t.Da.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Ni(t.remoteStore,r.targetId))})}function bD(n,e,t){return g(this,null,function*(){let r=ag(n);try{let i=yield function(o,a){let u=T(o),c=ce.now(),l=a.reduce((f,E)=>f.add(E.key),j()),h,d;return u.persistence.runTransaction("Locally write mutations","readwrite",f=>{let E=Xe(),w=j();return u.ss.getEntries(f,l).next(_=>{E=_,E.forEach((D,M)=>{M.isValidDocument()||(w=w.add(D))})}).next(()=>u.localDocuments.getOverlayedDocuments(f,E)).next(_=>{h=_;let D=[];for(let M of a){let C=BR(M,h.get(M.key).overlayedDocument);C!=null&&D.push(new At(M.key,C,CE(C.value.mapValue),fe.exists(!0)))}return u.mutationQueue.addMutationBatch(f,c,D,a)}).next(_=>{d=_;let D=_.applyToLocalDocumentSet(h,w);return u.documentOverlayCache.saveOverlays(f,_.batchId,D)})}).then(()=>({batchId:d.batchId,changes:OE(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let c=o.xa[o.currentUser.toKey()];c||(c=new se(U)),c=c.insert(a,u),o.xa[o.currentUser.toKey()]=c}(r,i.batchId,t),yield cn(r,i.changes),yield $i(r.remoteStore)}catch(i){let s=Gi(i,"Failed to persist write");t.reject(s)}})}function PI(n,e){return g(this,null,function*(){let t=T(n);try{let r=yield oD(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Fa.get(s);o&&(P(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.wa=!0:i.modifiedDocuments.size>0?P(o.wa):i.removedDocuments.size>0&&(P(o.wa),o.wa=!1))}),yield cn(t,r,e)}catch(r){yield qn(r)}})}function tE(n,e,t){let r=T(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.ba.forEach((s,o)=>{let a=o.view.j_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){let u=T(o);u.onlineState=a;let c=!1;u.queries.forEach((l,h)=>{for(let d of h.U_)d.j_(a)&&(c=!0)}),c&&ng(u)}(r.eventManager,e),i.length&&r.Sa.l_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function RD(n,e,t){return g(this,null,function*(){let r=T(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Fa.get(e),s=i&&i.key;if(s){let o=new se(I.comparator);o=o.insert(s,Ie.newNoDocument(s,x.min()));let a=j().add(s),u=new Vo(x.min(),new Map,new se(U),o,a);yield PI(r,u),r.va=r.va.remove(s),r.Fa.delete(e),og(r)}else yield Vi(r.localStore,e,!1).then(()=>Oi(r,e,t)).catch(qn)})}function DD(n,e){return g(this,null,function*(){let t=T(n),r=e.batch.batchId;try{let i=yield sD(t.localStore,e);sg(t,r,null),ig(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield cn(t,i)}catch(i){yield qn(i)}})}function PD(n,e,t){return g(this,null,function*(){let r=T(n);try{let i=yield function(o,a){let u=T(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return u.mutationQueue.lookupMutationBatch(c,a).next(h=>(P(h!==null),l=h.keys(),u.mutationQueue.removeMutationBatch(c,h))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,l,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,l)).next(()=>u.localDocuments.getDocuments(c,l))})}(r.localStore,e);sg(r,e,t),ig(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield cn(r,i)}catch(i){yield qn(i)}})}function kD(n,e){return g(this,null,function*(){let t=T(n);zn(t.remoteStore)||v("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield function(o){let a=T(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(t.localStore);if(r===-1)return void e.resolve();let i=t.Oa.get(r)||[];i.push(e),t.Oa.set(r,i)}catch(r){let i=Gi(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function ig(n,e){(n.Oa.get(e)||[]).forEach(t=>{t.resolve()}),n.Oa.delete(e)}function sg(n,e,t){let r=T(n),i=r.xa[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.xa[r.currentUser.toKey()]=i}}function Oi(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Da.get(e))n.ba.delete(r),t&&n.Sa.ka(r,t);n.Da.delete(e),n.isPrimaryClient&&n.Ma.Rr(e).forEach(r=>{n.Ma.containsKey(r)||kI(n,r)})}function kI(n,e){n.Ca.delete(e.path.canonicalString());let t=n.va.get(e);t!==null&&(Ni(n.remoteStore,t),n.va=n.va.remove(e),n.Fa.delete(t),og(n))}function _p(n,e,t){for(let r of t)r instanceof kc?(n.Ma.addReference(r.key,e),xD(n,r)):r instanceof xc?(v("SyncEngine","Document no longer in limbo: "+r.key),n.Ma.removeReference(r.key,e),n.Ma.containsKey(r.key)||kI(n,r.key)):S()}function xD(n,e){let t=e.key,r=t.path.canonicalString();n.va.get(t)||n.Ca.has(r)||(v("SyncEngine","New document in limbo: "+t),n.Ca.add(r),og(n))}function og(n){for(;n.Ca.size>0&&n.va.size<n.maxConcurrentLimboResolutions;){let e=n.Ca.values().next().value;n.Ca.delete(e);let t=new I(W.fromString(e)),r=n.Na.next();n.Fa.set(r,new mp(t)),n.va=n.va.insert(t,r),Gc(n.remoteStore,new Pi(We(Bi(t.path)),r,"TargetPurposeLimboResolution",nt.oe))}}function cn(n,e,t){return g(this,null,function*(){let r=T(n),i=[],s=[],o=[];r.ba.isEmpty()||(r.ba.forEach((a,u)=>{o.push(r.Ba(u,e,t).then(c=>{if((c||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);let l=Yf.Qi(u.targetId,c);s.push(l)}}))}),yield Promise.all(o),r.Sa.l_(i),yield function(u,c){return g(this,null,function*(){let l=T(u);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>p.forEach(c,d=>p.forEach(d.ki,f=>l.persistence.referenceDelegate.addReference(h,d.targetId,f)).next(()=>p.forEach(d.qi,f=>l.persistence.referenceDelegate.removeReference(h,d.targetId,f)))))}catch(h){if(!$n(h))throw h;v("LocalStore","Failed to update sequence numbers: "+h)}for(let h of c){let d=h.targetId;if(!h.fromCache){let f=l.ts.get(d),E=f.snapshotVersion,w=f.withLastLimboFreeSnapshotVersion(E);l.ts=l.ts.insert(d,w)}}})}(r.localStore,s))})}function VD(n,e){return g(this,null,function*(){let t=T(n);if(!t.currentUser.isEqual(e)){v("SyncEngine","User change. New user:",e.toKey());let r=yield mI(t.localStore,e);t.currentUser=e,function(s,o){s.Oa.forEach(a=>{a.forEach(u=>{u.reject(new y(m.CANCELLED,o))})}),s.Oa.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield cn(t,r._s)}})}function ND(n,e){let t=T(n),r=t.Fa.get(e);if(r&&r.wa)return j().add(r.key);{let i=j(),s=t.Da.get(e);if(!s)return i;for(let o of s){let a=t.ba.get(o);i=i.unionWith(a.view.Ea)}return i}}function MD(n,e){return g(this,null,function*(){let t=T(n),r=yield Ec(t.localStore,e.query,!0),i=e.view.pa(r);return t.isPrimaryClient&&_p(t,e.targetId,i.fa),i})}function OD(n,e){return g(this,null,function*(){let t=T(n);return wI(t.localStore,e).then(r=>cn(t,r))})}function FD(n,e,t,r){return g(this,null,function*(){let i=T(n),s=yield function(a,u){let c=T(a),l=T(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",h=>l.Cn(h,u).next(d=>d?c.localDocuments.getDocuments(h,d):p.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?yield $i(i.remoteStore):t==="acknowledged"||t==="rejected"?(sg(i,e,r||null),ig(i,e),function(a,u){T(T(a).mutationQueue).Fn(u)}(i.localStore,e)):S(),yield cn(i,s)):v("SyncEngine","Cannot apply mutation batch with id: "+e)})}function LD(n,e){return g(this,null,function*(){let t=T(n);if(Hc(t),ag(t),e===!0&&t.La!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield nE(t,r.toArray());t.La=!0,yield up(t.remoteStore,!0);for(let s of i)Gc(t.remoteStore,s)}else if(e===!1&&t.La!==!1){let r=[],i=Promise.resolve();t.Da.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Oi(t,o),Vi(t.localStore,o,!0))),Ni(t.remoteStore,o)}),yield i,yield nE(t,r),function(o){let a=T(o);a.Fa.forEach((u,c)=>{Ni(a.remoteStore,c)}),a.Ma.Vr(),a.Fa=new Map,a.va=new se(I.comparator)}(t),t.La=!1,yield up(t.remoteStore,!1)}})}function nE(n,e,t){return g(this,null,function*(){let r=T(n),i=[],s=[];for(let o of e){let a,u=r.Da.get(o);if(u&&u.length!==0){a=yield xi(r.localStore,We(u[0]));for(let c of u){let l=r.ba.get(c),h=yield MD(r,l);h.snapshot&&s.push(h.snapshot)}}else{let c=yield vI(r.localStore,o);a=yield xi(r.localStore,c),yield rg(r,xI(c),o,!1,a.resumeToken)}i.push(a)}return r.Sa.l_(s),i})}function xI(n){return kE(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function UD(n){return function(t){return T(T(t).persistence).Li()}(T(n).localStore)}function jD(n,e,t,r){return g(this,null,function*(){let i=T(n);if(i.La)return void v("SyncEngine","Ignoring unexpected query state notification.");let s=i.Da.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield wI(i.localStore,VE(s[0])),a=Vo.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Re.EMPTY_BYTE_STRING);yield cn(i,o,a);break}case"rejected":yield Vi(i.localStore,e,!0),Oi(i,e,r);break;default:S()}})}function BD(n,e,t){return g(this,null,function*(){let r=Hc(n);if(r.La){for(let i of e){if(r.Da.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){v("SyncEngine","Adding an already active target "+i);continue}let s=yield vI(r.localStore,i),o=yield xi(r.localStore,s);yield rg(r,xI(s),o.targetId,!1,o.resumeToken),Gc(r.remoteStore,o)}for(let i of t)r.Da.has(i)&&(yield Vi(r.localStore,i,!1).then(()=>{Ni(r.remoteStore,i),Oi(r,i)}).catch(qn))}})}function Hc(n){let e=T(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=PI.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=ND.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=RD.bind(null,e),e.Sa.l_=ED.bind(null,e.eventManager),e.Sa.ka=ID.bind(null,e.eventManager),e}function ag(n){let e=T(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=DD.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=PD.bind(null,e),e}function qD(n,e,t){let r=T(n);(function(s,o,a){return g(this,null,function*(){try{let u=yield o.getMetadata();if(yield function(f,E){let w=T(f),_=ye(E.createTime);return w.persistence.runTransaction("hasNewerBundle","readonly",D=>w.Kr.getBundleMetadata(D,E.id)).then(D=>!!D&&D.createTime.compareTo(_)>=0)}(s.localStore,u))return yield o.close(),a._completeWith(function(f){return{taskState:"Success",documentsLoaded:f.totalDocuments,bytesLoaded:f.totalBytes,totalDocuments:f.totalDocuments,totalBytes:f.totalBytes}}(u)),Promise.resolve(new Set);a._updateProgress(RI(u));let c=new pp(u,s.localStore,o.serializer),l=yield o.qa();for(;l;){let d=yield c._a(l);d&&a._updateProgress(d),l=yield o.qa()}let h=yield c.complete();return yield cn(s,h.ca,void 0),yield function(f,E){let w=T(f);return w.persistence.runTransaction("Save bundle","readwrite",_=>w.Kr.saveBundleMetadata(_,E))}(s.localStore,u),a._completeWith(h.progress),Promise.resolve(h.ua)}catch(u){return ht("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u),Promise.resolve(new Set)}})})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var qo=class{constructor(){this.synchronizeTabs=!1}initialize(e){return g(this,null,function*(){this.serializer=Yo(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return gI(this.persistence,new wc,e.initialUser,this.serializer)}createPersistence(e){return new _c(vc.jr,this.serializer)}createSharedClientState(e){return new Ac}terminate(){return g(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var Nc=class n extends qo{constructor(e,t,r){super(),this.Qa=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){return g(this,null,function*(){yield cl(n.prototype,this,"initialize").call(this,e),yield this.Qa.initialize(this,e),yield ag(this.Qa.syncEngine),yield $i(this.Qa.remoteStore),yield this.persistence.mi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return gI(this.persistence,new wc,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new Mf(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new Jd(t,this.persistence);return new Xd(e.asyncQueue,r)}createPersistence(e){let t=Yp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?lt.withCacheSize(this.cacheSizeBytes):lt.DEFAULT;return new Qf(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,II(),Hu(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Ac}},vp=class n extends Nc{constructor(e,t){super(e,t,!1),this.Qa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return g(this,null,function*(){yield cl(n.prototype,this,"initialize").call(this,e);let t=this.Qa.syncEngine;this.sharedClientState instanceof To&&(this.sharedClientState.syncEngine={Ys:FD.bind(null,t),Zs:jD.bind(null,t),Xs:BD.bind(null,t),Li:UD.bind(null,t),Js:OD.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.mi(r=>g(this,null,function*(){yield LD(this.Qa.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=II();if(!To.D(t))throw new y(m.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=Yp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new To(t,e.asyncQueue,r,e.clientId,e.initialUser)}},$o=class{initialize(e,t){return g(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>tE(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=VD.bind(null,this.syncEngine),yield up(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new hp}()}createDatastore(e){let t=Yo(e.databaseInfo.databaseId),r=function(s){return new np(s)}(e.databaseInfo);return function(s,o,a,u){return new sp(s,o,a,u)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,s,o,a){return new ap(r,i,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>tE(this.syncEngine,t,0),function(){return Cc.D()?new Cc:new ep}())}createSyncEngine(e,t){return function(i,s,o,a,u,c,l){let h=new yp(i,s,o,a,u,c);return l&&(h.La=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return g(this,null,function*(){var e;yield function(r){return g(this,null,function*(){let i=T(r);v("RemoteStore","RemoteStore shutting down."),i.M_.add(5),yield qi(i),i.O_.shutdown(),i.N_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()})}};function rE(n,e=10240){let t=0;return{read(){return g(this,null,function*(){if(t<n.byteLength){let i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return g(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var Fi=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ka(this.observer.next,e)}error(e){this.observer.error?this.Ka(this.observer.error,e):ge("Uncaught Error in snapshot listener:",e.toString())}$a(){this.muted=!0}Ka(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var wp=class{constructor(e,t){this.Ua=e,this.serializer=t,this.metadata=new Ee,this.buffer=new Uint8Array,this.Wa=function(){return new TextDecoder("utf-8")}(),this.Ga().then(r=>{r&&r.sa()?this.metadata.resolve(r.ia.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.ia)}`))},r=>this.metadata.reject(r))}close(){return this.Ua.cancel()}getMetadata(){return g(this,null,function*(){return this.metadata.promise})}qa(){return g(this,null,function*(){return yield this.getMetadata(),this.Ga()})}Ga(){return g(this,null,function*(){let e=yield this.za();if(e===null)return null;let t=this.Wa.decode(e),r=Number(t);isNaN(r)&&this.ja(`length string (${t}) is not valid number`);let i=yield this.Ha(r);return new fp(JSON.parse(i),e.length+r)})}Ja(){return this.buffer.findIndex(e=>e===123)}za(){return g(this,null,function*(){for(;this.Ja()<0&&!(yield this.Ya()););if(this.buffer.length===0)return null;let e=this.Ja();e<0&&this.ja("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}Ha(e){return g(this,null,function*(){for(;this.buffer.length<e;)(yield this.Ya())&&this.ja("Reached the end of bundle when more is expected.");let t=this.Wa.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}ja(e){throw this.Ua.cancel(),new Error(`Invalid bundle format: ${e}`)}Ya(){return g(this,null,function*(){let e=yield this.Ua.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var Ep=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return g(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new y(m.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(i,s){return g(this,null,function*(){let o=T(i),a={documents:s.map(h=>Mo(o.serializer,h))},u=yield o.Mo("BatchGetDocuments",o.serializer.databaseId,W.emptyPath(),a,s.length),c=new Map;u.forEach(h=>{let d=WR(o.serializer,h);c.set(d.key.toString(),d)});let l=[];return s.forEach(h=>{let d=c.get(h.toString());P(!!d),l.push(d)}),l})}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new jn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return g(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=I.fromPath(r);this.mutations.push(new Po(i,this.precondition(i)))}),yield function(r,i){return g(this,null,function*(){let s=T(r),o={writes:i.map(a=>Oo(s.serializer,a))};yield s.Do("Commit",s.serializer.databaseId,W.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw S();t=x.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new y(m.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(x.min())?fe.exists(!1):fe.updateTime(t):fe.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(x.min()))throw new y(m.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return fe.updateTime(t)}return fe.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var Ip=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Za=r.maxAttempts,this.Jo=new jo(this.asyncQueue,"transaction_retry")}Xa(){this.Za-=1,this.eu()}eu(){this.Jo.Ko(()=>g(this,null,function*(){let e=new Ep(this.datastore),t=this.tu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.nu(i)}))}).catch(r=>{this.nu(r)})}))}tu(e){try{let t=this.updateFunction(e);return!Ho(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}nu(e){this.Za>0&&this.ru(e)?(this.Za-=1,this.asyncQueue.enqueueAndForget(()=>(this.eu(),Promise.resolve()))):this.deferred.reject(e)}ru(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!WE(t)}return!1}};var Tp=class{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=we.UNAUTHENTICATED,this.clientId=Qu.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>g(this,null,function*(){v("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(v("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new y(m.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Ee;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>g(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Gi(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Wu(n,e){return g(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),v("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>g(this,null,function*(){r.isEqual(i)||(yield mI(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function Ap(n,e){return g(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield ug(n);v("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Zw(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Zw(e.remoteStore,i)),n._onlineComponents=e})}function VI(n){return n.name==="FirebaseError"?n.code===m.FAILED_PRECONDITION||n.code===m.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}function ug(n){return g(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){v("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Wu(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!VI(t))throw t;ht("Error using user provided cache. Falling back to memory cache: "+t),yield Wu(n,new qo)}}else v("FirestoreClient","Using default OfflineComponentProvider"),yield Wu(n,new qo);return n._offlineComponents})}function Wc(n){return g(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(v("FirestoreClient","Using user provided OnlineComponentProvider"),yield Ap(n,n._uninitializedComponentsProvider._online)):(v("FirestoreClient","Using default OnlineComponentProvider"),yield Ap(n,new $o))),n._onlineComponents})}function NI(n){return ug(n).then(e=>e.persistence)}function cg(n){return ug(n).then(e=>e.localStore)}function MI(n){return Wc(n).then(e=>e.remoteStore)}function lg(n){return Wc(n).then(e=>e.syncEngine)}function $D(n){return Wc(n).then(e=>e.datastore)}function Li(n){return g(this,null,function*(){let e=yield Wc(n),t=e.eventManager;return t.onListen=TD.bind(null,e.syncEngine),t.onUnlisten=CD.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=AD.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=SD.bind(null,e.syncEngine),t})}function zD(n){return n.asyncQueue.enqueue(()=>g(this,null,function*(){let e=yield NI(n),t=yield MI(n);return e.setNetworkEnabled(!0),function(i){let s=T(i);return s.M_.delete(0),Xo(s)}(t)}))}function GD(n){return n.asyncQueue.enqueue(()=>g(this,null,function*(){let e=yield NI(n),t=yield MI(n);return e.setNetworkEnabled(!1),function(i){return g(this,null,function*(){let s=T(i);s.M_.add(0),yield qi(s),s.N_.set("Offline")})}(t)}))}function HD(n,e){let t=new Ee;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(i,s,o){return g(this,null,function*(){try{let a=yield function(c,l){let h=T(c);return h.persistence.runTransaction("read document","readonly",d=>h.localDocuments.getDocument(d,l))}(i,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new y(m.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let u=Gi(a,`Failed to get document '${s} from cache`);o.reject(u)}})}(yield cg(n),e,t)})),t.promise}function OI(n,e,t={}){let r=new Ee;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(s,o,a,u,c){let l=new Fi({next:d=>{o.enqueueAndForget(()=>tg(s,h));let f=d.docs.has(a);!f&&d.fromCache?c.reject(new y(m.UNAVAILABLE,"Failed to get document because the client is offline.")):f&&d.fromCache&&u&&u.source==="server"?c.reject(new y(m.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new Bo(Bi(a.path),l,{includeMetadataChanges:!0,ra:!0});return eg(s,h)}(yield Li(n),n.asyncQueue,e,t,r)})),r.promise}function WD(n,e){let t=new Ee;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(i,s,o){return g(this,null,function*(){try{let a=yield Ec(i,s,!0),u=new Vc(s,a.ls),c=u.da(a.documents),l=u.applyChanges(c,!1);o.resolve(l.snapshot)}catch(a){let u=Gi(a,`Failed to execute query '${s} against cache`);o.reject(u)}})}(yield cg(n),e,t)})),t.promise}function FI(n,e,t={}){let r=new Ee;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(s,o,a,u,c){let l=new Fi({next:d=>{o.enqueueAndForget(()=>tg(s,h)),d.fromCache&&u.source==="server"?c.reject(new y(m.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new Bo(a,l,{includeMetadataChanges:!0,ra:!0});return eg(s,h)}(yield Li(n),n.asyncQueue,e,t,r)})),r.promise}function KD(n,e){let t=new Fi(e);return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(i,s){T(i).z_.add(s),s.next()}(yield Li(n),t)})),()=>{t.$a(),n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(i,s){T(i).z_.delete(s)}(yield Li(n),t)}))}}function QD(n,e,t,r){let i=function(o,a){let u;return u=typeof o=="string"?QE().encode(o):o,function(l,h){return new wp(l,h)}(function(l,h){if(l instanceof Uint8Array)return rE(l,h);if(l instanceof ArrayBuffer)return rE(new Uint8Array(l),h);if(l instanceof ReadableStream)return l.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),a)}(t,Yo(e));n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){qD(yield lg(n),i,r)}))}function YD(n,e){return n.asyncQueue.enqueue(()=>g(this,null,function*(){return function(r,i){let s=T(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Kr.getNamedQuery(o,i))}(yield cg(n),e)}))}function LI(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var iE=new Map;function hg(n,e,t){if(!t)throw new y(m.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function dg(n,e,t,r){if(e===!0&&r===!0)throw new y(m.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function sE(n){if(!I.isDocumentKey(n))throw new y(m.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function oE(n){if(I.isDocumentKey(n))throw new y(m.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Kc(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":S()}function K(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new y(m.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Kc(n);throw new y(m.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function UI(n,e){if(e<=0)throw new y(m.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}var Mc=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new y(m.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new y(m.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}dg("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=LI((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new y(m.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new y(m.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new y(m.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Er=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Mc({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new y(m.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new y(m.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Mc(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Bd;switch(r.type){case"firstParty":return new Gd(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new y(m.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=iE.get(t);r&&(v("ComponentProvider","Removing Datastore"),iE.delete(t),r.terminate())}(this),Promise.resolve()}};function jI(n,e,t,r={}){var i;let s=(n=K(n,Er))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&ht("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,u;if(typeof r.mockUserToken=="string")a=r.mockUserToken,u=we.MOCK_USER;else{a=_a(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new y(m.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new we(c)}n._authCredentials=new qd(new Ku(a,u))}}var Ve=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},re=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Bt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Bt=class n extends Ve{constructor(e,t,r){super(e,t,Bi(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new re(this.firestore,null,new I(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function fg(n,e,...t){if(n=ee(n),hg("collection","path",e),n instanceof Er){let r=W.fromString(e,...t);return oE(r),new Bt(n,null,r)}{if(!(n instanceof re||n instanceof Bt))throw new y(m.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(W.fromString(e,...t));return oE(r),new Bt(n.firestore,null,r)}}function BI(n,e){if(n=K(n,Er),hg("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new y(m.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Ve(n,null,function(r){return new Tt(W.emptyPath(),r)}(e))}function Jo(n,e,...t){if(n=ee(n),arguments.length===1&&(e=Qu.newId()),hg("doc","path",e),n instanceof Er){let r=W.fromString(e,...t);return sE(r),new re(n,null,new I(r))}{if(!(n instanceof re||n instanceof Bt))throw new y(m.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(W.fromString(e,...t));return sE(r),new re(n.firestore,n instanceof Bt?n.converter:null,new I(r))}}function pg(n,e){return n=ee(n),e=ee(e),(n instanceof re||n instanceof Bt)&&(e instanceof re||e instanceof Bt)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function gg(n,e){return n=ee(n),e=ee(e),n instanceof Ve&&e instanceof Ve&&n.firestore===e.firestore&&Ko(n._query,e._query)&&n.converter===e.converter}var Cp=class{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Jo=new jo(this,"async_queue_retry"),this.hu=()=>{let t=Hu();t&&v("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Jo.Uo()};let e=Hu();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;let t=Hu();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise(()=>{});let t=new Ee;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.su.push(e),this.Tu()))}Tu(){return g(this,null,function*(){if(this.su.length!==0){try{yield this.su[0](),this.su.shift(),this.Jo.reset()}catch(e){if(!$n(e))throw e;v("AsyncQueue","Operation failed with retryable error: "+e)}this.su.length>0&&this.Jo.Ko(()=>this.Tu())}})}Iu(e){let t=this.iu.then(()=>(this.uu=!0,e().catch(r=>{this.au=r,this.uu=!1;let i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw ge("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.uu=!1,r))));return this.iu=t,t}enqueueAfterDelay(e,t,r){this.Pu(),this.lu.indexOf(e)>-1&&(t=0);let i=cp.createAndSchedule(this,e,t,r,s=>this.Eu(s));return this._u.push(i),i}Pu(){this.au&&S()}verifyOperationInProgress(){}du(){return g(this,null,function*(){let e;do e=this.iu,yield e;while(e!==this.iu)})}Au(e){for(let t of this._u)if(t.timerId===e)return!0;return!1}Ru(e){return this.du().then(()=>{this._u.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this._u)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.du()})}Vu(e){this.lu.push(e)}Eu(e){let t=this._u.indexOf(e);this._u.splice(t,1)}};function Sp(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var bp=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ee,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var qI=-1,oe=class extends Er{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=function(){return new Cp}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||$I(this),this._firestoreClient.terminate()}};function Te(n){return n._firestoreClient||$I(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function $I(n){var e,t,r;let i=n._freezeSettings(),s=function(a,u,c,l){return new Zd(a,u,c,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,LI(l.experimentalLongPollingOptions),l.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new Tp(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function zI(n,e){ZI(n=K(n,oe));let t=Te(n);if(t._uninitializedComponentsProvider)throw new y(m.FAILED_PRECONDITION,"SDK cache is already specified.");ht("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new $o;return HI(t,i,new Nc(i,r.cacheSizeBytes,e?.forceOwnership))}function GI(n){ZI(n=K(n,oe));let e=Te(n);if(e._uninitializedComponentsProvider)throw new y(m.FAILED_PRECONDITION,"SDK cache is already specified.");ht("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings(),r=new $o;return HI(e,r,new vp(r,t.cacheSizeBytes))}function HI(n,e,t){let r=new Ee;return n.asyncQueue.enqueue(()=>g(this,null,function*(){try{yield Wu(n,t),yield Ap(n,e),r.resolve()}catch(i){let s=i;if(!VI(s))throw s;ht("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function WI(n){if(n._initialized&&!n._terminated)throw new y(m.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new Ee;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>g(this,null,function*(){try{yield function(r){return g(this,null,function*(){if(!Vn.D())return Promise.resolve();let i=r+"main";yield Vn.delete(i)})}(Yp(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function KI(n){return function(t){let r=new Ee;return t.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return kD(yield lg(t),r)})),r.promise}(Te(n=K(n,oe)))}function QI(n){return zD(Te(n=K(n,oe)))}function YI(n){return GD(Te(n=K(n,oe)))}function XI(n,e){let t=Te(n=K(n,oe)),r=new bp;return QD(t,n._databaseId,e,r),r}function JI(n,e){return YD(Te(n=K(n,oe)),e).then(t=>t?new Ve(n,null,t.query):null)}function ZI(n){if(n._initialized||n._terminated)throw new y(m.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Gt=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Re.fromBase64String(e))}catch(t){throw new y(m.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Re.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Ct=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new y(m.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new me(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var an=class{constructor(e){this._methodName=e}};var Ir=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new y(m.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new y(m.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return U(this._lat,e._lat)||U(this._long,e._long)}};var XD=/^__.*__$/,Rp=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new At(e,this.data,this.fieldMask,t,this.fieldTransforms):new Un(e,this.data,t,this.fieldTransforms)}},Oc=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new At(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function eT(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw S()}}var Fc=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.mu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.gu({path:r,yu:!1});return i.wu(e),i}Su(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.gu({path:r,yu:!1});return i.mu(),i}bu(e){return this.gu({path:void 0,yu:!0})}Du(e){return Lc(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}mu(){if(this.path)for(let e=0;e<this.path.length;e++)this.wu(this.path.get(e))}wu(e){if(e.length===0)throw this.Du("Document fields must not be empty");if(eT(this.fu)&&XD.test(e))throw this.Du('Document fields cannot begin and end with "__"')}},Dp=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Yo(e)}Fu(e,t,r,i=!1){return new Fc({fu:e,methodName:t,vu:r,path:me.emptyPath(),yu:!1,Cu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Sr(n){let e=n._freezeSettings(),t=Yo(n._databaseId);return new Dp(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Qc(n,e,t,r,i,s={}){let o=n.Fu(s.merge||s.mergeFields?2:0,e,t,i);_g("Data must be an object, but it was:",o,r);let a=rT(r,o),u,c;if(s.merge)u=new rt(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let l=[];for(let h of s.mergeFields){let d=Np(e,h,t);if(!o.contains(d))throw new y(m.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);sT(l,d)||l.push(d)}u=new rt(l),c=o.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,c=o.fieldTransforms;return new Rp(new Be(a),u,c)}var zo=class n extends an{_toFieldTransform(e){if(e.fu!==2)throw e.fu===1?e.Du(`${this._methodName}() can only appear at the top level of your update data`):e.Du(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function tT(n,e,t){return new Fc({fu:3,vu:e.settings.vu,methodName:n._methodName,yu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var Pp=class n extends an{_toFieldTransform(e){return new _r(e.path,new Fn)}isEqual(e){return e instanceof n}},kp=class n extends an{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){let t=tT(this,e,!0),r=this.Mu.map(s=>br(s,t)),i=new sn(r);return new _r(e.path,i)}isEqual(e){return e instanceof n&&Pl(this.Mu,e.Mu)}},xp=class n extends an{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){let t=tT(this,e,!0),r=this.Mu.map(s=>br(s,t)),i=new on(r);return new _r(e.path,i)}isEqual(e){return e instanceof n&&Pl(this.Mu,e.Mu)}},Vp=class n extends an{constructor(e,t){super(e),this.xu=t}_toFieldTransform(e){let t=new Ln(e.serializer,jE(e.serializer,this.xu));return new _r(e.path,t)}isEqual(e){return e instanceof n&&this.xu===e.xu}};function mg(n,e,t,r){let i=n.Fu(1,e,t);_g("Data must be an object, but it was:",i,r);let s=[],o=Be.empty();Cr(r,(u,c)=>{let l=vg(e,u,t);c=ee(c);let h=i.Su(l);if(c instanceof zo)s.push(l);else{let d=br(c,h);d!=null&&(s.push(l),o.set(l,d))}});let a=new rt(s);return new Oc(o,a,i.fieldTransforms)}function yg(n,e,t,r,i,s){let o=n.Fu(1,e,t),a=[Np(e,r,t)],u=[i];if(s.length%2!=0)throw new y(m.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(Np(e,s[d])),u.push(s[d+1]);let c=[],l=Be.empty();for(let d=a.length-1;d>=0;--d)if(!sT(c,a[d])){let f=a[d],E=u[d];E=ee(E);let w=o.Su(f);if(E instanceof zo)c.push(f);else{let _=br(E,w);_!=null&&(c.push(f),l.set(f,_))}}let h=new rt(c);return new Oc(l,h,o.fieldTransforms)}function nT(n,e,t,r=!1){return br(t,n.Fu(r?4:3,e))}function br(n,e){if(iT(n=ee(n)))return _g("Unsupported field value:",e,n),rT(n,e);if(n instanceof an)return function(r,i){if(!eT(i.fu))throw i.Du(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Du(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.yu&&e.fu!==4)throw e.Du("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let a of r){let u=br(a,i.bu(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=ee(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return jE(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=ce.fromDate(r);return{timestampValue:Di(i.serializer,s)}}if(r instanceof ce){let s=new ce(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Di(i.serializer,s)}}if(r instanceof Ir)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Gt)return{bytesValue:YE(i.serializer,r._byteString)};if(r instanceof re){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Du(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Wp(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.Du(`Unsupported field value: ${Kc(r)}`)}(n,e)}function rT(n,e){let t={};return IE(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Cr(n,(r,i)=>{let s=br(i,e.pu(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function iT(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ce||n instanceof Ir||n instanceof Gt||n instanceof re||n instanceof an)}function _g(n,e,t){if(!iT(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let r=Kc(t);throw r==="an object"?e.Du(n+" a custom object"):e.Du(n+" "+r)}}function Np(n,e,t){if((e=ee(e))instanceof Ct)return e._internalPath;if(typeof e=="string")return vg(n,e);throw Lc("Field path arguments must be of type string or ",n,!1,void 0,t)}var JD=new RegExp("[~\\*/\\[\\]]");function vg(n,e,t){if(e.search(JD)>=0)throw Lc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Ct(...e.split("."))._internalPath}catch{throw Lc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Lc(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new y(m.INVALID_ARGUMENT,a+n+u)}function sT(n,e){return n.some(t=>t.isEqual(e))}var Tr=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new re(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Mp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Yc("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Mp=class extends Tr{data(){return super.data()}};function Yc(n,e){return typeof e=="string"?vg(n,e):e instanceof Ct?e._internalPath:e._delegate._internalPath}function oT(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new y(m.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Go=class{},Ar=class extends Go{};function ln(n,e,...t){let r=[];e instanceof Go&&r.push(e),r=r.concat(t),function(s){let o=s.filter(u=>u instanceof Op).length,a=s.filter(u=>u instanceof Uc).length;if(o>1||o>0&&a>0)throw new y(m.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var Uc=class n extends Ar{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return mT(e._query,t),new Ve(e.firestore,e.converter,ff(e._query,t))}_parse(e){let t=Sr(e.firestore);return function(s,o,a,u,c,l,h){let d;if(c.isKeyField()){if(l==="array-contains"||l==="array-contains-any")throw new y(m.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if(l==="in"||l==="not-in"){uE(h,l);let f=[];for(let E of h)f.push(aE(u,s,E));d={arrayValue:{values:f}}}else d=aE(u,s,h)}else l!=="in"&&l!=="not-in"&&l!=="array-contains-any"||uE(h,l),d=nT(a,o,h,l==="in"||l==="not-in");return G.create(c,l,d)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function aT(n,e,t){let r=e,i=Yc("where",n);return Uc._create(i,r,t)}var Op=class n extends Go{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:J.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i,a=s.getFlattenedFilters();for(let u of a)mT(o,u),o=ff(o,u)}(e._query,t),new Ve(e.firestore,e.converter,ff(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Fp=class n extends Ar{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(i,s,o){if(i.startAt!==null)throw new y(m.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new y(m.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new mr(s,o)}(e._query,this._field,this._direction);return new Ve(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new Tt(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function uT(n,e="asc"){let t=e,r=Yc("orderBy",n);return Fp._create(r,t)}var jc=class n extends Ar{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new Ve(e.firestore,e.converter,sc(e._query,this._limit,this._limitType))}};function cT(n){return UI("limit",n),jc._create("limit",n,"F")}function lT(n){return UI("limitToLast",n),jc._create("limitToLast",n,"L")}var Bc=class n extends Ar{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=gT(e,this.type,this._docOrFields,this._inclusive);return new Ve(e.firestore,e.converter,function(i,s){return new Tt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};function hT(...n){return Bc._create("startAt",n,!0)}function dT(...n){return Bc._create("startAfter",n,!1)}var qc=class n extends Ar{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=gT(e,this.type,this._docOrFields,this._inclusive);return new Ve(e.firestore,e.converter,function(i,s){return new Tt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};function fT(...n){return qc._create("endBefore",n,!1)}function pT(...n){return qc._create("endAt",n,!0)}function gT(n,e,t,r){if(t[0]=ee(t[0]),t[0]instanceof Tr)return function(s,o,a,u,c){if(!u)throw new y(m.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let l=[];for(let h of Ei(s))if(h.field.isKeyField())l.push(gr(o,u.key));else{let d=u.data.field(h.field);if(zc(d))throw new y(m.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(d===null){let f=h.field.canonicalString();throw new y(m.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${f}' (used as the orderBy) does not exist.`)}l.push(d)}return new $t(l,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=Sr(n.firestore);return function(o,a,u,c,l,h){let d=o.explicitOrderBy;if(l.length>d.length)throw new y(m.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let f=[];for(let E=0;E<l.length;E++){let w=l[E];if(d[E].field.isKeyField()){if(typeof w!="string")throw new y(m.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof w}`);if(!Gp(o)&&w.indexOf("/")!==-1)throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${w}' contains a slash.`);let _=o.path.child(W.fromString(w));if(!I.isDocumentKey(_))throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${_}' is not because it contains an odd number of segments.`);let D=new I(_);f.push(gr(a,D))}else{let _=nT(u,c,w);f.push(_)}}return new $t(f,h)}(n._query,n.firestore._databaseId,i,e,t,r)}}function aE(n,e,t){if(typeof(t=ee(t))=="string"){if(t==="")throw new y(m.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Gp(e)&&t.indexOf("/")!==-1)throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(W.fromString(t));if(!I.isDocumentKey(r))throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return gr(n,new I(r))}if(t instanceof re)return gr(n,t._key);throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Kc(t)}.`)}function uE(n,e){if(!Array.isArray(n)||n.length===0)throw new y(m.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function mT(n,e){let t=function(i,s){for(let o of i)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new y(m.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new y(m.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Ui=class{convertValue(e,t="none"){switch(pr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return de(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Nn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw S()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Cr(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new Ir(de(e.latitude),de(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=$p(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(bo(e));default:return null}}convertTimestamp(e){let t=rn(e);return new ce(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=W.fromString(e);P(aI(r));let i=new Mn(r.get(1),r.get(3)),s=new I(r.popFirst(5));return i.isEqual(t)||ge(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Xc(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var Lp=class extends Ui{constructor(e){super(),this.firestore=e}convertBytes(e){return new Gt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new re(this.firestore,null,t)}};var nn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},ft=class extends Tr{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new kn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(Yc("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},kn=class extends ft{data(e={}){return super.data(e)}},St=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new nn(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new kn(this._firestore,this._userDataWriter,r.key,r,new nn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new y(m.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let u=new kn(i._firestore,i._userDataWriter,a.doc.key,a.doc,new nn(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let u=new kn(i._firestore,i._userDataWriter,a.doc.key,a.doc,new nn(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),c=-1,l=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:ZD(a.type),doc:u,oldIndex:c,newIndex:l}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function ZD(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return S()}}function wg(n,e){return n instanceof ft&&e instanceof ft?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof St&&e instanceof St&&n._firestore===e._firestore&&gg(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function yT(n){n=K(n,re);let e=K(n.firestore,oe);return OI(Te(e),n._key).then(t=>Ag(e,n,t))}var un=class extends Ui{constructor(e){super(),this.firestore=e}convertBytes(e){return new Gt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new re(this.firestore,null,t)}};function _T(n){n=K(n,re);let e=K(n.firestore,oe),t=Te(e),r=new un(e);return HD(t,n._key).then(i=>new ft(e,r,n._key,i,new nn(i!==null&&i.hasLocalMutations,!0),n.converter))}function vT(n){n=K(n,re);let e=K(n.firestore,oe);return OI(Te(e),n._key,{source:"server"}).then(t=>Ag(e,n,t))}function wT(n){n=K(n,Ve);let e=K(n.firestore,oe),t=Te(e),r=new un(e);return oT(n._query),FI(t,n._query).then(i=>new St(e,r,n,i))}function ET(n){n=K(n,Ve);let e=K(n.firestore,oe),t=Te(e),r=new un(e);return WD(t,n._query).then(i=>new St(e,r,n,i))}function IT(n){n=K(n,Ve);let e=K(n.firestore,oe),t=Te(e),r=new un(e);return FI(t,n._query,{source:"server"}).then(i=>new St(e,r,n,i))}function Eg(n,e,t){n=K(n,re);let r=K(n.firestore,oe),i=Xc(n.converter,e,t);return Hi(r,[Qc(Sr(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,fe.none())])}function Ig(n,e,t,...r){n=K(n,re);let i=K(n.firestore,oe),s=Sr(i),o;return o=typeof(e=ee(e))=="string"||e instanceof Ct?yg(s,"updateDoc",n._key,e,t,r):mg(s,"updateDoc",n._key,e),Hi(i,[o.toMutation(n._key,fe.exists(!0))])}function TT(n){return Hi(K(n.firestore,oe),[new jn(n._key,fe.none())])}function AT(n,e){let t=K(n.firestore,oe),r=Jo(n),i=Xc(n.converter,e);return Hi(t,[Qc(Sr(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,fe.exists(!1))]).then(()=>r)}function Tg(n,...e){var t,r,i;n=ee(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Sp(e[o])||(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Sp(e[o])){let h=e[o];e[o]=(t=h.next)===null||t===void 0?void 0:t.bind(h),e[o+1]=(r=h.error)===null||r===void 0?void 0:r.bind(h),e[o+2]=(i=h.complete)===null||i===void 0?void 0:i.bind(h)}let u,c,l;if(n instanceof re)c=K(n.firestore,oe),l=Bi(n._key.path),u={next:h=>{e[o]&&e[o](Ag(c,n,h))},error:e[o+1],complete:e[o+2]};else{let h=K(n,Ve);c=K(h.firestore,oe),l=h._query;let d=new un(c);u={next:f=>{e[o]&&e[o](new St(c,d,h,f))},error:e[o+1],complete:e[o+2]},oT(n._query)}return function(d,f,E,w){let _=new Fi(w),D=new Bo(f,_,E);return d.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return eg(yield Li(d),D)})),()=>{_.$a(),d.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return tg(yield Li(d),D)}))}}(Te(c),l,a,u)}function CT(n,e){return KD(Te(n=K(n,oe)),Sp(e)?e:{next:e})}function Hi(n,e){return function(r,i){let s=new Ee;return r.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return bD(yield lg(r),i,s)})),s.promise}(Te(n),e)}function Ag(n,e,t){let r=t.docs.get(e._key),i=new un(n);return new ft(n,i,e._key,r,new nn(t.hasPendingWrites,t.fromCache),e.converter)}var eP={maxAttempts:5};var $c=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Sr(e)}set(e,t,r){this._verifyNotCommitted();let i=Dn(e,this._firestore),s=Xc(i.converter,t,r),o=Qc(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,fe.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=Dn(e,this._firestore),o;return o=typeof(t=ee(t))=="string"||t instanceof Ct?yg(this._dataReader,"WriteBatch.update",s._key,t,r,i):mg(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,fe.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Dn(e,this._firestore);return this._mutations=this._mutations.concat(new jn(t._key,fe.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new y(m.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Dn(n,e){if((n=ee(n)).firestore!==e)throw new y(m.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var Up=class extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Sr(t)}get(t){let r=Dn(t,this._firestore),i=new Lp(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return S();let o=s[0];if(o.isFoundDocument())return new Tr(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new Tr(this._firestore,i,r._key,null,r.converter);throw S()})}set(t,r,i){let s=Dn(t,this._firestore),o=Xc(s.converter,r,i),a=Qc(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,a),this}update(t,r,i,...s){let o=Dn(t,this._firestore),a;return a=typeof(r=ee(r))=="string"||r instanceof Ct?yg(this._dataReader,"Transaction.update",o._key,r,i,s):mg(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){let r=Dn(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Dn(e,this._firestore),r=new un(this._firestore);return super.get(e).then(i=>new ft(this._firestore,r,t._key,i._document,new nn(!1,!1),t.converter))}};function ST(n,e,t){n=K(n,oe);let r=Object.assign(Object.assign({},eP),t);return function(s){if(s.maxAttempts<1)throw new y(m.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){let u=new Ee;return s.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let c=yield $D(s);new Ip(s.asyncQueue,c,a,o,u).Xa()})),u.promise}(Te(n),i=>e(new Up(n,i)),r)}function bT(){return new zo("deleteField")}function RT(){return new Pp("serverTimestamp")}function DT(...n){return new kp("arrayUnion",n)}function PT(...n){return new xp("arrayRemove",n)}function kT(n){return new Vp("increment",n)}(function(e,t=!0){(function(i){ji=i})(Ta),Qn(new Yt("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new oe(new $d(r.getProvider("auth-internal")),new Wd(r.getProvider("app-check-internal")),function(c,l){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new y(m.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Mn(c.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),$e(cw,"4.6.1",e),$e(cw,"4.6.1","esm2017")})();var tP="@firebase/firestore-compat",nP="0.3.30";function Pg(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new y("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function xT(){if(typeof Uint8Array>"u")throw new y("unimplemented","Uint8Arrays are not available in this environment.")}function VT(){if(!TE())throw new y("unimplemented","Blobs are unavailable in Firestore in this environment.")}var Jc=class n{constructor(e){this._delegate=e}static fromBase64String(e){return VT(),new n(Gt.fromBase64String(e))}static fromUint8Array(e){return xT(),new n(Gt.fromUint8Array(e))}toBase64(){return VT(),this._delegate.toBase64()}toUint8Array(){return xT(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function Cg(n){return rP(n,["next","error","complete"])}function rP(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var Sg=class{enableIndexedDbPersistence(e,t){return zI(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return GI(e._delegate)}clearIndexedDbPersistence(e){return WI(e._delegate)}},Zc=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Mn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&ht("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){jI(this._delegate,e,t,r)}enableNetwork(){return QI(this._delegate)}disableNetwork(){return YI(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,dg("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return KI(this._delegate)}onSnapshotsInSync(e){return CT(this._delegate,e)}get app(){if(!this._appCompat)throw new y("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Qi(this,fg(this._delegate,e))}catch(t){throw Ke(t,"collection()","Firestore.collection()")}}doc(e){try{return new Ht(this,Jo(this._delegate,e))}catch(t){throw Ke(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new kr(this,BI(this._delegate,e))}catch(t){throw Ke(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return ST(this._delegate,t=>e(new el(this,t)))}batch(){return Te(this._delegate),new tl(new $c(this._delegate,e=>Hi(this._delegate,e)))}loadBundle(e){return XI(this._delegate,e)}namedQuery(e){return JI(this._delegate,e).then(t=>t?new kr(this,t):null)}},Wi=class extends Ui{constructor(e){super(),this.firestore=e}convertBytes(e){return new Jc(new Gt(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return Ht.forKey(t,this.firestore,null)}};function iP(n){cE(n)}var el=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Wi(e)}get(e){let t=Rr(e);return this._delegate.get(t).then(r=>new Dr(this._firestore,new ft(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=Rr(e);return r?(Pg("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Rr(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Rr(e);return this._delegate.delete(t),this}},tl=class{constructor(e){this._delegate=e}set(e,t,r){let i=Rr(e);return r?(Pg("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Rr(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Rr(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},Ki=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new kn(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Pr(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new Wi(e),t),i.set(t,s)),s}};Ki.INSTANCES=new WeakMap;var Ht=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Wi(e)}static forPath(e,t,r){if(e.length%2!==0)throw new y("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new re(t._delegate,r,new I(e)))}static forKey(e,t,r){return new n(t,new re(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Qi(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Qi(this.firestore,fg(this._delegate,e))}catch(t){throw Ke(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=ee(e),e instanceof re?pg(this._delegate,e):!1}set(e,t){t=Pg("DocumentReference.set",t);try{return t?Eg(this._delegate,e,t):Eg(this._delegate,e)}catch(r){throw Ke(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?Ig(this._delegate,e):Ig(this._delegate,e,t,...r)}catch(i){throw Ke(i,"updateDoc()","DocumentReference.update()")}}delete(){return TT(this._delegate)}onSnapshot(...e){let t=NT(e),r=MT(e,i=>new Dr(this.firestore,new ft(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Tg(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=_T(this._delegate):e?.source==="server"?t=vT(this._delegate):t=yT(this._delegate),t.then(r=>new Dr(this.firestore,new ft(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Ki.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Ke(n,e,t){return n.message=n.message.replace(e,t),n}function NT(n){for(let e of n)if(typeof e=="object"&&!Cg(e))return e;return{}}function MT(n,e){var t,r;let i;return Cg(n[0])?i=n[0]:Cg(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Dr=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Ht(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return wg(this._delegate,e._delegate)}},Pr=class extends Dr{data(e){let t=this._delegate.data(e);return this._delegate._converter||lE(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},kr=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Wi(e)}where(e,t,r){try{return new n(this.firestore,ln(this._delegate,aT(e,t,r)))}catch(i){throw Ke(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,ln(this._delegate,uT(e,t)))}catch(r){throw Ke(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,ln(this._delegate,cT(e)))}catch(t){throw Ke(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,ln(this._delegate,lT(e)))}catch(t){throw Ke(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,ln(this._delegate,hT(...e)))}catch(t){throw Ke(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,ln(this._delegate,dT(...e)))}catch(t){throw Ke(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,ln(this._delegate,fT(...e)))}catch(t){throw Ke(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,ln(this._delegate,pT(...e)))}catch(t){throw Ke(t,"endAt()","Query.endAt()")}}isEqual(e){return gg(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=ET(this._delegate):e?.source==="server"?t=IT(this._delegate):t=wT(this._delegate),t.then(r=>new Zo(this.firestore,new St(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=NT(e),r=MT(e,i=>new Zo(this.firestore,new St(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Tg(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Ki.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},bg=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Pr(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},Zo=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new kr(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Pr(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new bg(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Pr(this._firestore,r))})}isEqual(e){return wg(this._delegate,e._delegate)}},Qi=class n extends kr{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new Ht(this.firestore,e):null}doc(e){try{return e===void 0?new Ht(this.firestore,Jo(this._delegate)):new Ht(this.firestore,Jo(this._delegate,e))}catch(t){throw Ke(t,"doc()","CollectionReference.doc()")}}add(e){return AT(this._delegate,e).then(t=>new Ht(this.firestore,t))}isEqual(e){return pg(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Ki.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Rr(n){return K(n,re)}var Rg=class n{constructor(...e){this._delegate=new Ct(...e)}static documentId(){return new n(me.keyField().canonicalString())}isEqual(e){return e=ee(e),e instanceof Ct?this._delegate._internalPath.isEqual(e._internalPath):!1}};var Dg=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=RT();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=bT();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=DT(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=PT(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=kT(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var sP={Firestore:Zc,GeoPoint:Ir,Timestamp:ce,Blob:Jc,Transaction:el,WriteBatch:tl,DocumentReference:Ht,DocumentSnapshot:Dr,Query:kr,QueryDocumentSnapshot:Pr,QuerySnapshot:Zo,CollectionReference:Qi,FieldPath:Rg,FieldValue:Dg,setLogLevel:iP,CACHE_SIZE_UNLIMITED:qI};function oP(n,e){n.INTERNAL.registerComponent(new Yt("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},sP)))}function aP(n){oP(n,(e,t)=>new Zc(e,t,new Sg)),n.registerVersion(tP,nP)}aP(Ye);function uP(n,e=ra){return new hn(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function OT(n,e){return uP(n,e)}function cP(n,e){return OT(n,e).pipe(Mr(void 0),oa(),F(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function Vg(n,e){return OT(n,e).pipe(F(t=>({payload:t,type:"query"})))}var nl=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=UT(r,t);return new il(i,s,this.afs)}snapshotChanges(){return cP(this.ref,this.afs.schedulers.outsideAngular).pipe(ze)}valueChanges(e={}){return this.snapshotChanges().pipe(F(({payload:t})=>e.idField?te(b({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return Z(this.ref.get(e)).pipe(ze)}};function rl(n,e){return Vg(n,e).pipe(Mr(void 0),oa(),F(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,u)=>{let c=s.find(h=>h.doc.ref.isEqual(a.ref)),l=r?.payload.docs.find(h=>h.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&l&&JSON.stringify(l.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:u,newIndex:u,type:"modified",doc:a}})}),o}))}function FT(n,e,t){return rl(n,t).pipe(Nr((r,i)=>lP(r,i.map(s=>s.payload),e),[]),rm(),F(r=>r.map(i=>({type:i.type,payload:i}))))}function lP(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=hP(n,r))}),n}function kg(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function hP(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return kg(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return kg(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return kg(n,e.oldIndex,1);break}return n}function LT(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var il=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=rl(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(F(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(Mr(void 0),oa(),ot(([r,i])=>i.length>0||!r),F(([,r])=>r),ze)}auditTrail(e){return this.stateChanges(e).pipe(Nr((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=LT(e);return FT(this.query,t,this.afs.schedulers.outsideAngular).pipe(ze)}valueChanges(e={}){return Vg(this.query,this.afs.schedulers.outsideAngular).pipe(F(t=>t.payload.docs.map(r=>e.idField?te(b({},r.data()),{[e.idField]:r.id}):r.data())),ze)}get(e){return Z(this.query.get(e)).pipe(ze)}add(e){return this.ref.add(e)}doc(e){return new nl(this.ref.doc(e),this.afs)}},xg=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?rl(this.query,this.afs.schedulers.outsideAngular).pipe(ze):rl(this.query,this.afs.schedulers.outsideAngular).pipe(F(t=>t.filter(r=>e.indexOf(r.type)>-1)),ot(t=>t.length>0),ze)}auditTrail(e){return this.stateChanges(e).pipe(Nr((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=LT(e);return FT(this.query,t,this.afs.schedulers.outsideAngular).pipe(ze)}valueChanges(e={}){return Vg(this.query,this.afs.schedulers.outsideAngular).pipe(F(r=>r.payload.docs.map(i=>e.idField?b({[e.idField]:i.id},i.data()):i.data())),ze)}get(e){return Z(this.query.get(e)).pipe(ze)}},dP=new q("angularfire2.enableFirestorePersistence"),fP=new q("angularfire2.firestore.persistenceSettings"),pP=new q("angularfire2.firestore.settings"),gP=new q("angularfire2.firestore.use-emulator");function UT(n,e=t=>t){return{query:e(n),ref:n}}var sl=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,u,c,l,h,d,f,E,w,_,D,M){this.schedulers=u;let C=qs(t,a,r),V=l;h&&Gh(C,a,d,E,w,_,f,D),[this.firestore,this.persistenceEnabled$]=uu(`${C.name}.firestore`,"AngularFirestore",C.name,()=>{let L=a.runOutsideAngular(()=>C.firestore());if(s&&L.settings(s),V&&L.useEmulator(...V),i&&!Kn(o)){let z=()=>{try{return Z(L.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(le){return typeof console<"u"&&console.warn(le),k(!1)}};return[L,a.runOutsideAngular(z)]}else return[L,k(!1)]},[s,V,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=UT(i,r),a=this.schedulers.ngZone.run(()=>s);return new il(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new xg(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new nl(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(R(ni),R(ri,8),R(dP,8),R(pP,8),R(mt),R(ue),R(er),R(fP,8),R(gP,8),R(Hh,8),R(Uh,8),R(jh,8),R(Bh,8),R(qh,8),R($h,8),R(zh,8),R(Vt,8))};static \u0275prov=$({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var BT=(()=>{let e=class e{constructor(r){this.firestore=r}setCollection(r){this.collection=this.firestore.collection(r)}getDocuments(){if(!this.collection)throw new Error("Collection path not set.");return this.collection.snapshotChanges().pipe(F(r=>r.map(i=>{let s=i.payload.doc.data(),o=i.payload.doc.id;return te(b({},s),{id:o})})),pt(r=>{throw console.error("Error obtaining data from Firestore:",r),r}))}addDocument(r){return Z(this.collection.add(r)).pipe(pe(i=>this.collection.doc(i.id).valueChanges()))}updateDocument(r,i){return Z(this.collection.doc(r).update(i)).pipe(pt(s=>{throw console.error("Error updating document in Firestore:",s),s}))}deleteDocument(r){return Z(this.collection.doc(r).delete()).pipe(pt(i=>{throw console.error("Error deleting document from Firestore:",i),i}))}getDocumentById(r){return this.collection.doc(r).get().pipe(pe(i=>{if(i.exists){let s=i.data();return k(s)}else return console.error("Document with provided ID does not exist:",r),k(void 0)}),pt(i=>{throw console.error("Error getting document by ID:",i),i}))}};e.\u0275fac=function(i){return new(i||e)(R(sl))},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function mP(n,e){if(n&1){let t=Am();yt(0,"div",8),Qt("click",function(){let i=cm(t).$implicit,s=Cm();return lm(s.realizarAccion(i.label,i.value))}),yt(1,"div",9),Hn(2,"img",10),Kt(),yt(3,"span",11),ss(4),Kt()()}if(n&2){let t=e.$implicit;la(2),El("src",t.icon,pm),la(2),Dm(t.value)}}var kM=(()=>{let e=class e{constructor(r){this.firestore=r,this.personalInformation=[],this.firestoreService=new BT(this.firestore),this.firestoreService.setCollection("contact-Information")}ngOnInit(){this.firestoreService.getDocuments().subscribe({next:r=>{this.personalInformation=r},error:r=>{console.error("Error loading projects:",r)}})}realizarAccion(r,i){switch(r){case"phone":window.location.href=`tel:+${i}`;break;case"whatsapp":window.open("https://web.whatsapp.com/","_blank");break;case"email":window.location.href=`mailto:${i}`;break}}};e.\u0275fac=function(i){return new(i||e)(Q(sl))},e.\u0275cmp=Or({type:e,selectors:[["shared-contact-information"]],decls:9,vars:1,consts:[[1,"bg-gray-700","rounded-lg","overflow-hidden","transition-all","duration-200","group","relative"],[1,"p-4"],[1,"flex","justify-between","items-center","mb-3"],[1,"text-lg","font-semibold","text-blue-400"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4","text-gray-400","group-hover:text-blue-400","transition-colors"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"space-y-3"],["class","flex items-center p-2 rounded hover:bg-gray-600 transition-colors cursor-pointer",3,"click",4,"ngFor","ngForOf"],[1,"flex","items-center","p-2","rounded","hover:bg-gray-600","transition-colors","cursor-pointer",3,"click"],[1,"h-8","w-8","mr-3","bg-gray-600","p-1.5","rounded-lg","flex","items-center","justify-center"],["alt","",1,"h-full","w-full","object-contain",3,"src"],[1,"text-sm","text-gray-300"]],template:function(i,s){i&1&&(yt(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),ss(4,"Informaci\xF3n de Contacto"),Kt(),aa(),yt(5,"svg",4),Hn(6,"path",5),Kt()(),ua(),yt(7,"div",6),Tm(8,mP,5,2,"div",7),Kt()()()),i&2&&(la(8),El("ngForOf",s.personalInformation))},dependencies:[zm]});let n=e;return n})();var yk="auth";var ol=class{constructor(){return js(yk)}};var KT="firebasestorage.googleapis.com",QT="storageBucket",_k=2*60*1e3,vk=10*60*1e3;var Pe=class n extends wa{constructor(e,t,r=0){super(Ng(e),`Firebase Storage: ${t} (${Ng(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,n.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Ng(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}},Me=function(n){return n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment",n}(Me||{});function Ng(n){return"storage/"+n}function YT(){let n="An unknown error occurred, please check the error payload for server response.";return new Pe(Me.UNKNOWN,n)}function wk(n){return new Pe(Me.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function Ek(n){return new Pe(Me.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function Ik(){let n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Pe(Me.UNAUTHENTICATED,n)}function Tk(){return new Pe(Me.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function Ak(n){return new Pe(Me.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function Ck(){return new Pe(Me.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Sk(){return new Pe(Me.CANCELED,"User canceled the upload/download.")}function bk(n){return new Pe(Me.INVALID_URL,"Invalid URL '"+n+"'.")}function Rk(n){return new Pe(Me.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function Dk(){return new Pe(Me.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+QT+"' property when initializing the app?")}function Pk(){return new Pe(Me.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function Mg(n){return new Pe(Me.INVALID_ARGUMENT,n)}function XT(){return new Pe(Me.APP_DELETED,"The Firebase app was deleted.")}function kk(n){return new Pe(Me.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function ea(n){throw new Pe(Me.INTERNAL_ERROR,"Internal error: "+n)}var it=class n{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=n.makeFromUrl(e,t)}catch{return new n(e,"")}if(r.path==="")return r;throw Rk(e)}static makeFromUrl(e,t){let r=null,i="([A-Za-z0-9.\\-_]+)";function s(V){V.path.charAt(V.path.length-1)==="/"&&(V.path_=V.path_.slice(0,-1))}let o="(/(.*))?$",a=new RegExp("^gs://"+i+o,"i"),u={bucket:1,path:3};function c(V){V.path_=decodeURIComponent(V.path)}let l="v[A-Za-z0-9_]+",h=t.replace(/[.]/g,"\\."),d="(/([^?#]*).*)?$",f=new RegExp(`^https?://${h}/${l}/b/${i}/o${d}`,"i"),E={bucket:1,path:3},w=t===KT?"(?:storage.googleapis.com|storage.cloud.google.com)":t,_="([^?#]*)",D=new RegExp(`^https?://${w}/${i}/${_}`,"i"),C=[{regex:a,indices:u,postModify:s},{regex:f,indices:E,postModify:c},{regex:D,indices:{bucket:1,path:2},postModify:c}];for(let V=0;V<C.length;V++){let L=C[V],z=L.regex.exec(e);if(z){let le=z[L.indices.bucket],Qe=z[L.indices.path];Qe||(Qe=""),r=new n(le,Qe),L.postModify(r);break}}if(r==null)throw bk(e);return r}},Og=class{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}};function xk(n,e,t){let r=1,i=null,s=null,o=!1,a=0;function u(){return a===2}let c=!1;function l(..._){c||(c=!0,e.apply(null,_))}function h(_){i=setTimeout(()=>{i=null,n(f,u())},_)}function d(){s&&clearTimeout(s)}function f(_,...D){if(c){d();return}if(_){d(),l.call(null,_,...D);return}if(u()||o){d(),l.call(null,_,...D);return}r<64&&(r*=2);let C;a===1?(a=2,C=0):C=(r+Math.random())*1e3,h(C)}let E=!1;function w(_){E||(E=!0,d(),!c&&(i!==null?(_||(a=2),clearTimeout(i),h(0)):_||(a=1)))}return h(0),s=setTimeout(()=>{o=!0,w(!0)},t),w}function Vk(n){n(!1)}function Nk(n){return n!==void 0}function Mk(n){return typeof n=="object"&&!Array.isArray(n)}function JT(n){return typeof n=="string"||n instanceof String}function Fg(n,e,t,r){if(r<e)throw Mg(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw Mg(`Invalid value for '${n}'. Expected ${t} or less.`)}function Bg(n,e,t){let r=e;return t==null&&(r=`https://${e}`),`${t}://${r}/v0${n}`}function ZT(n){let e=encodeURIComponent,t="?";for(let r in n)if(n.hasOwnProperty(r)){let i=e(r)+"="+e(n[r]);t=t+i+"&"}return t=t.slice(0,-1),t}var Xi=function(n){return n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT",n}(Xi||{});function Ok(n,e){let t=n>=500&&n<600,i=[408,429].indexOf(n)!==-1,s=e.indexOf(n)!==-1;return t||i||s}var Lg=class{constructor(e,t,r,i,s,o,a,u,c,l,h,d=!0){this.url_=e,this.method_=t,this.headers_=r,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=u,this.timeout_=c,this.progressCallback_=l,this.connectionFactory_=h,this.retry=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((f,E)=>{this.resolve_=f,this.reject_=E,this.start_()})}start_(){let e=(r,i)=>{if(i){r(!1,new Yi(!1,null,!0));return}let s=this.connectionFactory_();this.pendingConnection_=s;let o=a=>{let u=a.loaded,c=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(u,c)};this.progressCallback_!==null&&s.addUploadProgressListener(o),s.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(o),this.pendingConnection_=null;let a=s.getErrorCode()===Xi.NO_ERROR,u=s.getStatus();if(!a||Ok(u,this.additionalRetryCodes_)&&this.retry){let l=s.getErrorCode()===Xi.ABORT;r(!1,new Yi(!1,null,l));return}let c=this.successCodes_.indexOf(u)!==-1;r(!0,new Yi(c,s))})},t=(r,i)=>{let s=this.resolve_,o=this.reject_,a=i.connection;if(i.wasSuccessCode)try{let u=this.callback_(a,a.getResponse());Nk(u)?s(u):s()}catch(u){o(u)}else if(a!==null){let u=YT();u.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,u)):o(u)}else if(i.canceled){let u=this.appDelete_?XT():Sk();o(u)}else{let u=Ck();o(u)}};this.canceled_?t(!1,new Yi(!1,null,!0)):this.backoffId_=xk(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&Vk(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}},Yi=class{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}};function Fk(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function Lk(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function Uk(n,e){e&&(n["X-Firebase-GMPID"]=e)}function jk(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function Bk(n,e,t,r,i,s,o=!0){let a=ZT(n.urlParams),u=n.url+a,c=Object.assign({},n.headers);return Uk(c,e),Fk(c,t),Lk(c,s),jk(c,r),new Lg(u,n.method,c,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,i,o)}function qg(n){let e;try{e=JSON.parse(n)}catch{return null}return Mk(e)?e:null}function qk(n){if(n.length===0)return null;let e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function $k(n,e){let t=e.split("/").filter(r=>r.length>0).join("/");return n.length===0?t:n+"/"+t}function eA(n){let e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}function zk(n,e){return e}var Ne=class{constructor(e,t,r,i){this.server=e,this.local=t||e,this.writable=!!r,this.xform=i||zk}},al=null;function Gk(n){return!JT(n)||n.length<2?n:eA(n)}function Hk(){if(al)return al;let n=[];n.push(new Ne("bucket")),n.push(new Ne("generation")),n.push(new Ne("metageneration")),n.push(new Ne("name","fullPath",!0));function e(s,o){return Gk(o)}let t=new Ne("name");t.xform=e,n.push(t);function r(s,o){return o!==void 0?Number(o):o}let i=new Ne("size");return i.xform=r,n.push(i),n.push(new Ne("timeCreated")),n.push(new Ne("updated")),n.push(new Ne("md5Hash",null,!0)),n.push(new Ne("cacheControl",null,!0)),n.push(new Ne("contentDisposition",null,!0)),n.push(new Ne("contentEncoding",null,!0)),n.push(new Ne("contentLanguage",null,!0)),n.push(new Ne("contentType",null,!0)),n.push(new Ne("metadata","customMetadata",!0)),al=n,al}function Wk(n,e){function t(){let r=n.bucket,i=n.fullPath,s=new it(r,i);return e._makeStorageReference(s)}Object.defineProperty(n,"ref",{get:t})}function Kk(n,e,t){let r={};r.type="file";let i=t.length;for(let s=0;s<i;s++){let o=t[s];r[o.local]=o.xform(r,e[o.server])}return Wk(r,n),r}function Qk(n,e,t){let r=qg(e);return r===null?null:Kk(n,r,t)}function Yk(n,e,t,r){let i=qg(e);if(i===null||!JT(i.downloadTokens))return null;let s=i.downloadTokens;if(s.length===0)return null;let o=encodeURIComponent;return s.split(",").map(c=>{let l=n.bucket,h=n.fullPath,d="/b/"+o(l)+"/o/"+o(h),f=Bg(d,t,r),E=ZT({alt:"media",token:c});return f+E})[0]}var qT="prefixes",$T="items";function Xk(n,e,t){let r={prefixes:[],items:[],nextPageToken:t.nextPageToken};if(t[qT])for(let i of t[qT]){let s=i.replace(/\/$/,""),o=n._makeStorageReference(new it(e,s));r.prefixes.push(o)}if(t[$T])for(let i of t[$T]){let s=n._makeStorageReference(new it(e,i.name));r.items.push(s)}return r}function Jk(n,e,t){let r=qg(t);return r===null?null:Xk(n,e,r)}var ul=class{constructor(e,t,r,i){this.url=e,this.method=t,this.handler=r,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}};function tA(n){if(!n)throw YT()}function Zk(n,e){function t(r,i){let s=Jk(n,e,i);return tA(s!==null),s}return t}function ex(n,e){function t(r,i){let s=Qk(n,i,e);return tA(s!==null),Yk(s,i,n.host,n._protocol)}return t}function nA(n){function e(t,r){let i;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?i=Tk():i=Ik():t.getStatus()===402?i=Ek(n.bucket):t.getStatus()===403?i=Ak(n.path):i=r,i.status=t.getStatus(),i.serverResponse=r.serverResponse,i}return e}function tx(n){let e=nA(n);function t(r,i){let s=e(r,i);return r.getStatus()===404&&(s=wk(n.path)),s.serverResponse=i.serverResponse,s}return t}function nx(n,e,t,r,i){let s={};e.isRoot?s.prefix="":s.prefix=e.path+"/",t&&t.length>0&&(s.delimiter=t),r&&(s.pageToken=r),i&&(s.maxResults=i);let o=e.bucketOnlyServerUrl(),a=Bg(o,n.host,n._protocol),u="GET",c=n.maxOperationRetryTime,l=new ul(a,u,Zk(n,e.bucket),c);return l.urlParams=s,l.errorHandler=nA(e),l}function rx(n,e,t){let r=e.fullServerUrl(),i=Bg(r,n.host,n._protocol),s="GET",o=n.maxOperationRetryTime,a=new ul(i,s,ex(n,t),o);return a.errorHandler=tx(e),a}var C1=256*1024;var zT=null,Ug=class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Xi.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Xi.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Xi.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,i){if(this.sent_)throw ea("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),i!==void 0)for(let s in i)i.hasOwnProperty(s)&&this.xhr_.setRequestHeader(s,i[s].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw ea("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw ea("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw ea("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw ea("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}},jg=class extends Ug{initXhr(){this.xhr_.responseType="text"}};function rA(){return zT?zT():new jg}var Ji=class n{constructor(e,t){this._service=e,t instanceof it?this._location=t:this._location=it.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new n(e,t)}get root(){let e=new it(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return eA(this._location.path)}get storage(){return this._service}get parent(){let e=qk(this._location.path);if(e===null)return null;let t=new it(this._location.bucket,e);return new n(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw kk(e)}};function ix(n){let e={prefixes:[],items:[]};return iA(n,e).then(()=>e)}function iA(n,e,t){return g(this,null,function*(){let i=yield sx(n,{pageToken:t});e.prefixes.push(...i.prefixes),e.items.push(...i.items),i.nextPageToken!=null&&(yield iA(n,e,i.nextPageToken))})}function sx(n,e){e!=null&&typeof e.maxResults=="number"&&Fg("options.maxResults",1,1e3,e.maxResults);let t=e||{},r=nx(n.storage,n._location,"/",t.pageToken,t.maxResults);return n.storage.makeRequestWithTokens(r,rA)}function ox(n){n._throwIfRoot("getDownloadURL");let e=rx(n.storage,n._location,Hk());return n.storage.makeRequestWithTokens(e,rA).then(t=>{if(t===null)throw Pk();return t})}function ax(n,e){let t=$k(n._location.path,e),r=new it(n._location.bucket,t);return new Ji(n.storage,r)}function ux(n){return/^[A-Za-z]+:\/\//.test(n)}function cx(n,e){return new Ji(n,e)}function sA(n,e){if(n instanceof ta){let t=n;if(t._bucket==null)throw Dk();let r=new Ji(t,t._bucket);return e!=null?sA(r,e):r}else return e!==void 0?ax(n,e):n}function lx(n,e){if(e&&ux(e)){if(n instanceof ta)return cx(n,e);throw Mg("To use ref(service, url), the first argument must be a Storage instance.")}else return sA(n,e)}function GT(n,e){let t=e?.[QT];return t==null?null:it.makeFromBucketSpec(t,n)}function hx(n,e,t,r={}){n.host=`${e}:${t}`,n._protocol="http";let{mockUserToken:i}=r;i&&(n._overrideAuthToken=typeof i=="string"?i:_a(i,n.app.options.projectId))}var ta=class{constructor(e,t,r,i,s){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=KT,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=_k,this._maxUploadRetryTime=vk,this._requests=new Set,i!=null?this._bucket=it.makeFromBucketSpec(i,this._host):this._bucket=GT(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=it.makeFromBucketSpec(this._url,e):this._bucket=GT(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Fg("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Fg("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){return g(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=yield e.getToken();if(t!==null)return t.accessToken}return null})}_getAppCheckToken(){return g(this,null,function*(){let e=this._appCheckProvider.getImmediate({optional:!0});return e?(yield e.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Ji(this,e)}_makeRequest(e,t,r,i,s=!0){if(this._deleted)return new Og(XT());{let o=Bk(e,this._appId,r,i,t,this._firebaseVersion,s);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}makeRequestWithTokens(e,t){return g(this,null,function*(){let[r,i]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,i).getPromise()})}},HT="@firebase/storage",WT="0.12.4";var oA="storage";function aA(n){return n=ee(n),ix(n)}function uA(n){return n=ee(n),ox(n)}function cA(n,e){return n=ee(n),lx(n,e)}function lA(n=ds(),e){n=ee(n);let r=Ia(n,oA).getImmediate({identifier:e}),i=bl("storage");return i&&hA(r,...i),r}function hA(n,e,t,r={}){hx(n,e,t,r)}function dx(n,{instanceIdentifier:e}){let t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),i=n.getProvider("app-check-internal");return new ta(t,r,i,e,Ta)}function fx(){Qn(new Yt(oA,dx,"PUBLIC").setMultipleInstances(!0)),$e(HT,WT,""),$e(HT,WT,"esm2017")}fx();var na=class{constructor(e){return e}},dA="storage",$g=class{constructor(){return js(dA)}};var zg=new q("angularfire2.storage-instances");function px(n,e){let t=xh(dA,n,e);return t&&new na(t)}function gx(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new na(r)}}var mx={provide:$g,deps:[[new Dt,zg]]},yx={provide:na,useFactory:px,deps:[[new Dt,zg],iu]},_x=(()=>{class n{constructor(){$e("angularfire",Jt.full,"gcs")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=Fe({type:n});static \u0275inj=Oe({providers:[yx,mx]})}return n})();function W1(n,...e){return{ngModule:_x,providers:[{provide:zg,useFactory:gx(n),multi:!0,deps:[ue,Lr,er,su,[new Dt,ol],[new Dt,Vt],...e]}]}}var Gg=ti(uA,!0);var fA=ti(lA,!0);var pA=ti(aA,!0),Hg=ti(cA,!0);var gA=(()=>{let e=class e{constructor(){this.storage=fA()}getFileUrl(r){return g(this,null,function*(){let i=Hg(this.storage,r);try{return yield Gg(i)}catch(s){throw console.error(`Archivo no encontrado: ${r}`,s),new Error("Archivo no encontrado")}})}getAllFileUrls(r){return g(this,null,function*(){let i=Hg(this.storage,r);try{let o=(yield pA(i)).items.map(u=>g(this,null,function*(){try{let c=yield Gg(u);return{name:u.name,url:c}}catch(c){return console.warn(`No se pudo obtener la URL de ${u.fullPath}`,c),null}}));return(yield Promise.all(o)).filter(u=>u!==null)}catch(s){return console.error(`Error al listar archivos en ${r}:`,s),[]}})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var J1=(()=>{let e=class e{constructor(r){this.storageService=r}downloadPDF(){return g(this,null,function*(){let r=yield this.storageService.getFileUrl("portfolio/cv/cv_max_poblete.pdf"),i=document.createElement("a");i.href=r,i.target="_blank";let s=new Date().toISOString().split("T")[0];i.download=`cv_max_poblete_${s}.pdf`,document.body.appendChild(i),i.click(),document.body.removeChild(i)})}};e.\u0275fac=function(i){return new(i||e)(Q(gA))},e.\u0275cmp=Or({type:e,selectors:[["app-download-cv"]],decls:5,vars:0,consts:[[1,"w-full","flex","items-center","justify-center","gap-2","bg-gray-600","hover:bg-gray-500","text-blue-400","py-2","px-4","rounded-lg","transition-colors","mb-6",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"]],template:function(i,s){i&1&&(yt(0,"button",0),Qt("click",function(){return s.downloadPDF()}),aa(),yt(1,"svg",1),Hn(2,"path",2),Kt(),ua(),yt(3,"span"),ss(4,"Descargar CV"),Kt()())},styles:[".btn-download[_ngcontent-%COMP%]{background-color:#124670;color:#fff;font-size:16px;font-weight:700;padding:10px 15px;border:none;border-radius:5px;cursor:pointer;display:flex;align-items:center;gap:8px;transition:background .3s;margin:22px}.btn-download[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:20px}.btn-download[_ngcontent-%COMP%]:hover{background-color:#125185}"]});let n=e;return n})();var lO=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Fe({type:e}),e.\u0275inj=Oe({imports:[ya,C_,My]});let n=e;return n})();export{Ym as a,$x as b,zx as c,Jn as d,X0 as e,Xt as f,qy as g,xV as h,C_ as i,RN as j,$N as k,ce as l,sl as m,BT as n,gy as o,iy as p,uV as q,cV as r,hV as s,m0 as t,_0 as u,E0 as v,dV as w,My as x,kM as y,W1 as z,fA as A,J1 as B,lO as C};
